<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: SENT Decoder Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('SENT_DESIGN.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SENT Decoder Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1573">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1574">SENT Protocol Decoder</a></li>
<li class="level1"><a href="#autotoc_md1575">System Overview</a><ul><li class="level2"><a href="#autotoc_md1576">Sitara™ AM263x Processor</a><ul><li class="level3"><a href="#autotoc_md1577">PRU-ICSS</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1578">Software Description</a><ul><li class="level2"><a href="#autotoc_md1579">PRU0 Firmware Design (Sampling)</a></li>
<li class="level2"><a href="#autotoc_md1580">PRU1 Firmware Design (Decoding)</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1581">SENT DECODER DESIGN USING PRUICSS ECAP</a><ul><li class="level2"><a href="#autotoc_md1582">R5F Configuration</a></li>
<li class="level2"><a href="#autotoc_md1583">PRU0 Firmware Design (Decoding)</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_pru_io_sent_design"></a></p>
<h1><a class="anchor" id="autotoc_md1573"></a>
Introduction</h1>
<p>This section describes the PRU firmware implementation details of SENT Protocol Decoder .</p>
<h1><a class="anchor" id="autotoc_md1574"></a>
SENT Protocol Decoder</h1>
<p>It is a unidirectional communication method that connects the sensor/transmitting device and the controller/receiving device without the use of a coordination signal from the controller/receiving device. It is intended for usage in situations where high-resolution data must be transferred from a sensor to an engine control unit (ECU). It serves as a simpler, less expensive alternative to CAN, LIN, or PSI5 as well as a replacement for lesser resolution techniques such as traditional sensors that provide analog output voltage and PWM. Automotive applications for SENT-compatible sensor devices include applications for pedal sensing, mass airflow sensing, pressure sensing, temperature sensing, humidity sensing, and many others.</p>
<p>The AM263x SENT decoder is intended to receive transmission from sensors with SENT interface and provides ECU(Engine Control Unit) with digital information from the sensor. The following pulses (all with nominal timings) make up the transmitting sequence:</p>
<ol type="1">
<li>Synchronization/calibration pulse, first (56 clock ticks)</li>
<li>A single pulse with a 4 bit Status and Serial Communication header (12 to 27 clock ticks)</li>
<li>A series of one to six data nibble pulses, each reflecting the values of the signal(s) to be conveyed and lasting 12 to 27 clock ticks. Since the trailing falling edge of the SENT transmission CRC nibble also serves as the leading falling edge of the subsequent SENT transmission synchronization/calibration pulse, the number of nibbles will be fixed for each application of the encoding scheme (such as throttle position sensors, mass air flow, etc.).</li>
<li>One 4-bit checksum(CRC) nibble pulse (12 to 27 clock ticks)</li>
<li>One optional pause pulse</li>
</ol>
<p> <style>div.image img[src="sent_signal.png"]{width:80%}</style> </p><div class="image">
<img src="sent_signal.png" alt=""/>
<div class="caption">
SENT Signal</div></div>
<h1><a class="anchor" id="autotoc_md1575"></a>
System Overview</h1>
<h2><a class="anchor" id="autotoc_md1576"></a>
Sitara™ AM263x Processor</h2>
<p>Refer TRM for details</p>
<h3><a class="anchor" id="autotoc_md1577"></a>
PRU-ICSS</h3>
<p>Refer PRU-ICSS chapter of AM263x Technical Reference Manual</p>
<h1><a class="anchor" id="autotoc_md1578"></a>
Software Description</h1>
<p>At start-up, the application running on the ARM Cortex-R5 initializes the module clocks and configures the pinmux. The PRU is initialized and the PRU firmware is loaded on both PRU slice of the ICSS instance. Once the PRU0 starts executing, the sampling logic of SENT decoder interface is operational and next PRU 1 starts executing where decoding logic is running to extract sent values from the SENT pulse and also calculate CRC. The application can use it to communicate with a SENT sensor. The application then waits until it receives an indication of complete decoding of SENT frame on each channel by the firmware through the interface before displaying the result.</p>
<h2><a class="anchor" id="autotoc_md1579"></a>
PRU0 Firmware Design (Sampling)</h2>
<p>Once the firmware is loaded in both the PRU, PRU0 starts sampling loop which checks for falling edges on all channels, once there is falling edge, it registers the timestamp using IEP timer and sends the data to scratch pad for PRU1 to process it. The same sequence is repeated for all the channels.  <style>div.image img[src="sent3.png"]{width:80%}</style> </p><div class="image">
<img src="sent3.png" alt=""/>
<div class="caption">
Sampling</div></div>
<p>  <style>div.image img[src="sent4.png"]{width:80%}</style> </p><div class="image">
<img src="sent4.png" alt=""/>
<div class="caption">
Timestamp</div></div>
<p>  <style>div.image img[src="sent5.png"]{width:80%}</style> </p><div class="image">
<img src="sent5.png" alt=""/>
<div class="caption">
Sending data to pru1</div></div>
<h2><a class="anchor" id="autotoc_md1580"></a>
PRU1 Firmware Design (Decoding)</h2>
<p>Firmware is loaded and PRU1 starts running, it waits for PRU0 to send data using scratch pad. Once it receives data it signals PRU0 using acknowledgement bit in scratch pad. Each channel has a channel state register which maintains information about the next state. During initialization channel status register is initialized with chx_sync state, i.e. first state of sync detection and calibration. PRU1 implements a state machine which has following states Sync calculation, Status and COMM Nibble, Data 0-5 and CRC state(as shown the diagram below). After initialization, the first expected pulse is synchronization pulse. Once a valid synchronization pulse is detected, <code>chx_sync</code> calculates the look-up table for decoding data nibble from next pulse sent by PRU0, updates the channel state register and proceeds to next channel and computes based on respective channel state register. In case of other channel state like status and communication nibble decoding, binary search is implemented to find the associated value from 0 to 15. In case there is no match found, the channel state register goes to <code>data_error</code> state. The binary search implementation also accommodates for +-20% variation in pulse length as allowed in the spec. Once binary search return a valid result, next step is to store in respective channel buffer located in scratch pad. Then CRC is calculated using look up table and stored in temporary buffer. This way CRC is updated as each nibble gets decoded. At <code>chx_crc</code> state the aggregated CRC is match with the received CRC nibble, if check passes then the data stored in scratch pad buffer is sent to shared memory signal is sent to R5F and buffer is recycled.  <style>div.image img[src="sent_decoder_flow.png"]{width:80%}</style> </p><div class="image">
<img src="sent_decoder_flow.png" alt=""/>
<div class="caption">
State Machine for Decoder</div></div>
<p>  <style>div.image img[src="sent10.png"]{width:80%}</style> </p><div class="image">
<img src="sent10.png" alt=""/>
<div class="caption">
Send data to R5F</div></div>
<h1><a class="anchor" id="autotoc_md1581"></a>
SENT DECODER DESIGN USING PRUICSS ECAP</h1>
<h2><a class="anchor" id="autotoc_md1582"></a>
R5F Configuration</h2>
<p>Each Sent channel is mapped to GPIO Signals , GPIO Interrupt signals generated on fall edge of sent signal and are given as input to (GPIO XBAR) then OUPUT of (GPIO XBAR) is given as input to (TIME SYNC XBAR) &amp; ICSS IEP ECAP CAP uses output of (TIME SYNC XBAR) to get time stamp , IEP ECAP registers are updated on fall edge of sent signal</p>
<h2><a class="anchor" id="autotoc_md1583"></a>
PRU0 Firmware Design (Decoding)</h2>
<p>Once the firmware is loaded in PRU0, ECAP ,PRU 0 starts reading the time stamps of all the channels from capture registers, Once the time stamps are updated &amp; it follows the state machine which is same as above PRU1 implementation. </p><div class="image">
<img src="sent_using_pruicss_iep_ecap.png" alt=""/>
<div class="caption">
State Machine for Decoder Using PRUICSS IEP ECAP</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
