<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Enet CPSW Industrial Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_ENET_CPSW_INDUSTRIAL_APP.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Enet CPSW Industrial Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md3042">Introduction</a></li>
<li class="level1"><a href="#autotoc_md3043">Overview</a><ul><li class="level2"><a href="#autotoc_md3044">Raw-UDP Application</a><ul><ul><li class="level4"><a href="#autotoc_md3045">Packet Processing</a></li>
</ul>
</ul>
</li>
<li class="level2"><a href="#autotoc_md3046">TCP/IP server</a></li>
<li class="level2"><a href="#autotoc_md3047">Profiling</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md3048">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md3049">Packet pool configuration</a></li>
<li class="level1"><a href="#autotoc_md3050">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md3051">Build the example</a></li>
<li class="level2"><a href="#autotoc_md3052">Hardware Setup</a></li>
<li class="level2"><a href="#autotoc_md3053">Run the example</a></li>
<li class="level2"><a href="#autotoc_md3054">Sample Output</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md3055">See also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_networking_enet_cpsw_industrial_example"></a></p>
<h1><a class="anchor" id="autotoc_md3042"></a>
Introduction</h1>
<p>This example demonstrates the effectiveness of CPSW in low-latency applications, where the device handles two types of traffic</p>
<ul>
<li>Raw-UDP traffic : Low-latency data that requires fast packet processing and transmission</li>
<li>TCP traffic :Other background traffic that can tolerate some delay in transmission and processing</li>
</ul>
<p>The application uses separate channels for each type of traffic, with real-time traffic receiving priority to guarantee low latency. The packets received in the this channel undergo modifications and are sent back to the source node. The TCP server runs on LwIP stack and echoes back packets received in the designated channel.The application uses two DMA TX channels and two DMA RX channels. Channels TX1 and RX1 are used for raw-UDP traffic; TX0 and RX0 are used for running the TCP server.</p>
<h1><a class="anchor" id="autotoc_md3043"></a>
Overview</h1>
<h2><a class="anchor" id="autotoc_md3044"></a>
Raw-UDP Application</h2>
<p>The Raw-UDP channel is configured to facilitate efficient and low-latency packet processing. The setup involves:</p><ul>
<li>Initializing DMA Channel 1: The DMA channel is opened, and Tx and Rx queues are initialized to enable data transfer.</li>
<li>Creating a Packet Processing Task: A task is created to handle packet processing, which is triggered upon the arrival of a packet.</li>
</ul>
<h4><a class="anchor" id="autotoc_md3045"></a>
Packet Processing</h4>
<p>When a packet enters either of the MAC ports, the destination IP address is compared to the real-time address of the device by the address lookup engine. If a match is found, the packet is routed to the corresponding DMA channel for transmission to the host. The IP address is configured based on the node ID</p>
<p>After receiving a packet, the payload is modified, and the packet is echoed back to the sender. The RawUdpApp_modifyPkt() function in app_rawudp_priv.c is used for modifying the packet payload. This function can be customized to meet specific requirements, allowing for the transmission of tailored packets. By default, it provides an optimized way to transmit a packet to the sender with a minimally modified payload.</p>
<h2><a class="anchor" id="autotoc_md3046"></a>
TCP/IP server</h2>
<p>The application implements a TCP server using the standard LwIP stack and uses netconn APIs with cpsw as the ethernet driver</p>
<ul>
<li>Initialization of lwIP: The lwIP library is initialized to prepare for network stack setup. A single netif is enabled by default, which can be modified through the system configuration (syscfg).</li>
<li>Configuration of Network Interface:The network interface (netif) is configured with the necessary settings, including IP address, netmask, and gateway. Static IP addressing and dynamic IP assignment using DHCP are supported.</li>
<li>Creating a New Thread for the Server Task: A new thread is created to execute the echo server task, which waits for incoming connections and echoes back received packets.</li>
</ul>
<div class="image">
<img src="cpsw_industrial_application.png" alt="" width="15%"/>
<div class="caption">
Application Overview </div></div>
<h2><a class="anchor" id="autotoc_md3047"></a>
Profiling</h2>
<p>The application has the macro PROFILE_EN for profiling software latency of the raw-UDP channel. The start time is recorded in the receive ISR and the end time is recorded after the packets to be transmitted have been submitted to the DMA.The average and maximum values are printed on the console after the configured number of packets( ENETAPP_PKT_PROFILE ) are processed. Profiling is disabled by default it can be enabled in enetapp_cfg.h by uncommenting the macro PROFILE_EN.</p>
<h1><a class="anchor" id="autotoc_md3048"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263x-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">source/networking/enet/core/examples/enet_cpsw_industrial_app   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md3049"></a>
Packet pool configuration</h1>
<p>To change packet pool configuration from syscfg, please refer to <a class="el" href="PACKETPOOL_CONFIG_TOP.html">Ethernet Packet Pool Allocation Guidelines</a></p>
<h1><a class="anchor" id="autotoc_md3050"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md3051"></a>
Build the example</h2>
<ul>
<li>When using CCS projects to build, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li>When using makefiles to build, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md3052"></a>
Hardware Setup</h2>
<p>The EVM must be setup with cable connections as shown in the figure below </p><div class="image">
<img src="cpsw_industrial_setup.png" alt="" width="60%"/>
<div class="caption">
EVM Setup </div></div>
<h2><a class="anchor" id="autotoc_md3053"></a>
Run the example</h2>
<ol type="1">
<li>Connect the MAC port as described in <b>Hardware Setup</b> section.</li>
<li>Launch a CCS debug session and run the example executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a>.</li>
<li>Configure the node id for each node. Make sure you change the maximum number of nodes in the application according to your setup.</li>
<li>The IP addresses for raw-UDP and TCP channels of each node for different channels will be displayed on the console as shown in the sample output.</li>
<li>Wait for both the links to be up and for the TCP server to be setup. Send packets to the desired node from the source node.</li>
<li>Echoed packets from the destination node should be received at the source node with modified payloads.</li>
</ol>
<p>For using tcp channel please refer to <a class="el" href="enet__lwip__tcpserver_8md.html">enet_lwip_tcpserver.md</a></p>
<h2><a class="anchor" id="autotoc_md3054"></a>
Sample Output</h2>
<div class="fragment"><div class="line">=======================================================</div>
<div class="line">           CPSW Industrial Application</div>
<div class="line">=======================================================</div>
<div class="line">Enter the nodeId between 1 to 10: </div>
<div class="line">10</div>
<div class="line">NodeId: 10</div>
<div class="line">Enabled clocks for all ENET instances</div>
<div class="line">EnetAppUtils_reduceCoreMacAllocation: Reduced Mac Address Allocation for CoreId:0 From 4 To 3 </div>
<div class="line">Open MAC port 1</div>
<div class="line">EnetPhy_bindDriver:1873 </div>
<div class="line">Open MAC port 2</div>
<div class="line">EnetPhy_bindDriver:1873 </div>
<div class="line">PHY 3 is alive</div>
<div class="line">PHY 12 is alive</div>
<div class="line"> </div>
<div class="line">Attach core id 0 on all peripherals</div>
<div class="line">----------------------------------------------</div>
<div class="line">Waiting for link up...</div>
<div class="line">Waiting for port 1 link up...</div>
<div class="line">Cpsw_handleLinkUp:1653 </div>
<div class="line">MAC Port 1: link up</div>
<div class="line"> </div>
<div class="line">All links up </div>
<div class="line">Host MAC Address-0 : 70:ff:76:1f:68:ed</div>
<div class="line"> </div>
<div class="line">Setting up Raw-UDP channel </div>
<div class="line">initQs() txFreePktInfoQ initialized with 8 pkts</div>
<div class="line">Created Rx task for Raw-UDPP channel 1</div>
<div class="line">IP for Raw-UDP Traffic is 10.24.0.10</div>
<div class="line"> </div>
<div class="line">Starting lwIP, local interface IP is dhcp-enabled</div>
<div class="line">[0]: Static IP with LWIP-Stack is 192.168.1.10</div>
<div class="line">[LWIPIF_LWIP] NETIF INIT SUCCESS</div>
<div class="line">Host MAC address-0 : 70:ff:76:1f:68:ed</div>
<div class="line">[0]Enet IF UP Event. Local interface IP:192.168.1.10</div>
<div class="line">[LWIPIF_LWIP] Enet has been started successfully</div>
<div class="line">[0]Waiting for network UP ...</div>
<div class="line">[0]Network Link UP Event</div>
<div class="line">Network is UP ...</div>
<div class="line">=======================================================</div>
<div class="line">      SOFTWARE PROFILING FOR RAW-UDP CHANNEL </div>
<div class="line">=======================================================</div>
<div class="line">Number of Packets = 10000 </div>
<div class="line">Average Profile Time: 17.021572</div>
<div class="line">Max Profile Time: 43.902500</div>
<div class="line">======================================================</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3055"></a>
See also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
