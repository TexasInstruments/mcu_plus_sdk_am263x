<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Software Instrument Smart Placement</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('SW_INSTRUMENT_SMART_PLACEMENT.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Software Instrument Smart Placement </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md777">Introduction</a></li>
<li class="level1"><a href="#autotoc_md778">Short Coming of This Method</a></li>
<li class="level1"><a href="#autotoc_md779">Tools and other requirements</a></li>
<li class="level1"><a href="#autotoc_md780">Steps</a><ul><li class="level2"><a href="#autotoc_md781">1. Recompilation of Libraries</a></li>
<li class="level2"><a href="#autotoc_md782">2. Recompilation of Application</a></li>
<li class="level2"><a href="#autotoc_md783">3. Test Run / Profiling Data Generation</a></li>
<li class="level2"><a href="#autotoc_md784">4. Profiling Data Extraction</a></li>
<li class="level2"><a href="#autotoc_md785">5. Extracted Data Processing</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md786">6. Linker update related to Smart Placement</a></li>
<li class="level1"><a href="#autotoc_md787">7. Rebuilding the Application</a></li>
<li class="level1"><a href="#autotoc_md788">Benchmark Application</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_tools_sw_instrument_smart_placement"></a></p>
<h1><a class="anchor" id="autotoc_md777"></a>
Introduction</h1>
<p>This page goes over how to use software instrument smart placement.</p>
<p>Software instrumentation implementation make use of ti-arm-clang compiler's instrumentation feature.</p>
<h1><a class="anchor" id="autotoc_md778"></a>
Short Coming of This Method</h1>
<ol type="1">
<li>Will not work for C++ code.</li>
<li>All static functions are never considered.</li>
<li>Internal memory constraint applications may not be able to use this.</li>
</ol>
<h1><a class="anchor" id="autotoc_md779"></a>
Tools and other requirements</h1>
<ol type="1">
<li><code>ti-arm-clang</code> compiler version more than <code>3.1.0 STS</code> is required.</li>
<li><code>node</code> version v16.20.2 is required</li>
<li>Make sure <code>yargs</code> and <code>lodash</code> modules of node is installed.</li>
<li>The following steps only work in terminal with <code>pwd</code> being equal to <code>MCU_PLUS_SDK_PATH</code> environment variable.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Underlying scripts can be used in any build system.</dd></dl>
<h1><a class="anchor" id="autotoc_md780"></a>
Steps</h1>
<h2><a class="anchor" id="autotoc_md781"></a>
1. Recompilation of Libraries</h2>
<p>It needs to made sure that all the source code are built using <code>-fprofile-instr-generate -fcoverage-mapping</code> flags. Therefore, it is required to recompile entire SDK with these flags. To do this, please execute the following command on SDK top level.</p>
<blockquote class="doxtable">
<p>gmake -j libs-scrub DEVICE=am263x </p>
</blockquote>
<p>This will remove all compiled libraries. This will make sure to have a clean start. Then,</p>
<blockquote class="doxtable">
<p>gmake -j libs DEVICE=am263x INSTRUMENTATION_MODE=yes </p>
</blockquote>
<p>The above command will compile all the SDK libraries in <code>instrumentation mode</code> and in <code>release</code> profile. If it required to build libraries in <code>debug</code> mode then <code>PROFILE=debug</code> can be added at the end of the command.</p>
<p>Also, in Linux, <code>gmake</code> is to be replaced by <code>make</code>. The above commands assumes that current working directory is defined in <code>MCU_PLUS_SDK_PATH</code> environment variable.</p>
<h2><a class="anchor" id="autotoc_md782"></a>
2. Recompilation of Application</h2>
<p>Application is also required to be compiled with those flags.</p>
<p>The binary that is generated is an instrumented binary and its size is going to be more than the size of original application size. Therefore, it might be the case that linker.cmd file needs to be changed.</p>
<p>For the changes that are required to be done for in linker script for instrumentation, please go through the following steps documented at <a class="el" href="INSTRUMENTED_APPLICATION_SPECIAL_SECTION_ADD.html">How to add compiler generated sections for instrumentation binaries?</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Although these changes are already at-least in empty SDK examples. So, changes can be copied and pasted directly from it and any more changes can be done on top of that.</dd></dl>
<p>Once those changes are done, execute following commands:</p>
<div class="fragment"><div class="line">gmake -C path/to/folder/with/application/makefile scrub</div>
<div class="line">gmake -C path/to/folder/with/application/makefile INSTRUMENTATION_MODE=yes</div>
</div><!-- fragment --><p>The above two commands assume that current working directory is defined in <code>MCU_PLUS_SDK_PATH</code> environment variable. Again, profile flag can be added as well to above commands.</p>
<h2><a class="anchor" id="autotoc_md783"></a>
3. Test Run / Profiling Data Generation</h2>
<p>The instrumented binary needs to be run on the target. Make sure to run the application under correct scenario that would lead to good and complete profiling data generation. This is a very important step and quality and accuracy of the generated profiling data will determine quality of rest of the process.</p>
<p>This can be done connecting via CCS and can be read at <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></p>
<h2><a class="anchor" id="autotoc_md784"></a>
4. Profiling Data Extraction</h2>
<ol type="1">
<li>Connect to target via CCS. Steps to do this can be found at <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>Open CCS scripting console <code>CCS Tool Bar &gt; View &gt; Scripting Console</code> and do below, <pre class="fragment"> js:&gt; loadJSFile "C:/ti/mcu_plus_sdk/tools/smart_placement/coverage_dump.js"
</pre><ul>
<li><b>NOTE</b> replace <code>C:/ti/mcu_plus_sdk</code> with the absolute path to where the SDK is installed.</li>
</ul>
</li>
</ol>
<p>What this will do is, make a new <code>.cnt</code> file in same place as that of location of applicationâ€™s <code>.out</code> file.</p>
<h2><a class="anchor" id="autotoc_md785"></a>
5. Extracted Data Processing</h2>
<p>All the profiling data that is extracted, is stored in <code>.cnt</code> file. This <code>.cnt</code> file has to be processed and needs to be converted into a format that compiler will understand. To do this, type the following command:</p>
<div class="fragment"><div class="line">gmake -C path/to/folder/with/application/makefile coverage</div>
</div><!-- fragment --><p>Again, if application is being built in debug mode, then make sure to provide <code>PROFILE</code> flag to the above command.</p>
<p>The output of this step would an ASM file with <code>.S</code> extension.</p>
<h1><a class="anchor" id="autotoc_md786"></a>
6. Linker update related to Smart Placement</h1>
<p>Update linker as described at <a class="el" href="SMART_PLACEMENT_LINKER_CHANGE.html">Changes in linker for Smart Placement</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Although these changes are already at-least in <a class="el" href="BENCHMARK_SMART_PLACEMENT.html">Memory Benchmark with Smart Placement</a> SDK examples. So, changes can be copied and pasted directly from it and any more changes can be done on top of that.</dd></dl>
<h1><a class="anchor" id="autotoc_md787"></a>
7. Rebuilding the Application</h1>
<p>Recompile the application with new generated ASM file. To do this, add the file in makefile's <code>ASMFILES_common</code> variable. Note that, now INSTRUMENTATION_MODE flag is not required. So rebuild libs and application without these flags.</p>
<h1><a class="anchor" id="autotoc_md788"></a>
Benchmark Application</h1>
<p>This demo provides a means of measuring the performance of a realistic application where the text of the application is sitting in various memory locations and the data is sitting in On-Chip-Memory RAM (referred to as OCM, OCMC or OCMRAM).</p>
<dl class="section note"><dt>Note</dt><dd>All above steps are already done and generated ASM file has been renamed to <code>annotations.S</code>.</dd></dl>
<p>In case if above steps are required to run, then all linker related changes can be skipped as those are already taken into account.</p>
<p><a class="el" href="BENCHMARK_SMART_PLACEMENT.html">Memory Benchmark with Smart Placement</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
