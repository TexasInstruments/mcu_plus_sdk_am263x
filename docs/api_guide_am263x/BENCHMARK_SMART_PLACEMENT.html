<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Memory Benchmark with Smart Placement</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('BENCHMARK_SMART_PLACEMENT.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Memory Benchmark with Smart Placement </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#BENCHMARK_SMART_PLACEMENT_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md3648">Introduction</a></li>
<li class="level1"><a href="#autotoc_md3649">Building benchmark application</a></li>
<li class="level1"><a href="#autotoc_md3650">Running benchmark application</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_benchmarks_benchmark_smart_placement"></a></p>
<h1><a class="anchor" id="BENCHMARK_SMART_PLACEMENT_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263x-cc, am263x-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/benchmarks/ocmc_benchmarking   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md3648"></a>
Introduction</h1>
<ul>
<li>This demo provides a means of measuring the performance of a realistic application where the text of the application is sitting in various memory locations and the data is sitting in On-Chip-Memory RAM (referred to as OCM, OCMC or OCMRAM).</li>
<li>The application executes 10 different configurations of the same text varying by data vs. instruction cache intensity. Each test calls 16 separate functions 500 total times in random order.</li>
<li>The most instruction intensive example achieves a instruction cache miss rate (ICM/sec) of ~3-4 million per second when run entirely from OCMRAM. This is a rate that we have similarly seen in real-world customer examples.</li>
<li>More data intensive tests have more repetitive code, achieving much lower ICM rates.</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Application Output  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Mem Cpy size =&gt; 100  </td><td class="markdownTableBodyNone">Size of the memcpy in bytes executed by each task   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Exec Time in usec =&gt; 2567  </td><td class="markdownTableBodyNone">Amount of time in microseconds   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Iter =&gt; 1  </td><td class="markdownTableBodyNone">Number of times the test was run   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Task calls =&gt; 500  </td><td class="markdownTableBodyNone">Number of randomly ordered calls to the 16 tasks   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Inst Cache miss =&gt; 11421  </td><td class="markdownTableBodyNone">Total instruction cache misses   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Inst Cache acc =&gt; 650207  </td><td class="markdownTableBodyNone">Total instruction cache accesses   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">num switches =&gt; 1469  </td><td class="markdownTableBodyNone">Number of total context switches   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">num instr exec =&gt; 1029260  </td><td class="markdownTableBodyNone">Total number of executed instructions   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ICM/sec =&gt; 4449162  </td><td class="markdownTableBodyNone">Instruction cache misses per second   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">INST/sec =&gt; 400958317  </td><td class="markdownTableBodyNone">Instructions executed per second   </td></tr>
</table>
<p>Please read more on smart placement at <a class="el" href="SMART_PLACEMENT.html">Smart Placement</a>, before moving further ahead.</p>
<p><code>annotations.S</code> has a macro named <code>ENABLE_SMART_PLACEMENT_ANNOTATION</code> which can be used to enable and disable annotations which will effectively enable and disable smart placement.</p>
<p>Here it will be shown how code performance (or CPI) is improved with smart placement.</p>
<h1><a class="anchor" id="autotoc_md3649"></a>
Building benchmark application</h1>
<p>To build this application, compiler ti-cgt-armllvm &gt;= 3.2.0 LTS or later is required. Application can be compiled using make command.</p>
<h1><a class="anchor" id="autotoc_md3650"></a>
Running benchmark application</h1>
<p>This particular application is used to show the effect of smart placement. To do this, we first remove <code>ENABLE_SMART_PLACEMENT_ANNOTATION</code> macro (which is in <code>annotations.S</code> file.) and compile it. To know how <code>annotations.S</code> has been generated then please refer to <a class="el" href="SW_INSTRUMENT_SMART_PLACEMENT.html">Software Instrument Smart Placement</a></p>
<p>Flash this application using uart_uniflash. For this please go through <a class="el" href="TOOLS_FLASH.html#TOOLS_FLASH_UART_UNIFLASH">UART Uniflash</a></p>
<p>After running the application, console logs prints out in the above table format with different configuration like <code>Mem Cpy Size</code> i.e. for different values of <code>Mem Cpy Size</code>, <code>exec time</code> and <code>ICM/sec</code> (among with others) is printed. For example,</p>
<pre class="fragment">OCMC benchmarking:: Board_init success
Countdown...
1/5
2/5
3/5
4/5
5/5
Filling up the buffers
Inst Cache Miss: 2
Inst Cache Access: 22
Data Cache Miss: 39


master_task


master_task -- start sending

Mem Cpy Size    =&gt; 0
Start Time in Usec =&gt; 244351
Exec Time in Usec =&gt; 11867
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 87023
Inst Cache Acc  =&gt; 856803
Num Instr Exec  =&gt; 1893125
ICM/sec         =&gt; 9
ICM/sec         =&gt; 9
INST/sec        =&gt; 197
INST/sec        =&gt; 197

Mem Cpy Size    =&gt; 100
Start Time in Usec =&gt; 269072
Exec Time in Usec =&gt; 12428
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 85720
Inst Cache Acc  =&gt; 995992
Num Instr Exec  =&gt; 2087348
ICM/sec         =&gt; 8
ICM/sec         =&gt; 8
INST/sec        =&gt; 207
INST/sec        =&gt; 207

Mem Cpy Size    =&gt; 200
Start Time in Usec =&gt; 298477
Exec Time in Usec =&gt; 13130
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 86529
Inst Cache Acc  =&gt; 1141634
Num Instr Exec  =&gt; 2287056
ICM/sec         =&gt; 8
ICM/sec         =&gt; 8
INST/sec        =&gt; 215
INST/sec        =&gt; 215

Mem Cpy Size    =&gt; 400
Start Time in Usec =&gt; 325456
Exec Time in Usec =&gt; 14606
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 88361
Inst Cache Acc  =&gt; 1446200
Num Instr Exec  =&gt; 2688209
ICM/sec         =&gt; 7
ICM/sec         =&gt; 7
INST/sec        =&gt; 227
INST/sec        =&gt; 227

Mem Cpy Size    =&gt; 1000
Start Time in Usec =&gt; 354810
Exec Time in Usec =&gt; 18367
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 84032
Inst Cache Acc  =&gt; 2342630
Num Instr Exec  =&gt; 3879466
ICM/sec         =&gt; 5
ICM/sec         =&gt; 5
INST/sec        =&gt; 260
INST/sec        =&gt; 260

Mem Cpy Size    =&gt; 1500
Start Time in Usec =&gt; 388418
Exec Time in Usec =&gt; 23678
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 86357
Inst Cache Acc  =&gt; 3106798
Num Instr Exec  =&gt; 4892362
ICM/sec         =&gt; 4
ICM/sec         =&gt; 4
INST/sec        =&gt; 255
INST/sec        =&gt; 255

Mem Cpy Size    =&gt; 2000
Start Time in Usec =&gt; 426769
Exec Time in Usec =&gt; 28432
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 86051
Inst Cache Acc  =&gt; 3855309
Num Instr Exec  =&gt; 5887390
ICM/sec         =&gt; 3
ICM/sec         =&gt; 3
INST/sec        =&gt; 255
INST/sec        =&gt; 255

Mem Cpy Size    =&gt; 2250
Start Time in Usec =&gt; 471196
Exec Time in Usec =&gt; 31236
Iter            =&gt; 1
Task Calls      =&gt; 500
Inst Cache Miss =&gt; 88306
Inst Cache Acc  =&gt; 4239124
Num Instr Exec  =&gt; 6397039
ICM/sec         =&gt; 3
ICM/sec         =&gt; 3
INST/sec        =&gt; 252
INST/sec        =&gt; 252
</pre><p>So from the above, <code>mem Cpy Size</code> is changing, ICM is almost same but <code>Exec Time in Usec</code> is increasing which is thereby changing <code>ICM/sec</code>. Here to find the base line, <code>Exec Time in Usec</code> should be selected for the case where <code>ICM/sec</code> is 3 (or ~3Millions Instruction Cache Miss/Sec) and from the above data, it can be determined that when <code>mem Cpy Size</code> is 2000, <code>ICM/sec</code> was 3 and for this, it took 28432 us to execute the application. Therefore, 28432 us is our baseline number.</p>
<p>Now after this, <code>ENABLE_SMART_PLACEMENT_ANNOTATION</code> macro is defined again and example is compiled back.</p>
<p>running that would give similar logs and execution time against the <code>Mem Cpy Size</code> of 2000 is to be noted and has been measured out to be 25758 us. Following table shows the same:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mem Cpy Size  </th><th class="markdownTableHeadNone">INST/sec  </th><th class="markdownTableHeadNone">Exec Time in Usec without Smart Placement  </th><th class="markdownTableHeadNone">Exec Time in Usec with Smart Placement   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0000  </td><td class="markdownTableBodyNone">7333192  </td><td class="markdownTableBodyNone">11867  </td><td class="markdownTableBodyNone">9424   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0100  </td><td class="markdownTableBodyNone">7002172  </td><td class="markdownTableBodyNone">12428  </td><td class="markdownTableBodyNone">10057   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0200  </td><td class="markdownTableBodyNone">6627799  </td><td class="markdownTableBodyNone">13130  </td><td class="markdownTableBodyNone">10653   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0400  </td><td class="markdownTableBodyNone">5958031  </td><td class="markdownTableBodyNone">14606  </td><td class="markdownTableBodyNone">12105   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1000  </td><td class="markdownTableBodyNone">4509122  </td><td class="markdownTableBodyNone">18367  </td><td class="markdownTableBodyNone">15924   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1500  </td><td class="markdownTableBodyNone">3647140  </td><td class="markdownTableBodyNone">23678  </td><td class="markdownTableBodyNone">21222   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2000  </td><td class="markdownTableBodyNone">3026765  </td><td class="markdownTableBodyNone">28432  </td><td class="markdownTableBodyNone">25758   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2250  </td><td class="markdownTableBodyNone">2827058  </td><td class="markdownTableBodyNone">31236  </td><td class="markdownTableBodyNone">28583   </td></tr>
</table>
<p>Therefore, with smart placement code was executed in 25758us and without smart placement same code executed in 28432us which corresponds to performance gain of 10% without changing of any code. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
