<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: ICSS-EMAC Lwip Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_ICSS_EMAC_LWIP.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ICSS-EMAC Lwip Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2841">Introduction</a></li>
<li class="level1"><a href="#autotoc_md2842">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md2843">Configuring Syscfg</a></li>
<li class="level1"><a href="#autotoc_md2844">Iperf using LWIP</a><ul><li class="level2"><a href="#autotoc_md2845">Important Iperf Arguments:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2846">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md2847">Build the example</a></li>
<li class="level2"><a href="#autotoc_md2848">HW Setup</a></li>
<li class="level2"><a href="#autotoc_md2849">Create a network between EVM and host PC</a></li>
<li class="level2"><a href="#autotoc_md2850">Run the example</a></li>
<li class="level2"><a href="#autotoc_md2851">Sample output for ICSS-EMAC LWIP example</a></li>
<li class="level2"><a href="#autotoc_md2852">Communicate with the EVM using ethernet</a></li>
<li class="level2"><a href="#autotoc_md2853">Measuring the throughput using Iperf:</a></li>
<li class="level2"><a href="#autotoc_md2854">Sample output for iperf command</a></li>
<li class="level2"><a href="#autotoc_md2855">Troubleshooting issues</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2856">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_networking_icss_emac_lwip"></a></p>
<h1><a class="anchor" id="autotoc_md2841"></a>
Introduction</h1>
<dl class="section note"><dt>Note</dt><dd>lwIP features are made available as is from public lwIP project. SDK configuration may only enable and exercise a subset of these features.</dd></dl>
<p>This example is an ICSS-EMAC application using the LwIP networking stack.</p>
<p>The examples does the following:</p><ul>
<li>Initializes the ICSS-EMAC driver for the underlying HW</li>
<li>Initializes the LwIP stack</li>
<li>Allows users to run and test basic networking features like ping, iperf with TCP/UDP.</li>
<li>Allows users to configure between ICSS_EMAC Switch and MAC modes.</li>
<li>Example is configured to run in Switch mode.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2842"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263x-cc, am263x-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/networking/lwip/icss_emac_lwip   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2843"></a>
Configuring Syscfg</h1>
<ul>
<li>The following Syscfg parameters in the ICSS-EMAC instance should be changed to swap between Switch and EMAC examples.</li>
</ul>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Status/Value for MAC </th><th>Status/Value for Switch </th><th>Description </th><th>Remarks/Default Setting  </th></tr>
<tr>
<td>EMAC Mode </td><td>MAC1/MAC2/MAC1 of DUAL EMAC/MAC2 of DUAL EMAC </td><td>Switch </td><td>Parameter to choose between EMAC and Switch modes. </td><td>Default is Switch.  </td></tr>
<tr>
<td>RT/NRT Priority Separation Queue </td><td>QUEUE1 </td><td>QUEUE4 </td><td>If packets are in Queue &lt;= RT/NRT Priority separation queue, they will be forwarded to RT callback and others to NRT callback. </td><td>Default is QUEUE4.  </td></tr>
<tr>
<td>Learning Enable </td><td>DISABLED </td><td>ENABLED </td><td>Learning only applicable for Switch </td><td>Default is ENABLED.  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2844"></a>
Iperf using LWIP</h1>
<ul>
<li>Iperf is a tool for network performance measurement and tuning. It is a cross-platform tool that can produce standardized performance measurements for any network. Iperf has client and server functionality, and can create data streams to measure the throughput between the two ends in one or both directions.</li>
<li>Iperf version to be used is version 2.0.9-win64(on windows) and version 2.+ on linux(Ubuntu 18.04 64bit).</li>
<li>The lwip app has iperf enabled by default.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2845"></a>
Important Iperf Arguments:</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Argument  </th><th class="markdownTableHeadNone">Meaning   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-s  </td><td class="markdownTableBodyNone">Run server   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-c  </td><td class="markdownTableBodyNone">Run Client [Ex: -c 192.168.1.102]   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-u  </td><td class="markdownTableBodyNone">UDP   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-b  </td><td class="markdownTableBodyNone">Bandwidth [Used in UDP, Ex: 100M M-&gt;Mbits]   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-i  </td><td class="markdownTableBodyNone">Output interval in Sec [Ex: -i1 1sec interval]   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-t  </td><td class="markdownTableBodyNone">Time in sec [Ex: -t60 60sec]   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-p  </td><td class="markdownTableBodyNone">Port number [Ex: -p 5555]   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-w  </td><td class="markdownTableBodyNone">Windows size [Ex: -w 1M M-&gt;Mbits]   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-d  </td><td class="markdownTableBodyNone">Bi-directional traffic   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-l  </td><td class="markdownTableBodyNone">Length [Ex: -l 1046 1046bytes]   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-V  </td><td class="markdownTableBodyNone">Used when IPv6 address is used instead of IPv4   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2846"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md2847"></a>
Build the example</h2>
<ul>
<li>When using CCS projects to build, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li>When using makefiles to build, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2848"></a>
HW Setup</h2>
<dl class="section note"><dt>Note</dt><dd>Make sure you have setup the EVM with cable connections as shown here, <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a>. In addition do below steps.</dd></dl>
<h2><a class="anchor" id="autotoc_md2849"></a>
Create a network between EVM and host PC</h2>
<ul>
<li>The EVM will get an IP address of 192.168.0.200. Make sure to connect the other end of the cable to a network which is in the same sub-network.</li>
<li>To get started, create a simple local network between the EVM and the host PC as shown below.</li>
</ul>
<p> <style>div.image img[src="icss_emac_lwip_example_01.png"]{width:30%}</style> </p><div class="image">
<img src="icss_emac_lwip_example_01.png" alt=""/>
<div class="caption">
Local network between PC and EVM</div></div>
<ul>
<li>After we run the example on the EVM (in the next step), it will be assigned an IP address using which the host can communicate with the EVM.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2850"></a>
Run the example</h2>
<dl class="section attention"><dt>Attention</dt><dd>If you need to reload and run again, a CPU power-cycle is MUST</dd></dl>
<ul>
<li>Launch a CCS debug session and run the example executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>You will see logs in the UART terminal as shown in the next section.</li>
<li>Note the IP address seen in the log, this is what we will use to communicate with the EVM.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2851"></a>
Sample output for ICSS-EMAC LWIP example</h2>
<div class="fragment"><div class="line">MII mode</div>
<div class="line">Firmware load to PRU0 passed</div>
<div class="line">Firmware load to PRU1 passed</div>
<div class="line">Starting lwIP, local interface IP is 192.168.0.200</div>
<div class="line">[LWIPIF_LWIP_EMAC]Link is down[LWIPIF_LWIP_EMAC] Interface layer handle is Initialised </div>
<div class="line">[LWIPIF_LWIP_EMAC] NETIF INIT SUCCESS</div>
<div class="line">status_callback==UP, local interface IP is 192.168.0.200</div>
<div class="line">UDP server listening on port 5001</div>
<div class="line">link_callback==UP</div>
<div class="line">      5.653s : CPU load =   1.39 %</div>
<div class="line">     10.653s : CPU load =   0.56 %</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2852"></a>
Communicate with the EVM using ethernet</h2>
<ul>
<li>Firstly you can try to reach the EVM using ping as shown below, using a command shell on the host PC <pre class="fragment">  &gt; ping 192.168.0.200
</pre></li>
<li>Next you can run <code>iperf</code> tests as shown below. Below steps have been tried with a Windows 10 host PC running.<ul>
<li>Install <code>iperf</code> if not installed by doing below <pre class="fragment"> &gt; sudo apt install iperf
</pre></li>
<li>Invoke iperf to test TCP bi-directional RX+TX connection as shown below <div class="fragment"><div class="line">&gt; iperf -c 192.168.0.200 -i 5 -t 20 -d</div>
</div><!-- fragment --></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md2853"></a>
Measuring the throughput using Iperf:</h2>
<ul>
<li>Once we get the IP after running the example, we can use following iperf command on windows to get the throughput.<ul>
<li>iperf.exe -c 192.168.0.200 -r</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md2854"></a>
Sample output for iperf command</h2>
<p>DUT side:</p>
<div class="fragment"><div class="line">MII mode</div>
<div class="line">Firmware load to PRU0 passed</div>
<div class="line">Firmware load to PRU1 passed</div>
<div class="line">Starting lwIP, local interface IP is 192.168.0.200</div>
<div class="line">[LWIPIF_LWIP_EMAC]Link is down[LWIPIF_LWIP_EMAC] Interface layer handle is Initialised </div>
<div class="line">[LWIPIF_LWIP_EMAC] NETIF INIT SUCCESS</div>
<div class="line">status_callback==UP, local interface IP is 192.168.0.200</div>
<div class="line">UDP server listening on port 5001</div>
<div class="line">link_callback==UP</div>
<div class="line">      5.653s : CPU load =   1.39 %</div>
<div class="line">     10.653s : CPU load =   0.56 %</div>
<div class="line">     15.653s : CPU load =   0.56 %</div>
<div class="line">     20.653s : CPU load =   0.53 %</div>
<div class="line">     25.653s : CPU load =   0.53 %</div>
<div class="line">     30.653s : CPU load =   4.77 %</div>
<div class="line">     35.653s : CPU load =  90.97 %</div>
<div class="line">IPERF report: type=0, remote: 192.168.0.33:53365, total bytes: 86114328, duration in ms: 10056, kbits/s: 68504</div>
<div class="line">                             40.653s : CPU load =  90.87 %</div>
<div class="line">     45.653s : CPU load =  44.60 %</div>
<div class="line">IPERF report: type=1, remote: 192.168.0.33:5001, total bytes: 55255064, duration in ms: 10000, kbits/s: 44200</div>
<div class="line">                            50.653s : CPU load =  43.35 %</div>
<div class="line">     55.653s : CPU load =   0.54 % </div>
</div><!-- fragment --><p>PC Side:</p>
<div class="fragment"><div class="line">C:\ti\iperf-2.0.9-win64&gt;iperf -c 192.168.0.200 -r</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Server listening on TCP port 5001</div>
<div class="line">TCP window size:  208 KByte (default)</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Client connecting to 192.168.0.200, TCP port 5001</div>
<div class="line">TCP window size:  208 KByte (default)</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">[  4] local 192.168.0.33 port 53365 connected with 192.168.0.200 port 5001</div>
<div class="line">[ ID] Interval       Transfer     Bandwidth</div>
<div class="line">[  4]  0.0-10.0 sec  82.1 MBytes  68.8 Mbits/sec</div>
<div class="line">[  4] local 192.168.0.33 port 5001 connected with 192.168.0.200 port 54911</div>
<div class="line">[  4]  0.0-10.0 sec  52.7 MBytes  44.2 Mbits/sec </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2855"></a>
Troubleshooting issues</h2>
<ul>
<li>Refer to <a class="el" href="ICSS_EMAC_DEBUG_GUIDE.html">ICSS-EMAC Debug Guide</a> for troubleshooting issues.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2856"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
