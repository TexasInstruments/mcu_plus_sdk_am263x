<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: SBL CAN UNIFLASH</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SBL CAN UNIFLASH </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2725">Introduction</a></li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH_MCELF">SBL CAN Uniflash Multicore ELF</a></li>
<li class="level1"><a href="#autotoc_md2726">Protocol</a></li>
<li class="level1"><a href="#autotoc_md2727">Settings Used in this Application</a></li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH_STEPS">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md2728">See Also</a></li>
<li class="level1"><a href="#autotoc_md2729">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_sbl_can_uniflash"></a></p>
<h1><a class="anchor" id="autotoc_md2725"></a>
Introduction</h1>
<p>This is a flash-writer application which can boot the application as well. This works in conjunction with the can_uniflash.py python script. It uses bootloader APIs to do basic SOC initialization required to be able to flash binaries to the QSPI flash. Like other SBLs, this is also booted by the ROM bootloader.</p>
<p>Once the example starts running it attempts to receive files via CAN interface and process them in a loop. Once it receives a file (this is sent by the can_uniflash.py script), it finds out what to do with the received file from the file header. This can be primarily used for Flashing the received file at the given offset.</p>
<p> <style>div.image img[src="sbl_can_uniflash_process.PNG"]{width:60%}</style> </p><div class="image">
<img src="sbl_can_uniflash_process.PNG" alt=""/>
<div class="caption">
MCAN SBL CAN UNIFLASH Process</div></div>
<p>This bootloader runs in two steps:</p><ul>
<li>Flashing the SBL CAN UNIFLASH at offset 0x0 (Setup the EVM in UART Boot Mode)</li>
<li>Running the can_uniflash.py python script for sending the application image file. (Setup the EVM in QSPI Boot Mode)</li>
</ul>
<p> <style>div.image img[src="sbl_can_uniflash_flow.png"]{width:15%}</style> </p><div class="image">
<img src="sbl_can_uniflash_flow.png" alt=""/>
<div class="caption">
MCAN SBL CAN UNIFLASH Flow Overview</div></div>
<p>Refer <a class="el" href="EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH.html#EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH_STEPS">Steps to Run the Example</a></p>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH_MCELF"></a>
SBL CAN Uniflash Multicore ELF</h1>
<ul>
<li>For AM26xx devices, use the Multicore ELF project of SBL CAN Uniflash</li>
<li>To flash an <b>mcelf</b> file via CAN uniflash, use the project <b>examples/drivers/boot/sbl_can_uniflash_multicore_elf</b></li>
</ul>
<h1><a class="anchor" id="autotoc_md2726"></a>
Protocol</h1>
<p>A simple custom made protocol is created for communication between the Host Machine and the Board. Messages between a CAN bootloader host and the target use a simple command and acknowledge (ACK) protocol. The host sends a command and within a timeout period the target responds with an ACK.</p>
<p>The CAN Uniflash provides a short list of commands that are used during the flashing operation.</p>
<table class="doxtable">
<tr>
<th>Commands </th><th>Description  </th></tr>
<tr>
<td>PING </td><td>This command is used to receive an PONG command from the bootloader indicating that communication has been established.  </td></tr>
<tr>
<td>PONG </td><td>Returned as response to the initial PING command from the Bootloader   </td></tr>
<tr>
<td>DATA </td><td>To send data packets   </td></tr>
<tr>
<td>RUN </td><td>To run the application  </td></tr>
<tr>
<td>ACK </td><td>Response from the Bootloader on recieveing the CAN Packets  </td></tr>
<tr>
<td>LSTMSG </td><td>To indicate the last data packet of the application  </td></tr>
<tr>
<td>LSTMSGCF </td><td>Response from the Bootloader on recieveing the last data packet of the application  </td></tr>
</table>
<p>Please refer the image below:</p>
<p> <style>div.image img[src="sbl_can_custom_protocol.png"]{width:50%}</style> </p><div class="image">
<img src="sbl_can_custom_protocol.png" alt=""/>
<div class="caption">
SBL CAN Communication Protocol between Host Machine and the Board</div></div>
<h1><a class="anchor" id="autotoc_md2727"></a>
Settings Used in this Application</h1>
<p>In this application, the CAN settings are:</p><ul>
<li>Extended Identifier used</li>
<li>Make Sure to set correct timing parameters. Current parameters is as per SDK-CAN driver.<ul>
<li>BitrateFD : f_clock_mhz=80, nom_brp=1, nom_tseg1=67, nom_tseg2=12, nom_sjw=12, data_brp=1, data_tseg1=13, data_tseg2=2, data_sjw=1</li>
</ul>
</li>
<li>CAN-FD is supported</li>
<li>Refer to <a class="el" href="DRIVERS_MCAN_PAGE.html">MCAN</a>, for MCAN dependencies.</li>
</ul>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263x-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/boot/sbl_can_uniflash_multicore_elf   </td></tr>
</table>
<p><b>NOTE: Tested on Windows, using PCAN-USB Peripheral.</b></p>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_SBL_CAN_UNIFLASH_STEPS"></a>
Steps to Run the Example</h1>
<p>Since this is a bootloader, the example will be run every time you boot an application using this example. It is run from a QSPI boot media unlike other examples which are usually loaded with CCS. Nevertheless, you can build this example like you do for the others using makefile or build it via CCS by importing as a project.</p>
<ul>
<li><b>Example is tested using PCAN-USB module</b></li>
<li><b>Hardware Conectivity</b>, First make sure the connections to the PCAN-USB module to PC are proper. Connect the PCAN-USB module to PC from USB and Serial Port to be connected as mentioned in the image below.</li>
</ul>
<p> <style>div.image img[src="am263x_mcan_sbl_hw_connect.PNG"]{width:60%}</style> </p><div class="image">
<img src="am263x_mcan_sbl_hw_connect.PNG" alt=""/>
<div class="caption">
MCAN Hardware Connectivity with PCAN USB.</div></div>
<ul>
<li><b>Software Setup</b>, To use SBL CAN using PCAN-USB Peripheral,First Download and Install the PCAN-Driver from <a href="https://www.peak-system.com/Drivers.523.0.html?&L=1">https://www.peak-system.com/Drivers.523.0.html?&amp;L=1</a><ul>
<li>Peak Systems provides PCAN-Basic API for Connecting to CAN and CAN FD Buses. PCAN-Basic consists of the actual device driver and an interface DLL, which provides the API functions. It can be downloaded from here, <a href="https://www.peak-system.com/PCAN-Basic.239.0.html?&L=1">https://www.peak-system.com/PCAN-Basic.239.0.html?&amp;L=1</a></li>
<li>After downloading the PCAN-Basic, please extract it. PCAN-Basic directory contains <code>PCANBasic.py</code> python file, under <div class="fragment"><div class="line">.\pcan-basic\PCAN-Basic API\Include\PCANBasic.py</div>
</div><!-- fragment --></li>
<li>Create a folder named <code>pcan</code> at following location in SDK directory: <div class="fragment"><div class="line">${SDK_INSTALL_PATH}/tools/boot/pcan</div>
</div><!-- fragment --></li>
<li>We've to place this <code>PCANBasic.py</code> python file under this folder in SDK: <div class="fragment"><div class="line">${SDK_INSTALL_PATH}/tools/boot/pcan/PCANBasic.py</div>
</div><!-- fragment --></li>
<li><code>PCANBasic.dll</code> library needs to be installed in order to run applications that use this API. PCAN Device Driver application also installs <code>PCANBasic.dll</code> library. Please refer <a href="https://www.peak-system.com/produktcd/Develop/PC%20interfaces/Windows/PCAN-Basic%20API/ReadMe.txt">https://www.peak-system.com/produktcd/Develop/PC%20interfaces/Windows/PCAN-Basic%20API/ReadMe.txt</a> for more information on this.</li>
<li>Interface DLL file needs to be present in the following windows directory: <div class="fragment"><div class="line">  For x64 Windows systems:</div>
<div class="line">\x86\PCANBasic.dll --&gt; Windows\SysWOW64</div>
<div class="line">\x64\PCANBasic.dll --&gt; Windows\System32</div>
</div><!-- fragment --></li>
<li>One can use the Microsoft sigcheck tool (can be dowloaded from <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sigcheck">https://learn.microsoft.com/en-us/sysinternals/downloads/sigcheck</a>) to find out if your PCANBasic.dll file is 32 or 64 bit version. <div class="fragment"><div class="line">sigcheck.exe C:\Windows\SysWOW64\PCANBasic.dll</div>
</div><!-- fragment --></li>
</ul>
</li>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>After hardware and software setup follow below steps to run the example:<ul>
<li>First the SBL CAN bootloader will be flashed.</li>
<li>Create a flash configuration file, using the default flash configuration file present, at below as reference</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">${SDK_INSTALL_PATH}/tools/boot/sbl_prebuilt/{board}/default_sbl_can_uniflash.cfg</div>
</div><!-- fragment --><ul>
<li>In this config file, modify the paths to the flashing application and CAN bootloader, in case you are not using the pre-built applications</li>
</ul>
<div class="fragment"><div class="line">--flash-writer={path to flash application .tiimage}</div>
<div class="line">--file={path to CAN Uniflash .tiimage} --operation=flash --flash-offset=0x0</div>
</div><!-- fragment --><ul>
<li>Run below python command on the Windows command prompt (<code>cmd.exe</code>) or Linux bash shell to flash the files.</li>
</ul>
<div class="fragment"><div class="line">cd ${SDK_INSTALL_PATH}/tools/boot</div>
<div class="line">python uart_uniflash.py -p {name of your UART com port} --cfg={path to your edited config file}</div>
</div><!-- fragment --><ul>
<li>Refer to the page <a class="el" href="TOOLS_FLASH.html#BASIC_STEPS_TO_FLASH_FILES">Basic steps to flash files</a> for more information</li>
<li>After flashing the bootloader, Setup the EVM in QSPI Boot Mode.</li>
<li><b>CAN Uniflash Python Script</b></li>
<li>For sending the application image mcelf_sbl_can_uniflash_app.cfg can be editted with the path of the image of the desired application.</li>
<li>cfg file contains only one command with arguments like &ndash;file, &ndash;operation and &ndash;flash-offset. <br  />
 For AM263x, Default Flash Offset is at 0x80000. <div class="fragment"><div class="line">--file=C:/ti/mcu_plus_sdk_am263x_08_05_00_13/examples/drivers/ipc/ipc_rpmsg_echo/am263x-lp/system_freertos_nortos/ipc_rpmsg_echo_system.debug.mcelf --operation=flash --flash-offset=0x80000</div>
</div><!-- fragment --></li>
<li>The application image file is sent using <code>can_uniflash.py</code> python script:</li>
</ul>
<div class="fragment"><div class="line">cd ${SDK_INSTALL_PATH}/tools/boot</div>
<div class="line">python can_uniflash.py --cfg={path to your edited sbl_can_uniflash_app config file}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2728"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_BOOTLOADER_PAGE.html">BOOTLOADER</a></p>
<h1><a class="anchor" id="autotoc_md2729"></a>
Sample Output</h1>
<p>After sending the application image over CAN, logs can be seen on the UART terminal </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
