<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Smart Placement</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('SMART_PLACEMENT.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Smart Placement </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md757">What is Smart Placement?</a></li>
<li class="level1"><a href="#autotoc_md758">Theory of Smart Placement.</a><ul><li class="level2"><a href="#autotoc_md759">How is identify critical code?</a></li>
<li class="level2"><a href="#autotoc_md760">Why CPI of a function increases?</a></li>
<li class="level2"><a href="#autotoc_md761">How smart placement helps in improving performance</a><ul><li class="level3"><a href="#autotoc_md762">Providing variety of tools/method to determine critical functions</a></li>
<li class="level3"><a href="#autotoc_md763">Using TCM</a></li>
<li class="level3"><a href="#autotoc_md764">Removing unnecessary trampolines</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md765">Getting started with Smart Placement</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_tools_smart_placement"></a></p>
<h1><a class="anchor" id="autotoc_md757"></a>
What is Smart Placement?</h1>
<p>TI Sitara MCU have many different levels of memories with varying latency from CPU and peripherals, and while developing an application, it is required to place sections in different memories. Those sections whose destination memory is already known are placed in the targeted memory, however, other sections' destination memory may not be known. For example, in a control loop application, there would an ISRs/functions which would be there in the control path. Since these functions/ISRs are already known to be critical therefore, they are placed in the fastest memory to have maximum performance.</p>
<p>Smart placement is a name given to a process, using which functions and other linker-placed objects are distributed across different memories, while accounting for their criticality, directly from the source code.</p>
<h1><a class="anchor" id="autotoc_md758"></a>
Theory of Smart Placement.</h1>
<p>Following table list down memories in ascending order of access latency (not an exhaustive list of memories). Memory with minimum latency is the fastest memory.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Memory Name  </th><th class="markdownTableHeadNone">Memory Start Address  </th><th class="markdownTableHeadNone">Memory Size   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TCM-A  </td><td class="markdownTableBodyNone">0x0  </td><td class="markdownTableBodyNone">32KB (in split) or 64KB (in lockstep)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TCM-B  </td><td class="markdownTableBodyNone">0x8000  </td><td class="markdownTableBodyNone">32KB (in split) or 64KB (in lockstep)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OCRAM  </td><td class="markdownTableBodyNone">0x70000000  </td><td class="markdownTableBodyNone">2MB   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FLASH  </td><td class="markdownTableBodyNone">0x60000000  </td><td class="markdownTableBodyNone">External Flash   </td></tr>
</table>
<p>From the above table, this device has various memories which can store both code and data. Each memory differs from each other in terms of size and access latency therefore the placement of code and data will determine the performance of code.</p>
<h2><a class="anchor" id="autotoc_md759"></a>
How is identify critical code?</h2>
<p>This performance penalty is high in case code or data has to be placed in external memory (or FLASH). In this case, it is beneficial to not place data or code in the external flash that is not critical. Now the criticality of the code can be determined by various factors such as number of times a particular code or data is being accessed or based on the design decision.</p>
<p>Frequency of a function is number of times a function is called. A frequent function would be called a lot of times.</p>
<p>A function's runtime performance can be quantified by <code>Cycles Per Instruction (CPI)</code> i.e. average number of CPU cycles spent to execute one instruction of a function. Higher the CPI, sluggish is the runtime performance.</p>
<p>For a function that is called very frequently, usually CPI of that function should be less. Hence, to decide critical functions, two parameters are required to be at hand.</p>
<div class="image">
<img src="perf_graph.drawio.png" alt=""/>
</div>
<p>Red region is a region contains all the functions which are frequent and have high CPI. These functions are bottleneck. Green region contains functions which are frequent functions and have low CPI in a given system (without any optimizations). Yellow region contains functions whose performance improvement won't bring any significant improvement as they are not very frequent functions.</p>
<p>Optimization based on profiling should be done such that the result of optimization would bring functions from red regions to green region.</p>
<p>This can be achieved by placing function in red region in faster memory. However, because of limited size of faster memory, not all functions can move to green area. Because of this constraint, functions at top right corner of red region needs to be given more priority over function that is at bottom-left of red region. This priority number will indicative of how critical a function/code is.</p>
<h2><a class="anchor" id="autotoc_md760"></a>
Why CPI of a function increases?</h2>
<p>Memory latencies of a memory in which a function is stored is one of the main reason.</p>
<p>Whenever a cache miss happens, instruction/data corresponding to that cache miss would be fetched from a slower memory. If that function is not a cache friendly code, this would lead to high CPI number.</p>
<p>However, sometimes, a badly cached function can still perform better because pre-fetch hardware is able to prefetch most of the instructions. However, these cases are rare and still branch miss-prediction will always increase CPI number.</p>
<p>Therefore, in most cases, increased CPI numbers indicates high cache miss rate as well.</p>
<h2><a class="anchor" id="autotoc_md761"></a>
How smart placement helps in improving performance</h2>
<h3><a class="anchor" id="autotoc_md762"></a>
Providing variety of tools/method to determine critical functions</h3>
<p>There are many ways to determine critical function. They are provided and can be read at <a class="el" href="SMART_PLACEMENT_GETTING_STARTED.html">Getting Started With Smart Placement</a>. Reason of providing this is to make smart placement more usable.</p>
<h3><a class="anchor" id="autotoc_md763"></a>
Using TCM</h3>
<p>TCM is tightly coupled memory and is fastest. This memory is also non-cached. Therefore, after identifying priority critical functions, those functions can be placed in TCM. This would not only improve function's CPI but would also lead to reduced cached miss rate.</p>
<h3><a class="anchor" id="autotoc_md764"></a>
Removing unnecessary trampolines</h3>
<div class="image">
<img src="smart_placement_am263x_0.png" alt=""/>
</div>
<p>In above diagram, F1 is a critical function which internally calls F2, F3 and F4. However, because F2, F3 and F4 are placed far away in memory, they cannot be called directly but rather trampolines has be inserted in order to call them. This further reduces the performance. Applying smart placement, not only placed F1 function in faster memory, but also its internally called function, which are also critical function in this case. This also removed trampolines.</p>
<h2><a class="anchor" id="autotoc_md765"></a>
Getting started with Smart Placement</h2>
<p>To get started with smart placement, please go through <a class="el" href="SMART_PLACEMENT_GETTING_STARTED.html">Getting Started With Smart Placement</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
