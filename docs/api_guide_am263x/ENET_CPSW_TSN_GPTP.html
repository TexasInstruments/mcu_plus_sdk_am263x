<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Ethernet TSN and gPTP Stack - API and Integration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ENET_CPSW_TSN_GPTP.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ethernet TSN and gPTP Stack - API and Integration Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md555">Pre-requisites</a></li>
<li class="level1"><a href="#autotoc_md556">Introduction</a></li>
<li class="level1"><a href="#autotoc_md557">Demo and Examples</a></li>
<li class="level1"><a href="#autotoc_md558">TSN Stack</a><ul><li class="level2"><a href="#autotoc_md559">Compilation</a></li>
<li class="level2"><a href="#autotoc_md560">Modules</a></li>
<li class="level2"><a href="#ENET_CPSW_TSN_STACK_INITIALIZATION">Stack Initialization</a></li>
<li class="level2"><a href="#ENET_CPSW_TSN_LOGGING">Logging</a></li>
<li class="level2"><a href="#ENET_CPSW_TSN_UNICONF_INITIALIZATION">Starting uniconf and gPTP</a></li>
<li class="level2"><a href="#ENET_CPSW_TSN_STACK_DEINITIALIZATION">TSN Deinitialization</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md561">Integration</a><ul><li class="level2"><a href="#ENET_CPSW_TSN_SOURCE_INTEGRATION">Source integration</a></li>
<li class="level2"><a href="#ENET_CPSW_TSN_UNICONF_CONFIGURATION">Uniconf configuration</a></li>
<li class="level2"><a href="#ENET_CPSW_TSN_YANG_CONFIG_PARAMS">gPTP Yang Config Parameters</a><ul><li class="level3"><a href="#autotoc_md562">gPTP string-based to key-based mapping</a></li>
<li class="level3"><a href="#autotoc_md563">ieee1588-ptp-tt_access.c/h</a></li>
<li class="level3"><a href="#autotoc_md564">Default example configurations</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md565">gPTP Non-Yang Config Parameters</a><ul><li class="level3"><a href="#autotoc_md566">gptpgcfg wrapper APIs to modify Non-Yang parameter</a></li>
<li class="level3"><a href="#autotoc_md567">Default example configurations</a></li>
<li class="level3"><a href="#autotoc_md568">gPTP Multiple Domains</a></li>
<li class="level3"><a href="#autotoc_md569">gPTP Shorter Sync Interval</a></li>
<li class="level3"><a href="#autotoc_md570">gPTP Performance optimization</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md571">Limitations</a></li>
<li class="level1"><a href="#autotoc_md572">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_networking_enet_cpsw_tsn_gptp_apiguide"></a></p>
<h1><a class="anchor" id="autotoc_md555"></a>
Pre-requisites</h1>
<p>Reader are expected to have basic knowledge on below IEEE specifications</p><ul>
<li>Standard ethernet (IEEE 802.1)</li>
<li>Timing and Synchronization for Time-Sensitive Applications - gPTP (IEEE 802.1AS-2020)</li>
<li>Forwarding and Queuing Enhancements for Time-Sensitive Streams (IEEE 802.1Qav)</li>
<li>Enhancements for Scheduled Traffic (IEEE 802.1Qbv)</li>
<li>Frame Preemption (IEEE 802.1Qbu)</li>
<li>YANG Data Modeling Language (rfc7950)</li>
</ul>
<h1><a class="anchor" id="autotoc_md556"></a>
Introduction</h1>
<p>This guide is intended to enhance user's understanding of the TSN stack and provide guidance on how to seamlessly integrate TSN modules into their own applications.</p>
<h1><a class="anchor" id="autotoc_md557"></a>
Demo and Examples</h1>
<p><a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_BRIDGE.html">Ethernet TSN CPSW gPTP Bridge Example</a></p>
<p><a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_TR.html">Ethernet TSN CPSW gPTP TimeReceiver (gPTP Slave) Example</a></p>
<p><a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_TT.html">Ethernet TSN CPSW gPTP TimeTransmitter (gPTP Master) Example</a></p>
<h1><a class="anchor" id="autotoc_md558"></a>
TSN Stack</h1>
<h2><a class="anchor" id="autotoc_md559"></a>
Compilation</h2>
<p>TSN stack library is pre-built in SDK and located in <code>&lt;mcu_plus_sdk&gt;/source/networking/enet/core/examples/tsn</code> directory as .lib files. Any changes in the stack source code needs rebuild of library. In order to re-build the library, follow the below steps- </p><div class="fragment"><div class="line">cd  &lt;mcu_plus_sdk&gt;</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=debug libs-clean</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=release libs-clean</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=debug libs</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=release libs</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md560"></a>
Modules</h2>
<p>The TSN Stack library is composed of the following source modules:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Module Name  </th><th class="markdownTableHeadNone">lcoation  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Unibase  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_unibase</code>  </td><td class="markdownTableBodyNone">Universal utility libraries that are platform-independent   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Combase  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_combase</code>  </td><td class="markdownTableBodyNone">Communication utility libraries that provide support for functions like sockets, mutexes, and semaphores   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Uniconf  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_uniconf</code>  </td><td class="markdownTableBodyNone">Universal configuration daemon for Yang, provides APIs for developing a client application which retreives/writes yang parameters from/to database   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">gPTP  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_gptp</code>  </td><td class="markdownTableBodyNone">Implementation of the IEEE 802.1 AS gptp protocol   </td></tr>
</table>
<h2><a class="anchor" id="ENET_CPSW_TSN_STACK_INITIALIZATION"></a>
Stack Initialization</h2>
<p>A reference example of the TSN stack initialization can be found in <code>&lt;mcu_plus_sdk&gt;/source/networking/enet/core/examples/tsn/tsninit.c</code>. Prior to any module calls, it is necessary to initialize the unibase library once. This can be achieved by invoking the <code>EnetApp_initTsnByCfg()</code> function.</p>
<h2><a class="anchor" id="ENET_CPSW_TSN_LOGGING"></a>
Logging</h2>
<p>By default, TSN logs are directed to STDOUT using the fwrite function: <code>fwrite(str, 1, strlen(str), stdout);</code> However, it is possible to customize the log output by setting the <code>Logger_init(cfg-&gt;consoleOutCb)</code> callback during the initialization of the unibase library in the <code>EnetApp_initTsnByCfg()</code> function.</p>
<p>When a callback function is assigned to <code>consoleOutCb</code> it takes a significant amount of time to log to the output device, it is advisable to log to a buffer and utilize another task to log from the buffer to the desired output device. This approach helps to prevent log delays that could adversely affect the gPTP task, such as incorrect <em>Sync</em> and <em>FollowUp</em> intervals. The option to log to a buffer is supported when the <code>TSN_USE_LOG_BUFFER</code> macro is defined.</p>
<p>To enable specific log levels, you can modify the ub_log_initstr parameter in the <code>EnetApp_initTsnByCfg(</code>) function. There are eight log levels available:: </p><div class="fragment"><div class="line">UBL_NONE = 0</div>
<div class="line">UBL_FATAL = 1</div>
<div class="line">UBL_ERROR = 2</div>
<div class="line">UBL_WARN = 3</div>
<div class="line">UBL_INFO = 4</div>
<div class="line">UBL_INFOV = 5</div>
<div class="line">UBL_DEBUG = 6</div>
<div class="line">UBL_DEBUGV = 7</div>
</div><!-- fragment --><p>For example: <code>init_para.ub_log_initstr = "4,ubase:45,cbase:45,gptp:55,uconf:45";</code></p>
<p>In the above example, <code>uconf:45</code> signifies the following:</p>
<p><code>4 (INFO)</code>: Log level for printing to the console. <code>5 (INFOV)</code>: Log level for storing in internal memory (which can be dumped to a file).</p>
<p>Please note that enabling the DEBUG or DEBUGV level will result in a large number of logs being generated. If the log buffer is used, it may overflow, causing some logs to be lost.</p>
<p>The first '4' character in <code>"4,ubase...</code> represents the default log level applied to all modules.</p>
<h2><a class="anchor" id="ENET_CPSW_TSN_UNICONF_INITIALIZATION"></a>
Starting uniconf and gPTP</h2>
<p>The gPTP functionality operates in a separate task, alongside the universal configuration daemon "uniconf". To start these tasks, use the <code>EnetApp_startTsn()</code> in tsninit.c as reference .</p>
<p>This function will start the uniconf and gPTP tasks.</p>
<h2><a class="anchor" id="ENET_CPSW_TSN_STACK_DEINITIALIZATION"></a>
TSN Deinitialization</h2>
<p>To deinitialize the TSN modules, you can invoke the <code>EnetApp_stopTsn();</code> and <code>EnetApp_deInitTsn();</code> functions.</p>
<h1><a class="anchor" id="autotoc_md561"></a>
Integration</h1>
<h2><a class="anchor" id="ENET_CPSW_TSN_SOURCE_INTEGRATION"></a>
Source integration</h2>
<p>To integrate the TSN stack into your application, follow these steps:</p>
<ul>
<li><p class="startli">Initialize Enet LLD and setup board dependencies. In the TSN example application, the initialization routines can be found at <code>&lt;mcu_plus_sdk&gt;/source/networking/enet/core/examples/tsn/tsnapp_cpsw_main.c.c</code>, which can be used as reference.</p>
<p class="startli">The main functions related to EVM board initialization are:: </p><div class="fragment"><div class="line">EnetAppUtils_enableClocks();</div>
<div class="line">EnetApp_driverInit();</div>
<div class="line">EnetApp_driverOpen();</div>
<div class="line">...</div>
</div><!-- fragment --><p class="startli">These functions are responsible for configuring pinmux, GPIOs, etc., as well as providing the MAC port and PHY configuration parameters, which are board specific.</p>
</li>
<li>Before calling any TSN module APIs, ensure you initialize TSN by calling <code>EnetApp_initTsnByCfg()</code>.</li>
<li>Initialize the <em>combase</em> Ethernet device table as the following code snippet::</li>
</ul>
<div class="fragment"><div class="line">for (i = 0; i &lt; gEnetAppCfg.numMacPort; i++)</div>
<div class="line">{</div>
<div class="line">    snprintf(&amp;g_netdevices[i][0], CB_MAX_NETDEVNAME, &quot;tilld%d&quot;, i);</div>
<div class="line">    ethdevs[i].netdev = g_netdevices[i];</div>
<div class="line">    ethdevs[i].macport = gEnetAppCfg.macPorts[i];</div>
<div class="line">    memcpy(ethdevs[i].srcmac, gEnetAppCfg.macAddr, ENET_MAC_ADDR_LEN);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cb_lld_init_devs_table(ethdevs, i, enetType, instId);</div>
</div><!-- fragment --><p>In the above code, the Ethernet device name and MAC port are required to create a virtual Ethernet device table that facilitates the conversion between the device name and the MAC port number.</p>
<p>In the above code, the Ethernet device name and MAC port are required to create a virtual Ethernet device table that facilitates the conversion between the device name and the MAC port number.</p>
<p>Please ensure that the <code>ethdevs[i].netdev</code> pointer points to a global memory location rather than a stack memory. The <em>combase</em> layer will reference this address instead of making a copy.</p>
<p>If the "ethdevs[i].srcmac" is either unset or set to all zeroes, the "combase" will allocate a source MAC address. If the user's application requires manual assignment of a source MAC address to the interface, please ensure to set the "ethdevs[i].srcmac" variable accordingly.</p>
<ul>
<li>To provide syscfg values to the TSN stack, you can use the <code><a class="el" href="group__lld__ethernet.html#ga1df9e6ac302f841bb59e48fc913f3984" title="This function sets the callback for updating LLD config parameters. It enables the user to update con...">cb_socket_set_lldcfg_update_cb()</a></code>` The parameter for this function is a callback function that updates the <a class="el" href="structcb__socket__lldcfg__update__t.html" title="Structure representing the cb_socket_lldcfg_update instance.">cb_socket_lldcfg_update_t</a> values.</li>
<li>Start the gPTP task by calling <code>EnetApp_startTsn()</code>. This will start the necessary threads for gPTP and uniconf. The uniconf, gPTP tasks are stored in <code>EnetApp_ModuleCtx_t gModCtxTable</code> task's table.</li>
</ul>
<h2><a class="anchor" id="ENET_CPSW_TSN_UNICONF_CONFIGURATION"></a>
Uniconf configuration</h2>
<p>Universal configuration daemon for Yang, provides APIs for developing a client application which retreives/writes yang parameters from/to database and ask the uniconf for configurating HW.</p>
<p>Uniconf supports the following config paramaters:</p>
<div class="fragment"><div class="line">typedef struct ucman_data {</div>
<div class="line">    const char *dbname;</div>
<div class="line">    const char **configfiles;</div>
<div class="line">    int numconfigfile;</div>
<div class="line">    uint8_t ucmode;</div>
<div class="line">    bool *stoprun;</div>
<div class="line">    int rval;</div>
<div class="line">    UC_NOTICE_SIG_T *ucmanstart;</div>
<div class="line">    const char *hwmod;</div>
<div class="line">} ucman_data_t;</div>
</div><!-- fragment --><ul>
<li><code>dbname</code>: Specify the path of database file in the file system. If user wants to write all config parameters to database file to make the config parameter persist after a reboot, the full path of database file must be set via this parameter. Currently, as file system is not supported, this parameter is set to <code>NULL</code>.</li>
<li><code>configfiles</code>: array of runtime config files will be used by the uniconf. Run time config file is a text file which has one-to-one mapping with yang files, the format of each line of a run time config file is specified under <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_uniconf/README.org</code>. Currently, as file system is not supported, this parameter is set to <code>NULL</code>.</li>
<li><code>numofconfigfile</code>: Specify how many config files have been set via the the <code>configfiles</code> array above. Currently, this parameter is set to <code>0</code>.</li>
<li><code>ucmode</code>: This is for setting the expected mode of uniconf. The uniconf can only run in a separated thread, please set <code>UC_CALLMODE_THREAD|UC_CALLMODE_UNICONF</code> for this parameter.</li>
<li><code>stoprun</code>: Address to a flag which signals the uniconf to stop in case the flag is true.</li>
<li><code>rval</code>: Error code of the uniconf in case error occurs.</li>
<li><code>ucmanstart</code>: The name of semaphore or a semaphore object in case of FreeRTOS. If this parameter is not <code>NULL</code>, the uniconf will post this semaphore to signal application layer indicating that it has been started successfully.</li>
<li><code>hwmod</code>: Configure the HW for the uniconf. If an empty string is specified (hwmod=""), it means the uniconf will configure HW. If "NONE" is specified (hwmod="NONE"), the uniconf will not configure HW when client side writes the database and ask it for an update.</li>
</ul>
<h2><a class="anchor" id="ENET_CPSW_TSN_YANG_CONFIG_PARAMS"></a>
gPTP Yang Config Parameters</h2>
<p>This section describes the standard Yang parameters utilized for gPTP.</p>
<p>This implementation assumes user familiarity with the IEEE 1588 and 802.1AS YANG standards, and the mapping of these standards to our key-based enumeration. The gptp stack is developed based on below YANG standard:</p>
<ul>
<li>ieee1588: <a href="https://github.com/YangModels/yang/blob/main/standard/ieee/published/1588/ieee1588-ptp-tt.yang">https://github.com/YangModels/yang/blob/main/standard/ieee/published/1588/ieee1588-ptp-tt.yang</a></li>
<li>802.1AS: <a href="https://github.com/YangModels/yang/blob/main/standard/ieee/published/802.1/ieee802-dot1as-gptp.yang">https://github.com/YangModels/yang/blob/main/standard/ieee/published/802.1/ieee802-dot1as-gptp.yang</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md562"></a>
gPTP string-based to key-based mapping</h3>
<p>First of all, the key-based (uint8_t) enums which are used to map with YANG (string-based) are generated during initialization. For example, the corresponding ptp generated enum are defined in <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_uniconf/yangs/cores/generated/ieee1588-ptp-tt.h</code></p>
<p>This section will explain on how to map between generated key-based and string-based.</p>
<p>Consider priority1 (assuming 248) in ieee1588-ptp-tt.yang, which should have string-based like below:</p>
<p><code>/ieee1588-ptp-tt/ptp/instances/instance|instance-index:0|/default-ds/priority1</code></p>
<p>The corresponding key-based array for priority1 will be: </p><div class="fragment"><div class="line">k[0]=IEEE1588_PTP_TT_RW</div>
<div class="line">k[1]=IEEE1588_PTP_TT_PTP</div>
<div class="line">k[2]=IEEE1588_PTP_TT_INSTANCES</div>
<div class="line">k[3]=IEEE1588_PTP_TT_INSTANCE</div>
<div class="line">k[4]=IEEE1588_PTP_TT_DEFAULT_DS</div>
<div class="line">k[5]=IEEE1588_PTP_TT_PRIORITY1</div>
</div><!-- fragment --><ul>
<li>RW/RO entry: The <code>k[0]</code> is IEEE1588_PTP_TT_RW to indicate the entry is configurable, similar with YANG model <code>config true;</code>.</li>
</ul>
<p>User must take note and understand the YANG standard, to understand the entry is configurable or not.</p>
<p>In our example, the setting 'true' in <code>EnetApp_DbKeyVal_IntItem_t</code> is to indicate whether the entry is RW or RO.</p>
<ul>
<li>The list's key <code>|instance-index:0|</code>: will be described in next section, together with <code>ieee1588-ptp-tt_access.*</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md563"></a>
ieee1588-ptp-tt_access.c/h</h3>
<p>Beside of generated files eg:ieee1588-ptp-tt.h, there is APIs helper for each YANG generated file, named *access.h/c. Eg: for ieee1588-ptp-tt.yang, the corresponding helper will be ieee1588-ptp-tt_access.c/h.</p>
<p>The <code>ieee1588-ptp-tt_access</code> provide wrapper APIs for quicker access <code>ieee1588-ptp-tt</code> entries. Consider below set of APIs:</p>
<div class="fragment"><div class="line">int ydbi_get_item_ptk3vk0(yang_db_item_access_t *ydbia, void **rval, uint32_t instIndex,</div>
<div class="line">              uint8_t k1, uint8_t k2, uint8_t k3, bool status);</div>
<div class="line"> </div>
<div class="line">int ydbi_rel_item_ptk3vk0(yang_db_item_access_t *ydbia, uint8_t instIndex,</div>
<div class="line">              uint8_t k1, uint8_t k2, uint8_t k3, bool status);</div>
<div class="line"> </div>
<div class="line">int ydbi_set_item_ptk3vk0(yang_db_item_access_t *ydbia, uint8_t instIndex,</div>
<div class="line">              uint8_t k1, uint8_t k2, uint8_t k3,</div>
<div class="line">              bool status, void *value, uint32_t vsize, uint8_t notice);</div>
<div class="line">int ydbi_del_item_ptk3vk0(yang_db_item_access_t *ydbia, uint8_t instIndex,</div>
<div class="line">              uint8_t k1, uint8_t k2, uint8_t k3,</div>
<div class="line">              bool status);</div>
</div><!-- fragment --><p>The suffix of <code>ptk3vk0</code> can be extracted into 3 parts:</p><ul>
<li><code>pt</code> is for ieee1588-ptp-tt</li>
<li><code>k3</code> means the input will have 3 keys and</li>
<li><code>vk0</code> no value key after <code>instance-index</code></li>
</ul>
<p>The <code>uint32_t instIndex</code> is used to get corresponding <code>|instance-index:0|</code> which we need in previous section. Please refer to <code>set_dpara_k4vk1</code> for more detail of using instIndex.</p>
<p>The higher level DB API wrapper, which is using specificly for gptp, is defined in <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_gptp/gptpconf/gptpgcfg.h</code>.</p>
<h3><a class="anchor" id="autotoc_md564"></a>
Default example configurations</h3>
<p>Let's walk-through all of yang configuration those are using in <code>&lt;mcu_plus_sdk&gt;/source/networking/enet/core/examples/tsn/gptp_init.c</code>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">KEY  </th><th class="markdownTableHeadCenter">Refer YANG's items  </th><th class="markdownTableHeadNone">Short Explain   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_LOG_ANNOUNCE_INTERVAL  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:log-announce-interval  </td><td class="markdownTableBodyNone">Logarithm to the base 2 (log2(x)) of Announce Interval   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_ANNOUNCE_RECEIPT_TIMEOUT  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:announce-receipt-timeout  </td><td class="markdownTableBodyNone">same with GPTP Cap timeout, apply for Announce packets   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_INITIAL_LOG_ANNOUNCE_INTERVAL  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:log-announce-interval  </td><td class="markdownTableBodyNone">Default Init log2(x) of Announce Interval   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_INITIAL_LOG_SYNC_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:initial-log-sync-interval  </td><td class="markdownTableBodyNone">Default Init log2(x) of Sync Interval   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_LOG_SYNC_INTERVAL  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:log-sync-interval  </td><td class="markdownTableBodyNone">log2(x) of Sync Interval   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_SYNC_RECEIPT_TIMEOUT  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:sync-receipt-timeout  </td><td class="markdownTableBodyNone">same with GPTP Cap timeout, apply for Sync packets   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_CURRENT_LOG_SYNC_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:current-log-sync-interval  </td><td class="markdownTableBodyNone">Current value of log-sync-interval   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_INITIAL_LOG_PDELAY_REQ_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:initial-log-pdelay-req-interval  </td><td class="markdownTableBodyNone">Default Init log2(x) of PdelayReq Interval   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_CURRENT_LOG_PDELAY_REQ_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:current-log-pdelay-req-interval  </td><td class="markdownTableBodyNone">Current value of log-pdelay-req-interval   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_INITIAL_LOG_GPTP_CAP_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:initial-log-gptp-cap-interval  </td><td class="markdownTableBodyNone">Default Init log2(x) of GptpCapable Interval   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_USE_MGT_LOG_GPTP_CAP_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:use-mgt-log-gptp-cap-interval  </td><td class="markdownTableBodyNone">False: Allow gptp-cap-interval can be changed by message Interval Request Signaling and True: Not allow, use default mgt-log-gptp-cap-interval   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_MGT_LOG_GPTP_CAP_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:mgt-log-gptp-cap-interval  </td><td class="markdownTableBodyNone">Default value in case of use-mgt-log-gptp-cap-interval is False   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_GPTP_CAP_RECEIPT_TIMEOUT  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:gptp-cap-receipt-timeout  </td><td class="markdownTableBodyNone">GPTP Capable timeout time = Cap Interval * gptp-cap-receipt-timeout   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_CURRENT_LOG_GPTP_CAP_INTERVAL  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:current-log-gptp-cap-interval  </td><td class="markdownTableBodyNone">Current gptp-cap-interval value   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_ALLOWED_LOST_RESPONSES  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:allowed-lost-responses  </td><td class="markdownTableBodyNone">Maximum number of lost Pdelay_Respond/Follow_up of a PdelayRequest   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_ALLOWED_FAULTS  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:allowed-faults  </td><td class="markdownTableBodyNone">Number of faults above which asCapable is set to false   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_MEAN_LINK_DELAY_THRESH  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:mean-link-delay-thresh  </td><td class="markdownTableBodyNone">Threshold of a pdelay calculated. If it's higher than this threshold, port is not consider capable   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_PORT_ENABLE  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:port-enable  </td><td class="markdownTableBodyNone">Must be True   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_MINOR_VERSION_NUMBER  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:minor-version-number  </td><td class="markdownTableBodyNone">Minor PTP version number   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_INITIAL_ONE_STEP_TX_OPER  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:initial-one-step-tx-oper  </td><td class="markdownTableBodyNone">Init value of using one-step-tx, in our stack, we ONLY apply two-step-tx, so the value must be False   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_CURRENT_ONE_STEP_TX_OPER  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:current-one-step-tx-oper  </td><td class="markdownTableBodyNone">Current value of one-step-tx   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_MGT_ONE_STEP_TX_OPER  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:mgt-one-step-tx-oper  </td><td class="markdownTableBodyNone">Default case one-step-tx if use-mgt-one-step-tx-oper is true   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_USE_MGT_ONE_STEP_TX_OPER  </td><td class="markdownTableBodyCenter">ieee802-dot1as-gptp:use-mgt-one-step-tx-oper  </td><td class="markdownTableBodyNone">Must be False as we do not support one-step-tx   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_PRIORITY1  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:priority1  </td><td class="markdownTableBodyNone">Use to configure ptp priority1   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_PRIORITY2  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:priority2  </td><td class="markdownTableBodyNone">Use to configure ptp priority2   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_EXTERNAL_PORT_CONFIG_ENABLE  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:external-port-config-enable  </td><td class="markdownTableBodyNone">We are not allow external-port-config-enable, so it should be False   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_TIME_SOURCE  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:time-source  </td><td class="markdownTableBodyNone">Config time-source, refer YANG for possible value   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_PTP_TIMESCALE  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:ptp-timescale  </td><td class="markdownTableBodyNone">Config ptp-timescale, refer YANG for possible value   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_CLOCK_CLASS  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:clock-class  </td><td class="markdownTableBodyNone">Config clock-class, refer YANG for possible value   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_CLOCK_ACCURACY  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:clock-accuracy  </td><td class="markdownTableBodyNone">Config clock-accuracy, refer YANG for possible value   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_OFFSET_SCALED_LOG_VARIANCE  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:offset-scaled-log-variance  </td><td class="markdownTableBodyNone">Config offset-scaled-log-variance, refer YANG for possible value   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_INGRESS_LATENCY  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:ingress-latency  </td><td class="markdownTableBodyNone">Config this if you know the internal ingress-latency of a rx ptp packets. Currently the value is 0   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">IEEE1588_PTP_TT_EGRESS_LATENCY  </td><td class="markdownTableBodyCenter">ieee1588-ptp-tt:egress-latency  </td><td class="markdownTableBodyNone">Config this if you know the internal egress-latency of a tx ptp packets. Currently the value is 0   </td></tr>
</table>
<p>For more accessible parameters along with the default values in gPTP example, please refer to the file located at: -<code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_gptp/gptpconf/gptp-yangconfig.xml</code>.</p>
<h2><a class="anchor" id="autotoc_md565"></a>
gPTP Non-Yang Config Parameters</h2>
<p>In addition to the standard Yang parameters, gPTP also includes a set of non-Yang configuration parameters that are specific to its implementation.</p>
<h3><a class="anchor" id="autotoc_md566"></a>
gptpgcfg wrapper APIs to modify Non-Yang parameter</h3>
<p>To modify the default value of the Non-Yang parameters, please refer to the <code>gptp_nonyang_config()</code> function in the <code>gptp_init.c</code> file. This function will invokes <code>gptpgcfg_set_item()</code> to configure each params:</p>
<div class="fragment"><div class="line">int gptpgcfg_set_item(uint8_t gptpInstanceIndex, uint8_t confitem,</div>
<div class="line">                        bool status, void *value, uint32_t vsize);</div>
</div><!-- fragment --><ul>
<li><code>gptpInstanceIndex</code> : Index of the gptp to be configured. For TI FreeRTOS there is only one instance is applicable, this should be set to 0.</li>
<li><code>confitem</code>: The configuration item. To create an item, prepend the parameter name from the gptp_nonyangconfig.xml with the "XL4_EXTMOD_XL4GPTP" prefix, as follows: "USE_HW_PHASE_ADJUSTMENT" becomes "XL4_EXTMOD_XL4GPTP_USE_HW_PHASE_ADJUSTMENT."</li>
<li><code>status</code>: <code>YDBI_CONFIG</code> or <code>YDBI_STATUS</code>. <code>YDBI_CONFIG</code> is used to configure the parameter at runtime. <code>YDBI_STATUS</code> is used to configure the parameter at runtime and store the value in the database for persistence.</li>
<li><code>value</code>: Pointer to the value to be set.</li>
<li><code>vsize</code>: Size of the value to be set, for the items.</li>
</ul>
<p>Example usage: <code>gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_USE_HW_PHASE_ADJUSTMENT, YDBI_CONFIG, &amp;use_hwphase, sizeof(use_hwphase));</code></p><ul>
<li>As a reference, please consult the <code>&lt;mcu_plus_sdk&gt;/source/networking/enet/core/examples/tsn/gptp_init.c</code> file.</li>
<li>The configuration must be done before calling the <code>gptpman_run()</code> function inside the <code>gptp_init.c</code> file, and it should follow the the gptpgcfg_init function call.</li>
</ul>
<h3><a class="anchor" id="autotoc_md567"></a>
Default example configurations</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">KEY  </th><th class="markdownTableHeadLeft">Short Explain   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SINGLE_CLOCK_MODE  </td><td class="markdownTableBodyLeft">Set 1 for single clock with multiple ports   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">USE_HW_PHASE_ADJUSTMENT  </td><td class="markdownTableBodyLeft">Set 1 to make the adjustment apply on HW clock   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">FREQ_OFFSET_IIR_ALPHA_START_VALUE  </td><td class="markdownTableBodyLeft">ptp clock offset and freq adjustment IIR filter coefficients reciprocal number is used at the beginning   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">FREQ_OFFSET_IIR_ALPHA_STABLE_VALUE  </td><td class="markdownTableBodyLeft">ptp clock offset and freq adjustment IIR filter coefficients reciprocal number is used after stable time   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PHASE_OFFSET_IIR_ALPHA_START_VALUE  </td><td class="markdownTableBodyLeft">ptp clock offset and freq adjustment IIR filter coefficients reciprocal number is used at the beginning   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PHASE_OFFSET_IIR_ALPHA_STABLE_VALUE  </td><td class="markdownTableBodyLeft">ptp clock offset and freq adjustment IIR filter coefficients reciprocal number is used after stable time   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MAX_DOMAIN_NUMBER  </td><td class="markdownTableBodyLeft">Support up to 2 domains   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">QUICK_SYNC_ALGO  </td><td class="markdownTableBodyLeft">Enables the slave clock to match the master's rate before applying phase offset adjustments.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SKIP_FREQADJ_COUNT_MAX  </td><td class="markdownTableBodyLeft">Number of Sync message cycle in which freq adjustment will be skipped after offset has just been adjusted.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PHASE_OFFSET_ADJUST_BY_FREQ  </td><td class="markdownTableBodyLeft">Sets the phase offset adjustment threshold in nanoseconds.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">FREQ_OFFSET_STABLE_PPB  </td><td class="markdownTableBodyLeft">Stable adjustment determination and thresholds freq. adjustment is considered stable if delta of adj rate is less then this threshold   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">FREQ_OFFSET_UPDATE_MRATE_PPB  </td><td class="markdownTableBodyLeft">update freq offset only when the abs of diff to the new rate is bigger than this   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">STATIC_PORT_STATE_SLAVE_PORT  </td><td class="markdownTableBodyLeft">-1: Enable BMCA mode, 0: Disable BMCA and all ports are GM, &gt;0: Disable BMCA, the selected port is Slave port, and other ports are master port   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SUPPORT_RUNTIME_NOTICE_CHECK  </td><td class="markdownTableBodyLeft">Enable this flag, then gptp stack will listener for event to trigger Message Interval Request signaling to the other side   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CLOCK_COMPUTE_INTERVAL_MSEC  </td><td class="markdownTableBodyLeft">compute phase and freq every this time   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CMLDS_MODE  </td><td class="markdownTableBodyLeft">In case of number of domain is 2, CMLDS_MODE must be True to apply common link delay   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SECOND_DOMAIN_THIS_CLOCK  </td><td class="markdownTableBodyLeft">In case of number of domain is 2, this flag also need to be set to one to indicate software clock mode   </td></tr>
</table>
<p>To access the list of these parameters, along with their descriptions and default values for gPTP, please refer to the file located at: <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_gptp/gptpconf/gptp_nonyangconfig.xml</code>.</p>
<h3><a class="anchor" id="autotoc_md568"></a>
gPTP Multiple Domains</h3>
<p>At the moment, our system supports two domains, but this feature is turned off by default. To turn on multiple domains, follow these steps:</p>
<ul>
<li>Set <code>#define GPTP_MAX_DOMAINS 2</code> in the <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_buildconf/sitara_buildconf.h</code> file</li>
<li>In the file <code>&lt;mcu_plus_sdk&gt;/source/networking/enet/core/examples/tsn/gptp_init.c</code>, you will see the following settings are set: <div class="fragment"><div class="line">#if GPTP_MAX_DOMAINS == 2</div>
<div class="line">    {&quot;CMLDS_MODE&quot;, XL4_EXTMOD_XL4GPTP_CMLDS_MODE, 1},</div>
<div class="line">    {&quot;SECOND_DOMAIN_THIS_CLOCK&quot;, XL4_EXTMOD_XL4GPTP_SECOND_DOMAIN_THIS_CLOCK, 1}</div>
<div class="line">#endif</div>
</div><!-- fragment --></li>
</ul>
<p>This will activate the second domain in the gPTP system.</p>
<h3><a class="anchor" id="autotoc_md569"></a>
gPTP Shorter Sync Interval</h3>
<p>By default, the gPTP Sync interval is set to 125 milliseconds (log2(0.125)=-3) which is corresponding to the default SYNC_LOG value is -3 (refer <code>gptp_init.c</code>)</p>
<p><code>#define SYNC_LOG -3 // Default: 125ms</code></p>
<p>If you need a shorter Sync interval (eg: apply for Quick SYNC), you can adjust it by setting a specific value in the <code>gptp_init.c</code> file:</p>
<div class="fragment"><div class="line">#define SYNC_LOG -4 // 62.5ms</div>
<div class="line">#define SYNC_LOG -5 // 31.25ms</div>
<div class="line">#define SYNC_LOG -6 // 15.625ms</div>
<div class="line">#define SYNC_LOG -7 // 7.8125ms &lt;- Minimum time gptp stack can support</div>
</div><!-- fragment --><p>As explained in previous section, the SYNC_LOG will be applied to <code>ieee802-dot1as-gptp:log-sync-interval</code>, and the gptp stack will base on the setting to have proper SYNC interval.</p>
<p>This SYNC_LOG understanding is also applicable for:</p><ul>
<li>LOG_ANNOUNCE: Default 0 which mean Announce will be sent every 1s</li>
<li>LOG_PDELAY: Default 0 which mean PDelay Request will be sent every 1s</li>
<li>LOG_GPTP_CAPABLE: Default 3 which mean GPTP CAPABLE Signaling will be send every 8s</li>
</ul>
<h3><a class="anchor" id="autotoc_md570"></a>
gPTP Performance optimization</h3>
<p>Out of box configuration is not optimized for performance as the connected devices (e.g. Intel I218/219) may not be compatible with these optimal configuration. The following configurations can be tuned for optimizing the gPTP performance:</p>
<ul>
<li><code>XL4_EXTMOD_XL4GPTP_CLOCK_COMPUTE_INTERVAL_MSEC</code>: The interval in milliseconds at which the gPTP clock is computed. The default value is currently set to <code>1000</code>, and has a parameter vsize of <code>1</code> (uint8_t).</li>
<li><code>XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_UPDATE_MRATE_PPB</code>: The rate at which the frequency offset is updated. The default value is currently set to <code>10</code>, and has a parameter vsize of <code>4</code> (uint32_t).</li>
<li><code>XL4_EXTMOD_XL4GPTP_PHASE_OFFSET_IIR_ALPHA_STABLE_VALUE</code>: The reciprocal of this is the alpha value of the IIR filter used to compute the phase offset. The default value is currently set to <code>10</code>, and has a parameter vsize of <code>4</code> (uint32_t).</li>
<li><code>XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_IIR_ALPHA_STABLE_VALUE</code>: The reciprocal of this is the alpha value of the IIR filter used to compute the frequency offset. The default value is currently set to <code>10</code>, and has a parameter vsize of <code>4</code> (uint32_t).</li>
</ul>
<p>e.g. The following is an example configuration which you can use in the example to get better accuaracy if compatible with your devices in the setup. The following configuration is tested with the Intel I210 card and in between two EVMs.</p>
<div class="fragment"><div class="line">uint8_t compute_interval = 100;</div>
<div class="line">uint32_t freq_offset_update_mrate_ppb = 5;</div>
<div class="line">uint32_t phase_offset_iir_alpha_stable_value = 1;</div>
<div class="line">uint32_t freq_offset_iir_alpha_stable_value = 2;</div>
<div class="line"> </div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_CLOCK_COMPUTE_INTERVAL_MSEC, YDBI_CONFIG, &amp;compute_interval, sizeof(compute_interval));</div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_UPDATE_MRATE_PPB, YDBI_CONFIG, &amp;freq_offset_update_mrate_ppb, sizeof(freq_offset_update_mrate_ppb));</div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_PHASE_OFFSET_IIR_ALPHA_STABLE_VALUE, YDBI_CONFIG, &amp;phase_offset_iir_alpha_stable_value, sizeof(phase_offset_iir_alpha_stable_value));</div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_IIR_ALPHA_STABLE_VALUE, YDBI_CONFIG, &amp;freq_offset_iir_alpha_stable_value, sizeof(freq_offset_iir_alpha_stable_value));</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md571"></a>
Limitations</h1>
<p>For all parameters related to interval, the minimum interval can be configured for gPTP is 7.8125ms. The reason for that minimum interval is the implementation uses a base timer which has minimum period is 7.8125ms. Thus, increasing the interval parameters like <code>sync-interval</code> which is not a multiple of 7.8125ms may produce inaccurate interval of sending sync message.Or reducing interval of sync message below 7.8125ms is not possible. And the same limitation applied for all remaining interval parameters.</p>
<h1><a class="anchor" id="autotoc_md572"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
