<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: MDIO PHY Register Access - Clause45 Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('enet_mdio_clause45_support.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MDIO PHY Register Access - Clause45 Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1408">Overview</a></li>
<li class="level1"><a href="#autotoc_md1409">Background</a><ul><li class="level2"><a href="#autotoc_md1410">Clause 22 v/s Clause 45</a></li>
<li class="level2"><a href="#autotoc_md1411">MMD (Management/MDIO Manageable Device) : Required for Clause45 support</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1412">Implementation Requirements</a></li>
<li class="level1"><a href="#autotoc_md1413">Implementation Steps</a><ul><li class="level2"><a href="#autotoc_md1414">Step-1: Modify PHY Driver code with the MMD register as an input argument</a></li>
<li class="level2"><a href="#autotoc_md1415">Step-2: Update EnetPhy Configuration</a></li>
<li class="level2"><a href="#autotoc_md1416">Step-3: Common PHY registers access, such as PHY alive, PHY link status, etc uses Clause 22 in order to suport backward compatibility. Replace them with Clause 45 support</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1417">Detailed API Reference</a><ul><li class="level2"><a href="#autotoc_md1418">Clause 45 Read Operation</a></li>
<li class="level2"><a href="#autotoc_md1419">Clause 45 Write Operation</a></li>
<li class="level2"><a href="#autotoc_md1420">Clause 45 Read-Modify-Write Operation</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1421">Key Parameters Explained</a></li>
<li class="level1"><a href="#autotoc_md1422">Current Limitations</a></li>
<li class="level1"><a href="#autotoc_md1423">Summary</a></li>
<li class="level1"><a href="#autotoc_md1424">Limitations</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_networking_enet_lld_mdio_clause45_support"></a></p>
<h1><a class="anchor" id="autotoc_md1408"></a>
Overview</h1>
<p>This document describes how to enable and utilize Clause 45 MDIO functionality for PHY register access. Clause 45 provides expanded addressing capabilities for modern PHY devices with extended register sets.</p>
<h1><a class="anchor" id="autotoc_md1409"></a>
Background</h1>
<h2><a class="anchor" id="autotoc_md1410"></a>
Clause 22 v/s Clause 45</h2>
<ul>
<li>Clause 22(IEEE802.3ah):<ul>
<li>Limited to 32 registers per PHY device (5-bit register address)</li>
<li>Simple addressing scheme: PHY address (5 bits) + Register address (5 bits)</li>
<li>Cannot directly access extended registers</li>
</ul>
</li>
<li>Clause 45(IEEE802.3ae):<ul>
<li>Supports up to 65,536 registers (16-bit register address)</li>
<li>Adds Management/MDIO Manageable Device (MMD) field to enable multiple sub-devices within a PHY</li>
<li>Two-part addressing scheme: first address the MMD, then access the register</li>
<li>Better suited for modern PHY devices with complex functionality</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md1411"></a>
MMD (Management/MDIO Manageable Device) : Required for Clause45 support</h2>
<p>The MMD field identifies specific device types within a PHY:</p><ul>
<li>MMD 1: PMA/PMD (Physical Medium Attachment/Physical Medium Dependent)</li>
<li>MMD 2: WIS (WAN Interface Sublayer)</li>
<li>MMD 3: PCS (Physical Coding Sublayer)</li>
<li>MMD 7: Auto-Negotiation</li>
<li>MMDs 30-31: Vendor-specific functions</li>
</ul>
<h1><a class="anchor" id="autotoc_md1412"></a>
Implementation Requirements</h1>
<p>To enable Clause 45 support, the following are required:</p>
<ol type="1">
<li>Verify hardware capabilities:<ul>
<li>The MDIO should either be configured in MDIO_MODE_STATE_CHANGE_MON or MDIO_MODE_NORMAL mode of operation</li>
<li>Check ENET_CFG_MDIO_CLAUSE45 feature flag support in the file: <code>mcu_plus_sdk/source/networking/enet/soc/&lt;soc_name&gt;/enet_soc_cfg.h</code></li>
</ul>
</li>
<li>API modifications:<ul>
<li>Use C45-specific APIs instead of C22 APIs</li>
<li>Add MMD selection to register access calls</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md1413"></a>
Implementation Steps</h1>
<h2><a class="anchor" id="autotoc_md1414"></a>
Step-1: Modify PHY Driver code with the MMD register as an input argument</h2>
<dl class="section note"><dt>Note</dt><dd>PHY datasheet will specify which MMD values to use for accessing specific registers. Always refer to the PHY documentation for the correct MMD values.</dd></dl>
<div class="fragment"><div class="line">typedef struct</div>
<div class="line">{</div>
<div class="line">    int32_t (*EnetPhy_readReg)(void* pArgs, uint8_t mmd, uint32_t reg, uint16_t *val);</div>
<div class="line"> </div>
<div class="line">    int32_t (*EnetPhy_writeReg)(void*  pArgs, uint8_t mmd, uint32_t reg, uint16_t val);</div>
<div class="line"> </div>
<div class="line">    int32_t (*EnetPhy_rmwReg)(void*  pArgs, uint8_t mmd, uint32_t reg, uint16_t mask,</div>
<div class="line">            uint16_t val);</div>
<div class="line"> </div>
<div class="line">    /*!Argument that needs to be passed to the above callbacks */</div>
<div class="line">    void* pArgs;</div>
<div class="line"> </div>
<div class="line">} Phy_RegAccessCb_t;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1415"></a>
Step-2: Update EnetPhy Configuration</h2>
<p>To ensure your PHY driver properly uses Clause 45 operations, enable the following changes in <code>mcu_plus_sdk/source/networking/enet/core/src/phy/enetphy.c</code>:</p>
<ol type="1">
<li>Enable the binding for C45 PHY driver functions with EnetPhy module. <div class="fragment"><div class="line">Phy_RegAccessCb_t regAccess =</div>
<div class="line">               {</div>
<div class="line">                       .EnetPhy_readReg = EnetPhy_readC45Reg,</div>
<div class="line">                       .EnetPhy_writeReg = EnetPhy_writeC45Reg,</div>
<div class="line">                       .EnetPhy_rmwReg = EnetPhy_rmwC45Reg,</div>
<div class="line">                       .pArgs = (void *) hPhy,</div>
<div class="line">               };</div>
</div><!-- fragment --></li>
<li>Update EnetPhy read/write/rmw access functions to use Clause 45 APIs: <div class="fragment"><div class="line">// Replace EnetPhy_readReg function call with EnetPhy_readC45Reg call:</div>
<div class="line">//EnetPhy_readReg(hPhy, reg, &amp;val);</div>
<div class="line">EnetPhy_readC45Reg(hPhy, mmd, reg, &amp;val);</div>
</div><!-- fragment --> <div class="fragment"><div class="line">// Replace EnetPhy_writeReg funcation call with EnetPhy_writeC45Reg call</div>
<div class="line">//EnetPhy_writeReg(hPhy, reg, val);</div>
<div class="line">EnetPhy_writeC45Reg(hPhy, mmd, reg, val);</div>
</div><!-- fragment --> <div class="fragment"><div class="line">//EnetPhy_rmwReg(hPhy, reg, val);</div>
<div class="line">EnetPhy_rmwC45Reg(hPhy, mmd, reg, val);</div>
</div><!-- fragment --></li>
<li>Make sure to build libraries before building the Clause45 support examples. To rebuild the libraries, do below, <div class="fragment"><div class="line">cd ${SDK_INSTALL_PATH}</div>
<div class="line">gmake -s libs PROFILE=release</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1416"></a>
Step-3: Common PHY registers access, such as PHY alive, PHY link status, etc uses Clause 22 in order to suport backward compatibility. Replace them with Clause 45 support</h2>
<div class="fragment"><div class="line">// Reading a register using Clause 45</div>
<div class="line">int32_t status;</div>
<div class="line">//status = hMdio-&gt;readC22(phyGroup, phyAddr, reg, val, hPhy-&gt;mdioArgs);</div>
<div class="line">status = hMdio-&gt;readC45(phyGroup, phyAddr, mmd, reg, val, hPhy-&gt;mdioArgs);</div>
</div><!-- fragment --><div class="fragment"><div class="line">// Writing a register using Clause 45</div>
<div class="line">int32_t status;</div>
<div class="line">//status = hMdio-&gt;writeC22(phyGroup, phyAddr, reg, val, hPhy-&gt;mdioArgs);</div>
<div class="line">status = hMdio-&gt;writeC45(phyGroup, phyAddr, mmd, reg, val, hPhy-&gt;mdioArgs);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1417"></a>
Detailed API Reference</h1>
<h2><a class="anchor" id="autotoc_md1418"></a>
Clause 45 Read Operation</h2>
<div class="fragment"><div class="line"> </div>
<div class="line">int32_t <a class="code" href="group__DRV__ENETPHY.html#gaffc3fd5abf62e9d2b0ff41869b2622ec">EnetPhy_readC45Reg</a>(<a class="code" href="group__DRV__ENETPHY.html#ga321b990b312722b35a86cf9d09be4e48">EnetPhy_Handle</a> hPhy,</div>
<div class="line">                           uint8_t mmd,</div>
<div class="line">                           uint32_t reg,</div>
<div class="line">                           uint16_t *val);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1419"></a>
Clause 45 Write Operation</h2>
<div class="fragment"><div class="line"> </div>
<div class="line">int32_t <a class="code" href="group__DRV__ENETPHY.html#ga2f5294c3ffcd261efce2573c32038cbd">EnetPhy_writeC45Reg</a>(<a class="code" href="group__DRV__ENETPHY.html#ga321b990b312722b35a86cf9d09be4e48">EnetPhy_Handle</a> hPhy,</div>
<div class="line">                            uint8_t mmd,</div>
<div class="line">                            uint32_t reg,</div>
<div class="line">                            uint16_t val);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1420"></a>
Clause 45 Read-Modify-Write Operation</h2>
<div class="fragment"><div class="line"> </div>
<div class="line">int32_t <a class="code" href="group__DRV__ENETPHY.html#ga0785780a87174ef9fabff8b6a49a1cb2">EnetPhy_rmwC45Reg</a>(<a class="code" href="group__DRV__ENETPHY.html#ga321b990b312722b35a86cf9d09be4e48">EnetPhy_Handle</a> hPhy,</div>
<div class="line">                          uint8_t mmd,</div>
<div class="line">                          uint32_t reg,</div>
<div class="line">                          uint16_t mask,</div>
<div class="line">                          uint16_t val);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1421"></a>
Key Parameters Explained</h1>
<p>When using the Clause 45 APIs, you'll encounter these important parameters:</p>
<ol type="1">
<li><b>EnetPhy_Handle hPhy</b>:<ul>
<li>This is the handle to your PHY instance</li>
<li>It contains all the context information about your PHY</li>
<li>This is typically obtained when you open/initialize your PHY</li>
</ul>
</li>
<li><b>mdioArgs</b>:<ul>
<li>A structure containing MDIO-specific parameters</li>
<li>Includes group ID, timeouts, and other MDIO-specific settings</li>
<li>This is automatically handled by the EnetPhy middleware</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md1422"></a>
Current Limitations</h1>
<ol type="1">
<li><b>Core EnetPhy Operations</b>:<ul>
<li>Some fundamental EnetPhy operations still use Clause 22 internally</li>
<li>These include link status detection and PHY aliveness checks</li>
<li>These operations will continue to work with Clause 45 PHYs that maintain Clause 22 compatibility</li>
</ul>
</li>
<li><b>MDIO Manual Mode</b>:<ul>
<li>Clause 45 is not supported when MDIO is configured in Manual Mode</li>
</ul>
</li>
<li><b>PHY-Specific Registers</b>:<ul>
<li>For accessing vendor-specific registers, refer to your PHY datasheet for the correct MMD values</li>
<li>Some PHY features may require specific sequences of register accesses</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md1423"></a>
Summary</h1>
<p>Enabling Clause 45 MDIO support provides access to the expanded register space in modern PHY devices. The primary changes involve:</p>
<ol type="1">
<li>Using the appropriate read/write commands (C45 vs C22)</li>
<li>Adding the MMD parameter to specify the device within the PHY</li>
<li>Managing the expanded register address space (16-bit vs 5-bit)</li>
</ol>
<p>These changes enable access to advanced PHY features like Energy Efficient Ethernet, precise timing for IEEE 1588, and vendor-specific extended registers that are not accessible throughF the Clause 22 interface.</p>
<h1><a class="anchor" id="autotoc_md1424"></a>
Limitations</h1>
<ol type="1">
<li>While the hardware supports MDIO Clause 45 PHY register access, the current implementation in the Ethernet driver (enetphy.c) only utilizes Clause 22 protocol for fundamental PHY operations such as link status detection and PHY aliveness checks. To enable full Clause 45 PHY driver support modifications are required in <code>source/networking/enet/core/src/phy/enetphy.c</code> to properly implement the extended register addressing capabilities of Clause 45.</li>
<li>Clause 45 is not supported on MDIO Manual Mode [ <a class="el" href="enetmdio_manualmode.html">MDIO Manual Mode Enablement</a> ] </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__DRV__ENETPHY_html_ga0785780a87174ef9fabff8b6a49a1cb2"><div class="ttname"><a href="group__DRV__ENETPHY.html#ga0785780a87174ef9fabff8b6a49a1cb2">EnetPhy_rmwC45Reg</a></div><div class="ttdeci">int32_t EnetPhy_rmwC45Reg(EnetPhy_Handle hPhy, uint8_t mmd, uint32_t reg, uint16_t mask, uint16_t val)</div><div class="ttdoc">Read-modify-write PHY register using Clause-45 frame.</div></div>
<div class="ttc" id="agroup__DRV__ENETPHY_html_gaffc3fd5abf62e9d2b0ff41869b2622ec"><div class="ttname"><a href="group__DRV__ENETPHY.html#gaffc3fd5abf62e9d2b0ff41869b2622ec">EnetPhy_readC45Reg</a></div><div class="ttdeci">int32_t EnetPhy_readC45Reg(EnetPhy_Handle hPhy, uint8_t mmd, uint32_t reg, uint16_t *val)</div><div class="ttdoc">Read PHY register using Clause-45 frame.</div></div>
<div class="ttc" id="agroup__DRV__ENETPHY_html_ga321b990b312722b35a86cf9d09be4e48"><div class="ttname"><a href="group__DRV__ENETPHY.html#ga321b990b312722b35a86cf9d09be4e48">EnetPhy_Handle</a></div><div class="ttdeci">struct EnetPhy_Obj_s * EnetPhy_Handle</div><div class="ttdoc">PHY driver object handle.</div><div class="ttdef"><b>Definition:</b> enetphy.h:672</div></div>
<div class="ttc" id="agroup__DRV__ENETPHY_html_ga2f5294c3ffcd261efce2573c32038cbd"><div class="ttname"><a href="group__DRV__ENETPHY.html#ga2f5294c3ffcd261efce2573c32038cbd">EnetPhy_writeC45Reg</a></div><div class="ttdeci">int32_t EnetPhy_writeC45Reg(EnetPhy_Handle hPhy, uint8_t mmd, uint32_t reg, uint16_t val)</div><div class="ttdoc">Write PHY register using Clause-45 frame.</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
