<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Building an Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('BUILDING_APPLICATION.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building an Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md818">Tools</a></li>
<li class="level1"><a href="#autotoc_md819">Creation of application binary</a><ul><li class="level2"><a href="#autotoc_md820">Generating .out binary</a></li>
<li class="level2"><a href="#autotoc_md821">Generating .mcelf binary</a></li>
<li class="level2"><a href="#autotoc_md822">Generating HEX binary</a><ul><li class="level3"><a href="#autotoc_md823">Installing SRecord on Windows</a></li>
<li class="level3"><a href="#autotoc_md824">Installing SRecord on Linux</a></li>
<li class="level3"><a href="#autotoc_md825">Converting .mcelf to Intel hex:</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md826">Signing the binary</a><ul><li class="level3"><a href="#SBL_SIGNING">SBL Signing</a></li>
<li class="level3"><a href="#autotoc_md827">Application signing</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md828">Building a Hello world example</a></li>
<li class="level1"><a href="#autotoc_md829">Next step - Loading the application</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_getting_started_building_application"></a></p>
<p>Building an example is converting the source files of the application into a machine readable file.</p>
<ul>
<li>It involves two primary steps:<ul>
<li>Compilation</li>
<li>Linking</li>
</ul>
</li>
<li>A compiler converts the human readable source code to assembly language, producing assembly files.</li>
<li>The assembler converts assembly files into machine code, creating object files (.o/.obj)</li>
<li>These files are not yet linked into an executable.</li>
<li>A linker.cmd file specifies memory layout and sections placement information. The linker then combines the multiple object files into a single executable.</li>
</ul>
<h1><a class="anchor" id="autotoc_md818"></a>
Tools</h1>
<table class="doxtable">
<tr>
<th>Tool </th><th>Reference </th><th>Description  </th></tr>
<tr>
<td>Compiler </td><td><a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_TIARMCLANG">TI CLANG Compiler Toolchain</a> </td><td>Converts .c source code to machine readable code.  </td></tr>
<tr>
<td>Sysconfig </td><td><a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_SYSCONFIG">SysConfig</a> </td><td>A GUI tool used for configuring pins, peripherals, software stacks, RTOS, clock tree, linker (see row below) and other components.  </td></tr>
<tr>
<td>Creating linker.cmd file </td><td><a class="el" href="MEMORY_CONFIGURATOR.html">Memory Configurator</a> </td><td><p class="starttd">A GUI method of creating a linker file using Sysconfig tool. It generates a linker.cmd file along with other component files. </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>.out to .mcelf </td><td><a class="el" href="TOOLS_BOOT.html#MCELF_GEN_TOOL">MCELF Image Gen</a> </td><td>Takes individual core .out files as input and combines them to create a single .mcelf ELF file which can be booted by the SBL.  </td></tr>
<tr>
<td>Signing tools </td><td><a class="el" href="TOOLS_SECURITY.html#TOOLS_BOOT_SIGNING">Signing Scripts</a> </td><td>Collection of scripts needed to sign SBL and application images.  </td></tr>
<tr>
<td>Clocktree </td><td><a class="el" href="CLOCKTREE.html">Clocktree</a> </td><td>Configure the Clock settings for all peripherals from the Clocktree view.  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md819"></a>
Creation of application binary</h1>
<dl class="section note"><dt>Note</dt><dd>To see the exact sequence of steps in which applications and secondary bootloader (SBL) are converted from compiler generated .out files to boot images, see the makefile <code>makefile_ccs_bootimage_gen</code> that is included in every example and secondary bootloader (SBL) CCS project.</dd>
<dd>
If you are using makefile based build, then see the file named <code>makefile</code> in the example folder.</dd></dl>
<p>Shown below are the different steps that are done to convert the compiler+linker generated application <code>.out</code> into a format suitable for flashing and booting.</p>
<h2><a class="anchor" id="autotoc_md820"></a>
Generating .out binary</h2>
<ul>
<li>For each CPU, the compiler + linker toolchain is used to create a .out file.</li>
<li>The compiler convertes the .c files into .asm files, the assembler converts .asm files to object files - .obj files.</li>
<li>The linker then combines the multiple object files into a single .out file for each CPU.</li>
</ul>
<p> <style>div.image img[src="compiler_build_steps_no_xip.png"]{width:20%}</style> </p><div class="image">
<img src="compiler_build_steps_no_xip.png" alt=""/>
<div class="caption">
Generating .out file</div></div>
<ul>
<li>This .out file can be loaded and run via CCS. Refer <a class="el" href="CCS_LAUNCH_PAGE.html#CCS_LOAD_RUN">Load and run example binaries in CCS</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md821"></a>
Generating .mcelf binary</h2>
<ul>
<li>Refer <a class="el" href="MCELF_LANDING.html">Understanding Multicore ELF image format</a> for information on MCELF</li>
<li>The mcelf image generator script <code>genimage.py</code> takes each individual core's .out file as input and combines them to form a .mcelf file.</li>
<li>This .mcelf file contains metadata and segments along with information like segment type, load address, size, alignment.</li>
<li>The <code>.mcelf</code> file is then flashed to the board.</li>
</ul>
<p> <style>div.image img[src="mcelf_bootflow_post_build_steps_no_xip.png"]{width:50%}</style> </p><div class="image">
<img src="mcelf_bootflow_post_build_steps_no_xip.png" alt=""/>
<div class="caption">
Post build steps MCELF</div></div>
<h2><a class="anchor" id="autotoc_md822"></a>
Generating HEX binary</h2>
<ul>
<li>TI does not provide a proprietary tool for hex conversion of binaries. Instead use available tools like SRecord that is compatible with both Windows and Linux platforms. It supports conversion of binaries to Intel hex, Motorola S-record and other commonly used formats.</li>
</ul>
<h3><a class="anchor" id="autotoc_md823"></a>
Installing SRecord on Windows</h3>
<ul>
<li>Start on this page <a href="https://srecord.sourceforge.net">SRecord 1.65</a>. Click on Download.</li>
<li>On the next page, click on <b>SourceForge.net download mirrors</b> under the "Pre-compiled Windows Executable" heading.</li>
<li>On the page that comes up, click on the green box that contains the text <b>Download Latest Version</b>.</li>
<li>The file downloaded is named srecord-1.65.0-win64.exe. Run it to install the software.</li>
</ul>
<h3><a class="anchor" id="autotoc_md824"></a>
Installing SRecord on Linux</h3>
<ul>
<li>Start on this page <a href="https://srecord.sourceforge.net">SRecord 1.65</a>. Click on Download.</li>
<li>On the next page click on <b>1.65 release folder</b> under SourceForge Downloads &mdash;&gt; Unix and Linux downloads.</li>
<li>Click on the green box that contains the text <b>Download Latest Version</b>.</li>
<li>The file downloaded is named srecord-1.65.0-Linux.tar.gz. Extract the package.</li>
</ul>
<h3><a class="anchor" id="autotoc_md825"></a>
Converting .mcelf to Intel hex:</h3>
<ul>
<li>Order of invocation: <div class="fragment"><div class="line">{Path to srecord folder}\bin\srec_cat {Path to input binary} -{Type of input file} -offset {application offset from flash} -o {Path to output binary} -{Type of hex file}</div>
</div><!-- fragment --></li>
<li>Example to generate hex file for hello world: <div class="fragment"><div class="line">{Path to srecord folder}\bin\srec_cat {SDK_PATH}\examples\hello_world\&lt;soc&gt;-&lt;board&gt;\r5fss0-0_nortos\ti-arm-clang\hello_world.release.mcelf -Binary -offset 0x80000 -o hello_world.release.hex -Intel</div>
</div><!-- fragment --></li>
<li>This generated file can be flashed using your custom flashwriter (not Uniflash).</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This process treats the .mcelf file as a raw binary and converts it as it is to hex. The contents after writing to flash will still be of mcelf format so that TI Bootloader can parse, load and boot the application. TI Bootloader cannot understand HEX format in flash.</dd></dl>
<h2><a class="anchor" id="autotoc_md826"></a>
Signing the binary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Image  </th><th class="markdownTableHeadNone">HSFS  </th><th class="markdownTableHeadNone">HSSE   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SBL is signed  </td><td class="markdownTableBodyNone">Yes  </td><td class="markdownTableBodyNone">Yes   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Application is signed  </td><td class="markdownTableBodyNone">No  </td><td class="markdownTableBodyNone">Yes   </td></tr>
</table>
<h3><a class="anchor" id="SBL_SIGNING"></a>
SBL Signing</h3>
<ul>
<li>After building, the SBL application <code>.out</code> file is first converted to a binary format <code>.bin</code> using the TI ARM CLANG <code>objcopy</code> tool.</li>
<li>This <code>.bin</code> file is then signed using the <a class="el" href="TOOLS_SECURITY.html#TOOLS_BOOT_SIGNING">Signing Scripts</a> to create the final <code>.tiimage</code> bootable image.<ul>
<li>The <code>.tiimage</code> file extension is kept to separate the SBL boot image from a normal application image</li>
<li>The rom_degenerateKey.pem is used for this.</li>
<li>This is a ROM bootloader requirement and is needed even on a non-secure device.</li>
<li>The signing tools take the <code>.bin</code> file</li>
</ul>
</li>
<li>The SBL communicates with ROM to get the HSMRt (TIFS-MCU) loaded on the HSM. This firmware provides various foundational security services. For HS-FS ,this can be found at source/drivers/hsmclient/soc/am263x/hsmRtImg.h. For HS-SE devices, more information can be found at MySecureSW. For integrating HSM RunTime with SBL, the following should be taken care of:<ul>
<li>HSMClient should be initialized and registered.</li>
<li>HSMRT (TIFS-MCU) image signed appropriately should be available. For HS-FS, this is already part of the SDK, for HS-SE, this can be compiled with TIFS-MCU package (available on MySecureSW)</li>
</ul>
</li>
<li>Depending on the device type for which we build the SBL, there will be certain prefixes to the <code>.tiimage</code> extension like so:<ul>
<li><b>HS-FS</b> device:<ul>
<li><code>sbl_xxx.release.tiimage</code> [No prefix before <code>.tiimage</code>, plain image]</li>
</ul>
</li>
<li><b>HS-SE</b> device:<ul>
<li><code>sbl_xxx.release.hs.tiimage</code> [<code>hs</code> prefix before <code>.tiimage</code>]</li>
</ul>
</li>
</ul>
</li>
<li>Note that if we just mentioned <code>hs</code> it is meant for <b>HS-SE</b> device.</li>
<li>The <code>.tiimage</code> file can then be flashed or copied to a boot image using the <a class="el" href="TOOLS_FLASH.html">Flashing Tools</a></li>
</ul>
<p> <style>div.image img[src="tiimage_normal.png"]{width:15%}</style> </p><div class="image">
<img src="tiimage_normal.png" alt=""/>
<div class="caption">
TIIMAGE</div></div>
<ul>
<li>For detailed information refer <a class="el" href="SECURE_BOOT.html#SBL_SECURE_IMAGE">SBL Image Generation</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md827"></a>
Application signing</h3>
<ul>
<li>Application image is signed only for HSSE secure boot.</li>
<li>Refer <a class="el" href="SECURE_BOOT.html#APPLICATION_SECURE_IMAGE">Secure application image Generation</a> for detailed information.</li>
</ul>
<h1><a class="anchor" id="autotoc_md828"></a>
Building a Hello world example</h1>
<p>Steps to build the hello world example from SDK is mentioned here <a class="el" href="GETTING_STARTED_BUILD.html">Build a Hello World example</a></p>
<h1><a class="anchor" id="autotoc_md829"></a>
Next step - Loading the application</h1>
<p>Go to <a class="el" href="LOADING_APPLICATION.html">Loading an Application</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
