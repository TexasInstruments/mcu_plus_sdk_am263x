<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Scale Factor Optimization (SFO)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('SFO.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Scale Factor Optimization (SFO) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1565">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1566">Files included</a></li>
<li class="level1"><a href="#autotoc_md1567">Software usage details for SFO library</a><ul><li class="level2"><a href="#autotoc_md1568">1. Add &quot;Include&quot; Files:</a></li>
<li class="level2"><a href="#autotoc_md1569">2. Variable Declarations:</a></li>
<li class="level2"><a href="#autotoc_md1570">3. MEP_ScaleFactor Initialization:</a></li>
<li class="level2"><a href="#autotoc_md1571">4. Application Code</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1572">Examples</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_calibration_calibration_sfo"></a></p>
<h1><a class="anchor" id="autotoc_md1565"></a>
Introduction</h1>
<p>The SFO library implements Scale Factor Optimization routine to drive the micro-edge positioner (MEP) calibration module to run SFO diagnostics and determine the appropriate MEP scale factor (number of MEP steps per coarse EPWMCLK step) for a device at any given time.</p>
<h1><a class="anchor" id="autotoc_md1566"></a>
Files included</h1>
<ol type="1">
<li>SFO lib source code - sfo.c</li>
<li>SFO lib header file - sfo.h</li>
</ol>
<h1><a class="anchor" id="autotoc_md1567"></a>
Software usage details for SFO library</h1>
<h2><a class="anchor" id="autotoc_md1568"></a>
1. Add "Include" Files:</h2>
<p>Include sfo.h header file in application code apart for the other device specific files. <br  />
</p>
<div class="fragment"><div class="line">E.g. #include &quot;sfo.h&quot;   </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1569"></a>
2. Variable Declarations:</h2>
<p>The application needs to declare below variables to provide OTTOCAL (calibration module) instance addresses used in SFO lib and to capture calibration status &amp; output. <br  />
</p>
<div class="fragment"><div class="line">E.g. uint16_t status = SFO_INCOMPLETE;</div>
<div class="line">     uint32_t MEP_ScaleFactor = 0; //scale factor value</div>
<div class="line">     uint32_t gOttoCal_base = CSL_CONTROLSS_OTTOCAL0_U_BASE;</div>
</div><!-- fragment --><p>Use</p><ul>
<li>OTTOCAL0 for EPWM0-EPWM7</li>
<li>OTTOCAL1 for EPWM8-EPWM15</li>
<li>OTTOCAL2 for EPWM16-EPWM23</li>
<li>OTTOCAL3 for EPWM24-EPWM31</li>
</ul>
<h2><a class="anchor" id="autotoc_md1570"></a>
3. MEP_ScaleFactor Initialization:</h2>
<p>Prior to using the MEP_ScaleFactor variable in application code, SFO() should be called to drive the MEP calibration module to calculate an initial MEP_ScaleFactor value.</p>
<div class="fragment"><div class="line">E.g.</div>
<div class="line">while(status == SFO_INCOMPLETE)</div>
<div class="line"> {</div>
<div class="line">     status = SFO();</div>
<div class="line">     if(status == SFO_ERROR)</div>
<div class="line">     {</div>
<div class="line">         //</div>
<div class="line">         // SFO function returns 2 if an error occurs &amp; # of MEP</div>
<div class="line">         // steps/coarse step exceeds maximum of 255.</div>
<div class="line">         //</div>
<div class="line">         error();</div>
<div class="line">     }</div>
<div class="line"> }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1571"></a>
4. Application Code</h2>
<p>While the application is running, fluctuations in both device temperature and supply voltage may be expected. To be sure that optimal Scale Factors are used for each ePWM module, the SFO function should be re-run periodically as part of a slower back-ground loop. Some examples of this are shown here.</p>
<div class="fragment"><div class="line">E.g.</div>
<div class="line">   void main ()</div>
<div class="line">   {</div>
<div class="line">    int status;</div>
<div class="line">    // User code</div>
<div class="line">    // The status variable returns 1 once a new MEP_ScaleFactor has been</div>
<div class="line">    // calculated by the MEP Calibration Module running SFO</div>
<div class="line">    // diagnostics.</div>
<div class="line">    status = SFO();</div>
<div class="line">    if(status == SFO_ERROR)</div>
<div class="line">    {</div>
<div class="line">     //</div>
<div class="line">     // SFO function returns 2 if an error occurs &amp; # of</div>
<div class="line">     // MEP steps/coarse step exceeds maximum of 255.</div>
<div class="line">     //</div>
<div class="line">     error();</div>
<div class="line">    }</div>
<div class="line">   }</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1572"></a>
Examples</h1>
<ul>
<li>Refer <a class="el" href="EXAMPLES_DRIVERS_HRPWM_DEADBAND_SFO.html">EPWM HR Deadband SFO</a></li>
<li>Refer <a class="el" href="EXAMPLES_DRIVERS_HRPWM_DUTY_CYCLE_SFO.html">EPWM HR duty cycle SFO</a></li>
<li>Refer <a class="el" href="EXAMPLES_DRIVERS_HRPWM_PHASE_SHIFT_SFO.html">EPWM HR Phase Shift SFO</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
