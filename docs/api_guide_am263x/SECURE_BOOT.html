<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Enabling Secure Boot</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('SECURE_BOOT.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Enabling Secure Boot </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md640">Secure Devices and Secure Boot: An Introduction</a></li>
<li class="level1"><a href="#autotoc_md641">Secure Boot Process</a></li>
<li class="level1"><a href="#autotoc_md642">Keyring Support</a></li>
<li class="level1"><a href="#autotoc_md643">Secure Boot Support in SDK</a><ul><li class="level2"><a href="#autotoc_md644">Device configuration file</a></li>
<li class="level2"><a href="#autotoc_md645">Signing tool</a></li>
<li class="level2"><a href="#autotoc_md646">Generating Secure Boot Image</a><ul><li class="level3"><a href="#autotoc_md647">HSMRt Image Generation</a></li>
<li class="level3"><a href="#SBL_SECURE_IMAGE">SBL Image Generation</a></li>
<li class="level3"><a href="#APPLICATION_SECURE_IMAGE">Secure application image Generation</a><ul><li class="level4"><a href="#autotoc_md648">RSASSA-PSS Support</a></li>
<li class="level4"><a href="#autotoc_md649">Auxiliary Keys Support</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md650">Encryption support for application images</a><ul><li class="level3"><a href="#autotoc_md651">Encryption support for application images using auxiliary keys</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md652">Limitations in Secure Boot</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_developer_guides_secure_boot"></a></p>
<h1><a class="anchor" id="autotoc_md640"></a>
Secure Devices and Secure Boot: An Introduction</h1>
<p>To put it simply, <b>secure boot</b> refers to booting application images in a secure way. Secure boot is a feature/service available in <b>secure devices</b>.</p>
<p>In secure device types (HS) there are two subtypes:</p>
<ol type="1">
<li>Field Securable (FS)</li>
<li>Security Enforced (SE)</li>
</ol>
<p>HS device type have FS and SE subtypes. Out of the two subtypes, FS and SE, this guide talks about secure boot in an <b>HS-SE</b> device. If the secure device received is an <b>HS-FS</b> subtype, it needs to be converted to an HS-SE variant with the customer keys burnt into the device eFUSEs. This is done using a special piece of software called an OTP keywriter. Keywriter documentation is out of scope for this guide.</p>
<h1><a class="anchor" id="autotoc_md641"></a>
Secure Boot Process</h1>
<p>Secure boot process, like the normal boot, consists of two stages - ROM loading and SBL loading. ROM loading is when the boot ROM loads the HSM runtime binary onto the HSM core, and the signed SBL binary into the primary boot core, which in most cases is an ARM Cortex R5F. SBL loading is when the SBL reads the signed application image from a boot media, authenticates it, decrypts it, and boots it. Here we describe how the secure process takes place in an HS-SE device.</p>
<p> <style>div.image img[src="boot_flow_am263x.png"]{width:60%}</style> </p><div class="image">
<img src="boot_flow_am263x.png" alt=""/>
<div class="caption">
HIGH LEVEL BOOTFLOW</div></div>
<h1><a class="anchor" id="autotoc_md642"></a>
Keyring Support</h1>
<p>The keyring is a set of keys which can be imported by SBL after importing the HSM runtime binary on an <b>HS-SE</b> device. For importing keyring TIFS-MCU expects an X.509 certificate signed by customer active root of trust (MPK). If X.509 certificate is containing symmetric keyring extension, the symmetric keyring blob must be encrypted with active root key. For certificate generation script usage, see <a class="el" href="TOOLS_SECURITY.html#KEYRING_CERT_GEN_PYTHON_SCRIPT">Keyring Cert Generation Python Script</a>.</p>
<p>TIFS-MCU supports application authentication using the following algorithms with Keyring.</p>
<table class="doxtable">
<tr>
<th>Signature Algorithm </th><th>Supported Keys </th><th>Hash Function  </th></tr>
<tr>
<td>RSA-PKCS#1 v1.5 </td><td>RSA2k, RSA3k, RSA4k </td><td>SHA256, SHA384, SHA512  </td></tr>
<tr>
<td>RSASSA-PSS </td><td>RSA2k, RSA3k, RSA4k </td><td>SHA256, SHA384, SHA512  </td></tr>
<tr>
<td>ECDSA </td><td>P-256, P-384, P-521, BrainpoolP512t1 </td><td>SHA256, SHA384, SHA512  </td></tr>
</table>
<p>For more information, please refer TIFS-MCU documentation</p>
<h1><a class="anchor" id="autotoc_md643"></a>
Secure Boot Support in SDK</h1>
<h2><a class="anchor" id="autotoc_md644"></a>
Device configuration file</h2>
<p>To make the secure/non-secure differences seamless for the user, a configuration file is provided at <code>${SDK_INSTALL_PATH}/devconfig/devconfig.mak</code>. In this configuration file, you can set certain options like the device type, keys to be used for signing and encryption etc. By default they will point to the dummy customer MPKs and MEKs but if you're using a production device with your own keys, please change the paths here to point to the right key files. Configuration of this file is currently manual, this will be made configurable by a GUI in an upcoming release.</p>
<p>The devconfig.mak file looks something like this:</p>
<div class="fragment"><div class="line"># Device type (HS/GP)</div>
<div class="line">DEVICE_TYPE?=GP</div>
<div class="line"> </div>
<div class="line"># Path to the signing tools, keys etc</div>
<div class="line">SIGNING_TOOL_PATH=$(MCU_PLUS_SDK_PATH)/tools/boot/signing</div>
<div class="line"> </div>
<div class="line"># Path to the salt required for calculation of Derived key using manufacturers encryption key.</div>
<div class="line">KD_SALT=$(SIGNING_TOOL_PATH)/kd_salt.txt</div>
<div class="line"> </div>
<div class="line"># Path to the keys</div>
<div class="line">ROM_DEGENERATE_KEY:=$(SIGNING_TOOL_PATH)/rom_degenerateKey.pem</div>
<div class="line">ifeq ($(DEVICE),am263x)</div>
<div class="line">    CUST_MPK=$(SIGNING_TOOL_PATH)/mcu_custMpk.pem</div>
<div class="line">    CUST_MEK=$(SIGNING_TOOL_PATH)/mcu_custMek.key</div>
<div class="line">endif</div>
<div class="line"> </div>
<div class="line"># Encryption option for application (yes/no)</div>
<div class="line">ENC_ENABLED?=no</div>
<div class="line"> </div>
<div class="line"># Encryption option for SBL (yes/no)</div>
<div class="line">ENC_SBL_ENABLED?=yes</div>
<div class="line"> </div>
<div class="line"># Debug Enable (yes/no)</div>
<div class="line">DBG_ENABLED?=no</div>
<div class="line"> </div>
<div class="line"># Debug control with TIFS (yes/no)</div>
<div class="line">DEBUG_TIFS?=yes</div>
<div class="line"> </div>
<div class="line"># RSASSA-PSS scheme option for application signing (yes/no)</div>
<div class="line">RSASSAPSS_ENABLED?=no</div>
<div class="line"> </div>
<div class="line"># Debug options for HS (DBG_PERM_DISABLE / DBG_SOC_DEFAULT / DBG_PUBLIC_ENABLE / DBG_FULL_ENABLE)</div>
<div class="line"># This option is valid only if DEBUG_TIFS is false</div>
<div class="line">DEBUG_OPTION?=DBG_SOC_DEFAULT</div>
<div class="line"> </div>
<div class="line"># Generic macros to be used depending on the device type</div>
<div class="line">APP_SIGNING_KEY=</div>
<div class="line">APP_ENCRYPTION_KEY=</div>
<div class="line">APP_SIGNING_HASH_ALGO=</div>
<div class="line">APP_SIGNING_SALT_LENGTH=</div>
<div class="line"> </div>
<div class="line">ifeq ($(DEVICE_TYPE),HS)</div>
<div class="line">    APP_SIGNING_KEY=$(CUST_MPK)</div>
<div class="line">    APP_ENCRYPTION_KEY=$(CUST_MEK)</div>
<div class="line">    APP_SIGNING_HASH_ALGO=sha512</div>
<div class="line">    APP_SIGNING_SALT_LENGTH=0</div>
<div class="line">else</div>
<div class="line">    APP_SIGNING_KEY=$(APP_DEGENERATE_KEY)</div>
<div class="line">endif</div>
<div class="line"> </div>
<div class="line"># Key id in keyring for application authentication and decryption</div>
<div class="line">APP_SIGNING_KEY_KEYRING_ID?=0</div>
<div class="line">APP_ENCRYPTION_KEY_KEYRING_ID?=0</div>
</div><!-- fragment --><p>This file will be included in all example makefiles</p>
<h2><a class="anchor" id="autotoc_md645"></a>
Signing tool</h2>
<p>For signing the binaries, two different scripts are used:</p>
<ol type="1">
<li>ROM signing script - This is a python script used for signing the SBL. The x509 certificate template used in this script is expected by the ROM.</li>
<li><p class="startli">Application signing script - This is a python script used for signing the application image. The x509 certificate template used in this script is expected by the HSMRt.</p>
<p class="startli">For more details on the usage of the script, see <a class="el" href="TOOLS_SECURITY.html#TOOLS_BOOT_SIGNING">Signing Scripts</a></p>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md646"></a>
Generating Secure Boot Image</h2>
<h3><a class="anchor" id="autotoc_md647"></a>
HSMRt Image Generation</h3>
<dl class="section note"><dt>Note</dt><dd>The out of box HSMRt image that is provided, is for HSFS device. In order to do a complete secure boot, HSMRt needs to be rebuilt with TIFS-MCU package for HSSE device. For more information please follow the build steps for HSMRt image in TIFS-MCU documentation.</dd></dl>
<h3><a class="anchor" id="SBL_SECURE_IMAGE"></a>
SBL Image Generation</h3>
<p>SBL and HSMRt are signed via Root of trust Keys i.e. SMPK (if keyrev = 1) or BMPK (if keyrev = 2). MCU+ SDK is only tested with TI-Dummy Keys. Users are expected to generate their own set of keys and use the same for production. This is supposed to be used only with the devices with the same dummy customer MPK burnt into the eFUSEes. If the SDK is supposed to be used with a production/development device with actual customer MPKs burnt into the device, please replace the file at ${SDK_INSTALL_PATH}/tools/boot/signing/custMpk_${SOC}.pem. This is true for also the encryption key used, which can also be found at ${SDK_INSTALL_PATH}/tools/boot/signing/custMek_${SOC}.txt. Whenever any SBL is built, it will be signed with dummy customer MPK, and the signed image generated will have an extension of <code>*.hs.tiimage</code>.</p>
<p>For more information, please refer to the OTP Keywriter Documentation.</p>
<dl class="section note"><dt>Note</dt><dd>HSMRt is built with TIFS-MCU package which is an add-on package on MCU+ SDK.</dd></dl>
<p>It is recommended to pass a key derivation salt for requesting ROM to not use the Customer MEK directly but generate a derived key to decrypt the SBL/HSMRt images. ROM uses HKDF (HMAC based Key Derivation Function) to derive a key from the S(B)MEK. The Key Derivation Function requires a salt which is a non-secret random value which it uses in a 2 step HKDF-Extract and HKDF-Expand process. For more information, please refer to <a href="https://datatracker.ietf.org/doc/html/rfc5869">RFC-5869</a>. With the signing scripts provided as part of MCU+ SDK, this can be done by passing argument <code>kdsalt</code> to the signing script and has been integrated as the default option in the makefiles for SBL.</p>
<dl class="section note"><dt>Note</dt><dd>To maintain the longevity of Customer MEK, it is recommended to update the salt everytime there is a firmware upgrade.</dd></dl>
<p>The salt is supplied to the makefiles via the file <code>/source/security/security_common/tools/boot/signing/kd_salt.txt</code>.</p>
<p>Here is an example certificate for SBL that takes care of the above recommendation:</p>
<div class="fragment"><div class="line">[ req ]</div>
<div class="line">distinguished_name     = req_distinguished_name</div>
<div class="line">x509_extensions        = v3_ca</div>
<div class="line">prompt                 = no</div>
<div class="line"> </div>
<div class="line">dirstring_type = nobmp</div>
<div class="line"> </div>
<div class="line">[ req_distinguished_name ]</div>
<div class="line">C                      = US</div>
<div class="line">ST                     = SC</div>
<div class="line">L                      = New York</div>
<div class="line">O                      = Texas Instruments., Inc.</div>
<div class="line">OU                     = SITARA MCU</div>
<div class="line">CN                     = Albert</div>
<div class="line">emailAddress           = Albert@gt.ti.com</div>
<div class="line"> </div>
<div class="line">[ v3_ca ]</div>
<div class="line">basicConstraints = CA:true</div>
<div class="line">1.3.6.1.4.1.294.1.1=ASN1:SEQUENCE:boot_seq</div>
<div class="line">1.3.6.1.4.1.294.1.2=ASN1:SEQUENCE:image_integrity</div>
<div class="line">1.3.6.1.4.1.294.1.3=ASN1:SEQUENCE:swrv</div>
<div class="line">1.3.6.1.4.1.294.1.4=ASN1:SEQUENCE:encryption</div>
<div class="line"> </div>
<div class="line">1.3.6.1.4.1.294.1.5=ASN1:SEQUENCE:key_derivation</div>
<div class="line"> </div>
<div class="line">[ boot_seq ]</div>
<div class="line">certType     =  INTEGER:1</div>
<div class="line">bootCore     =  INTEGER:16</div>
<div class="line">bootCoreOpts =  INTEGER:0</div>
<div class="line">destAddr     =  FORMAT:HEX,OCT:70002000</div>
<div class="line">imageSize    =  INTEGER:199488</div>
<div class="line"> </div>
<div class="line">[ image_integrity ]</div>
<div class="line">shaType = OID:2.16.840.1.101.3.4.2.3</div>
<div class="line">shaValue = FORMAT:HEX,OCT:1d1b24e6487709f007d87c8b2b593abf1853a82a99a54650de85f40ddc7b5ae4558a68e49ea3668732ea34ff4bcf76cc73e4e354a3b8128726843c71b05c4168</div>
<div class="line"> </div>
<div class="line">[ swrv ]</div>
<div class="line">swrv = INTEGER:1</div>
<div class="line"> </div>
<div class="line">[ encryption ]</div>
<div class="line">Iv =FORMAT:HEX,OCT:a80fd98d0fec9dd2713877fa314474e6</div>
<div class="line">Rstring = FORMAT:HEX,OCT:ec3ceedfd8de93bd429425222df99330e61e872fd8b969ed1f315cde40cbd178</div>
<div class="line">Icount = INTEGER:1</div>
<div class="line">Salt = FORMAT:HEX,OCT:acca65ded29296fea498ab8a9a15aaa27445ab7c75757c99125254619e4a513b</div>
<div class="line"> </div>
<div class="line">[ key_derivation ]</div>
<div class="line">kd_salt = FORMAT:HEX,OCT:acca65ded29296fea498ab8a9a15aaa27445ab7c75757c99125254619e4a513b</div>
</div><!-- fragment --><p>Note that the salt in encryption extension and key_derivation extension is same. This is designed so that the same derived key can be used for encrypting application images. For more information on the different extensions supported by ROM, please see <a class="el" href="TOOLS_SECURITY.html#TOOLS_BOOT_SIGNING">Signing Scripts</a>.</p>
<p>To build SBL image with certificate for HS-SE devices, one can use the following command:</p>
<div class="fragment"><div class="line">make -s -C examples/drivers/boot/sbl_uart/am263x-cc/r5fss0-0_nortos/ti-arm-clang all DEVICE=am263x DEVICE_TYPE=HS</div>
</div><!-- fragment --><p>This will add the appropriate extensions as part of the X509 certificate and will encrypt the image with Customer MEK as well. </p><dl class="section note"><dt>Note</dt><dd>To build the same via CCS GUI, update the device type on devconfig.mak and rebuild the SBL. </dd>
<dd>
Encryption of SBL images is enabled by default using <code>ENC_SBL_ENABLED</code> flag in devconfig file (which is set as <code>yes</code>).</dd></dl>
<p>Keyring can be imported in SBL by using keyring import module in sysconfig.</p><ul>
<li>Add instance of keyring import module in sysconfig.  <style>div.image img[src="keyring_syscfg_1.png"]{width:50%}</style> <div class="image">
<img src="keyring_syscfg_1.png" alt=""/>
<div class="caption">
Keyring Import Module Instance</div></div>
</li>
<li>Load the keyring certificate header file which is generated using <a class="el" href="TOOLS_SECURITY.html#KEYRING_CERT_GEN_PYTHON_SCRIPT">Keyring Cert Generation Python Script</a>.  <style>div.image img[src="keyring_syscfg_2.png"]{width:50%}</style> <div class="image">
<img src="keyring_syscfg_2.png" alt=""/>
</div>
</li>
</ul>
<p>The sysconfig module auto-generates APIs for keyring import and builds SBL along with keyring certificate. For certificate generation script usage, see <a class="el" href="TOOLS_SECURITY.html#KEYRING_CERT_GEN_PYTHON_SCRIPT">Keyring Cert Generation Python Script</a>.</p>
<h3><a class="anchor" id="APPLICATION_SECURE_IMAGE"></a>
Secure application image Generation</h3>
<p>The SBL doesn't have innate abilities to do the image integrity check, or verify the hash of the application image. It relies on the HSMRt for this. The image is stored in a readable memory and a pointer to the start of the image is passed to the HSMRt with other details like load address, type of authentication etc.</p>
<p>Here is an example of x509 certificate template for application images: </p><div class="fragment"><div class="line">[ req ]</div>
<div class="line">distinguished_name     = req_distinguished_name</div>
<div class="line">x509_extensions        = v3_ca</div>
<div class="line">prompt                 = no</div>
<div class="line"> </div>
<div class="line">dirstring_type = nobmp</div>
<div class="line"> </div>
<div class="line">[ req_distinguished_name ]</div>
<div class="line">C                      = US</div>
<div class="line">ST                     = SC</div>
<div class="line">L                      = New York</div>
<div class="line">O                      = Texas Instruments., Inc.</div>
<div class="line">OU                     = DSP</div>
<div class="line">CN                     = Albert</div>
<div class="line">emailAddress           = Albert@gt.ti.com</div>
<div class="line"> </div>
<div class="line">[ v3_ca ]</div>
<div class="line">basicConstraints = CA:true</div>
<div class="line">1.3.6.1.4.1.294.1.1=ASN1:SEQUENCE:boot_seq</div>
<div class="line">1.3.6.1.4.1.294.1.2=ASN1:SEQUENCE:image_integrity</div>
<div class="line">1.3.6.1.4.1.294.1.3=ASN1:SEQUENCE:swrv</div>
<div class="line"> </div>
<div class="line">1.3.6.1.4.1.294.1.12=ASN1:SEQUENCE:keyring_index</div>
<div class="line"> </div>
<div class="line">[ boot_seq ]</div>
<div class="line">certType     =  INTEGER:2779054080</div>
<div class="line">bootCore     =  INTEGER:0</div>
<div class="line">bootCoreOpts =  INTEGER:0</div>
<div class="line">destAddr     =  FORMAT:HEX,OCT:00000000</div>
<div class="line">imageSize    =  INTEGER:30332</div>
<div class="line"> </div>
<div class="line">[ image_integrity ]</div>
<div class="line">shaType = OID:2.16.840.1.101.3.4.2.3</div>
<div class="line">shaValue = FORMAT:HEX,OCT:fd7e922c982cce91be14d5335c9afe34b171c0686103a0159f2334aa39dcd13f244e9f635216b6178f4f81bb7b67cd7596458f8835322e9e203b1f792ae8e874</div>
<div class="line"> </div>
<div class="line">[ swrv ]</div>
<div class="line">swrv = INTEGER:1</div>
<div class="line"> </div>
<div class="line">[ keyring_index ]</div>
<div class="line">sign_key_id = INTEGER:0</div>
<div class="line">enc_key_id  = INTEGER:0</div>
</div><!-- fragment --><p>The application images can be built with the following flags for appending the X509 certificate for HS-SE devices:</p>
<div class="fragment"><div class="line">make -s -C examples/hello_world/am263x-cc/r5fss0-0_nortos/ti-arm-clang all DEVICE=am263x DEVICE_TYPE=HS</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md648"></a>
RSASSA-PSS Support</h4>
<p>The RSASSA-PSS algorithm can be used instead of the default RSA PKCS#1v1.5 signature algorithm by specifying RSASSAPSS_ENABLED=yes and APP_SIGNING_SALT_LENGTH. Maximum supported salt length value for RSASSA-PSS is <b>255</b>.</p>
<p>See the command below for reference.</p>
<div class="fragment"><div class="line">make -s -C examples/hello_world/am263x-cc/r5fss0-0_nortos/ti-arm-clang all DEVICE=am263x DEVICE_TYPE=HS RSASSAPSS_ENABLED=yes APP_SIGNING_SALT_LENGTH=64</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md649"></a>
Auxiliary Keys Support</h4>
<dl class="section note"><dt>Note</dt><dd>Sample auxiliary keys are present at location <code>${SDK_INSTALL_PATH}/tools/keyring_cert/aux_keys</code>. </dd>
<dd>
RSASSA-PSS algorithm can be used with RSA auxiliary keys.</dd></dl>
<p>The auxiliary keys in both symmetric keyring and asymmetric keyring begin at index 32. The application binary can be signed with an auxiliary private key that has the corresponding public key hash in the keyring. Similarly application binary can be encrypted with auxiliary aes key for which the corresponding aes key is available in the keyring. The customer must specify the keyring index corresponding to the auxiliary key used for authentication and encyrption.</p>
<p>If imported public key is available at index 38 in keyring for brainpoolp512r1_private.pem, the application images can be built with the following flags for appending the X509 certificate for HS-SE devices:</p>
<div class="fragment"><div class="line">make -s -C examples/hello_world/am263x-cc/r5fss0-0_nortos/ti-arm-clang all DEVICE=am263x DEVICE_TYPE=HS APP_SIGNING_KEY_KEYRING_ID=38 APP_SIGNING_KEY=/home/user/ti/mcu_plus_sdk/tools/keyring_cert/aux_keys/brainpoolp512r1_private.pem</div>
</div><!-- fragment --><p>Here is an example of x509 certificate template for application images: </p><div class="fragment"><div class="line">[ req ]</div>
<div class="line">distinguished_name     = req_distinguished_name</div>
<div class="line">x509_extensions        = v3_ca</div>
<div class="line">prompt                 = no</div>
<div class="line"> </div>
<div class="line">dirstring_type = nobmp</div>
<div class="line"> </div>
<div class="line">[ req_distinguished_name ]</div>
<div class="line">C                      = US</div>
<div class="line">ST                     = SC</div>
<div class="line">L                      = New York</div>
<div class="line">O                      = Texas Instruments., Inc.</div>
<div class="line">OU                     = DSP</div>
<div class="line">CN                     = Albert</div>
<div class="line">emailAddress           = Albert@gt.ti.com</div>
<div class="line"> </div>
<div class="line">[ v3_ca ]</div>
<div class="line">basicConstraints = CA:true</div>
<div class="line">1.3.6.1.4.1.294.1.1=ASN1:SEQUENCE:boot_seq</div>
<div class="line">1.3.6.1.4.1.294.1.2=ASN1:SEQUENCE:image_integrity</div>
<div class="line">1.3.6.1.4.1.294.1.3=ASN1:SEQUENCE:swrv</div>
<div class="line"> </div>
<div class="line">1.3.6.1.4.1.294.1.12=ASN1:SEQUENCE:keyring_index</div>
<div class="line"> </div>
<div class="line">[ boot_seq ]</div>
<div class="line">certType     =  INTEGER:2779054080</div>
<div class="line">bootCore     =  INTEGER:0</div>
<div class="line">bootCoreOpts =  INTEGER:0</div>
<div class="line">destAddr     =  FORMAT:HEX,OCT:00000000</div>
<div class="line">imageSize    =  INTEGER:30332</div>
<div class="line"> </div>
<div class="line">[ image_integrity ]</div>
<div class="line">shaType = OID:2.16.840.1.101.3.4.2.3</div>
<div class="line">shaValue = FORMAT:HEX,OCT:fd7e922c982cce91be14d5335c9afe34b171c0686103a0159f2334aa39dcd13f244e9f635216b6178f4f81bb7b67cd7596458f8835322e9e203b1f792ae8e874</div>
<div class="line"> </div>
<div class="line">[ swrv ]</div>
<div class="line">swrv = INTEGER:1</div>
<div class="line"> </div>
<div class="line">[ keyring_index ]</div>
<div class="line">sign_key_id = INTEGER:38</div>
<div class="line">enc_key_id  = INTEGER:0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md650"></a>
Encryption support for application images</h2>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Encrypted MCELF application images retain header informations which allows them to be parsed by tools like readelf.</li>
<li>Booting Signed + Encrypted application images from Flash is now supported. Please refer to the MCELF QSPI/OSPI SBLs and FASTBOOT QSPI/OSPI SBLs.</li>
<li><a class="el" href="FAST_SECURE_BOOT.html">Achieving Fast Secure Boot and Boot time calculator</a></li>
</ul>
</dd></dl>
<p>Optionally, one can encrypt the application image to meet security goals. This can be accomplished with adding one more flag ENC_ENABLED with the make command:</p>
<div class="fragment"><div class="line">make -s -C examples/hello_world/am263x-cc/r5fss0-0_nortos/ti-arm-clang all DEVICE=am263x DEVICE_TYPE=HS ENC_ENABLED=yes</div>
</div><!-- fragment --><p>Here is an example x509 configuration template with apllication authentication and encryption support: </p><div class="fragment"><div class="line">[ req ]</div>
<div class="line">distinguished_name     = req_distinguished_name</div>
<div class="line">x509_extensions        = v3_ca</div>
<div class="line">prompt                 = no</div>
<div class="line"> </div>
<div class="line">dirstring_type = nobmp</div>
<div class="line"> </div>
<div class="line">[ req_distinguished_name ]</div>
<div class="line">C                      = US</div>
<div class="line">ST                     = SC</div>
<div class="line">L                      = New York</div>
<div class="line">O                      = Texas Instruments., Inc.</div>
<div class="line">OU                     = DSP</div>
<div class="line">CN                     = Albert</div>
<div class="line">emailAddress           = Albert@gt.ti.com</div>
<div class="line"> </div>
<div class="line">[ v3_ca ]</div>
<div class="line">basicConstraints = CA:true</div>
<div class="line">1.3.6.1.4.1.294.1.1=ASN1:SEQUENCE:boot_seq</div>
<div class="line">1.3.6.1.4.1.294.1.2=ASN1:SEQUENCE:image_integrity</div>
<div class="line">1.3.6.1.4.1.294.1.3=ASN1:SEQUENCE:swrv</div>
<div class="line">1.3.6.1.4.1.294.1.4 = ASN1:SEQUENCE:encryption</div>
<div class="line">1.3.6.1.4.1.294.1.12=ASN1:SEQUENCE:keyring_index</div>
<div class="line"> </div>
<div class="line">[ boot_seq ]</div>
<div class="line">certType     =  INTEGER:2779054080</div>
<div class="line">bootCore     =  INTEGER:0</div>
<div class="line">bootCoreOpts =  INTEGER:0</div>
<div class="line">destAddr     =  FORMAT:HEX,OCT:00000000</div>
<div class="line">imageSize    =  INTEGER:30368</div>
<div class="line"> </div>
<div class="line">[ image_integrity ]</div>
<div class="line">shaType = OID:2.16.840.1.101.3.4.2.3</div>
<div class="line">shaValue = FORMAT:HEX,OCT:d65fe2f380a4aa365ec90eb646e68c2f1dc738bfd5ba7ee0385cea9f41d1101fac6141c3981367493e17a883d588b692ded275daacaf33ff70a38a5e04cc12fc</div>
<div class="line"> </div>
<div class="line">[ swrv ]</div>
<div class="line">swrv = INTEGER:1</div>
<div class="line"> </div>
<div class="line">[ keyring_index ]</div>
<div class="line">sign_key_id = INTEGER:0</div>
<div class="line">enc_key_id  = INTEGER:0</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[ encryption ]</div>
<div class="line">initalVector =  FORMAT:HEX,OCT:c31abc423ccd831385b7fdd649be0ee1</div>
<div class="line">randomString =  FORMAT:HEX,OCT:347c0707c36290697d294770da607d43d02d41242eadcd718bb825589d437f22</div>
<div class="line">iterationCnt =  INTEGER:1</div>
<div class="line">salt         =  FORMAT:HEX,OCT:acca65ded29296fea498ab8a9a15aaa27445ab7c75757c99125254619e4a513b</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md651"></a>
Encryption support for application images using auxiliary keys</h3>
<p>If imported aes key is available at index 32 in keyring, the application images can be encrypted with the following flags using auxiliary keys support:</p>
<div class="fragment"><div class="line">make -s -C examples/hello_world/am263x-cc/r5fss0-0_nortos/ti-arm-clang all DEVICE=am263x DEVICE_TYPE=HS ENC_ENABLED=yes APP_ENCRYPTION_KEY_KEYRING_ID=32 APP_ENCRYPTION_KEY=/home/fargo/ti/mcu_plus_sdk/source/security/security_common/tools/keyring_cert/aux_keys/aes128.key</div>
</div><!-- fragment --><p>Here is an example of x509 certificate template for application image encrypted with auxiliary key: </p><div class="fragment"><div class="line">[ req ]</div>
<div class="line">distinguished_name     = req_distinguished_name</div>
<div class="line">x509_extensions        = v3_ca</div>
<div class="line">prompt                 = no</div>
<div class="line"> </div>
<div class="line">dirstring_type = nobmp</div>
<div class="line"> </div>
<div class="line">[ req_distinguished_name ]</div>
<div class="line">C                      = US</div>
<div class="line">ST                     = SC</div>
<div class="line">L                      = New York</div>
<div class="line">O                      = Texas Instruments., Inc.</div>
<div class="line">OU                     = DSP</div>
<div class="line">CN                     = Albert</div>
<div class="line">emailAddress           = Albert@gt.ti.com</div>
<div class="line"> </div>
<div class="line">[ v3_ca ]</div>
<div class="line">basicConstraints = CA:true</div>
<div class="line">1.3.6.1.4.1.294.1.1=ASN1:SEQUENCE:boot_seq</div>
<div class="line">1.3.6.1.4.1.294.1.2=ASN1:SEQUENCE:image_integrity</div>
<div class="line">1.3.6.1.4.1.294.1.3=ASN1:SEQUENCE:swrv</div>
<div class="line">1.3.6.1.4.1.294.1.4 = ASN1:SEQUENCE:encryption</div>
<div class="line">1.3.6.1.4.1.294.1.12=ASN1:SEQUENCE:keyring_index</div>
<div class="line"> </div>
<div class="line">[ boot_seq ]</div>
<div class="line">certType     =  INTEGER:2779054080</div>
<div class="line">bootCore     =  INTEGER:0</div>
<div class="line">bootCoreOpts =  INTEGER:0</div>
<div class="line">destAddr     =  FORMAT:HEX,OCT:00000000</div>
<div class="line">imageSize    =  INTEGER:31348</div>
<div class="line"> </div>
<div class="line">[ image_integrity ]</div>
<div class="line">shaType = OID:2.16.840.1.101.3.4.2.3</div>
<div class="line">shaValue = FORMAT:HEX,OCT:ae97e94625db3a363107a904d6f898457e6252e7110e5151b3c0e86e6f9e49892b0b37b9f508b8c1f9c9a6749b98fb180b730f7f0ff0da8dbd660b86bb67ad14</div>
<div class="line"> </div>
<div class="line">[ swrv ]</div>
<div class="line">swrv = INTEGER:1</div>
<div class="line"> </div>
<div class="line">[ keyring_index ]</div>
<div class="line">sign_key_id = INTEGER:0</div>
<div class="line">enc_key_id  = INTEGER:32</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[ encryption ]</div>
<div class="line">initalVector =  FORMAT:HEX,OCT:45867ae0013b6d27942817dbb2b75e4f</div>
<div class="line">randomString =  FORMAT:HEX,OCT:cfdcd84bddbc1ecfdb74bfa6abddb3f6bdb329d99f223fd938c9eaf3b84aacb3</div>
<div class="line">iterationCnt =  INTEGER:1</div>
<div class="line">salt         =  FORMAT:HEX,OCT:acca65ded29296fea498ab8a9a15aaa27445ab7c75757c99125254619e4a513b</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md652"></a>
Limitations in Secure Boot</h1>
<ul>
<li><b>Authentication of application image directly from flash in SBL QSPI</b> : Only authentication of application image from flash is supported in SBL QSPI. This is susceptible to Man-in-The-Middle (MiTM) attacks if Flash is overwritten post-auth.</li>
<li><b>Encryption of application image not supported in SBL QSPI</b> : In UART bootloader, application image can be encrypted using the <code>ENC_ENABLED</code> option in the devconfig.mak. But this is not possible when you load the image using SBL QSPI. This is due to the fact that HSM does an in-place authentication and decryption of the image and we load the image directly from the FLASH memory in case of SBL QSPI. FLASH memory, as you would know is most often not directly writable. Due to this limitation not being taken care in the HSM, we can do decryption of images only in the case where the image resides in a volatile RAM-like memory like OCRAM. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
