<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Enet CPSW Ether-Ring CAN Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_ENET_CPSW_ETHERRING_CAN.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Enet CPSW Ether-Ring CAN Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md3097">Introduction</a><ul><li class="level2"><a href="#autotoc_md3098">Zonal Controllers: Localized Intelligence</a></li>
<li class="level2"><a href="#autotoc_md3099">The Role of CAN Communication within a Zone</a></li>
<li class="level2"><a href="#autotoc_md3100">Bridging the Gap: CAN to Ethernet Communication</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md3101">Ether-Ring overview</a></li>
<li class="level1"><a href="#autotoc_md3102">Ether-Ring CAN Software Architecture</a></li>
<li class="level1"><a href="#autotoc_md3103">Application Functionality</a><ul><li class="level2"><a href="#autotoc_md3104">CAN Traffic Generator</a><ul><li class="level3"><a href="#autotoc_md3105">Traffic Generator Configuration</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md3106">CAN-ETH Gateway</a><ul><li class="level3"><a href="#autotoc_md3107">Gateway Look-up</a></li>
<li class="level3"><a href="#autotoc_md3108">CAN Encapsulation/Decapsulation</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md3109">Ethernet Transmit App</a></li>
<li class="level2"><a href="#autotoc_md3110">Ethernet Receive App</a></li>
<li class="level2"><a href="#autotoc_md3111">MCAN Transmit App</a></li>
<li class="level2"><a href="#autotoc_md3112">MCAN Receive App</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md3113">Round Trip Latency Measurement</a></li>
<li class="level1"><a href="#autotoc_md3114">Ether-Ring CAN Application Sequence Diagram</a><ul><li class="level2"><a href="#autotoc_md3115">ALE Configuration</a></li>
<li class="level2"><a href="#autotoc_md3116">Ether-Ring Start Menu</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md3117">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md3118">Packet pool configuration</a></li>
<li class="level1"><a href="#autotoc_md3119">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md3120">Build the example</a></li>
<li class="level2"><a href="#autotoc_md3121">HW Setup</a></li>
<li class="level2"><a href="#autotoc_md3122">Run the example</a><ul><li class="level3"><a href="#autotoc_md3123">Basic Test</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md3124">Sample output with &quot;ETHERRING_MCAN_ENABLE_PROFILING&quot; Enabled</a><ul><li class="level3"><a href="#autotoc_md3125">Source Node(Node0)</a></li>
<li class="level3"><a href="#autotoc_md3126">Destination Node(Node0)</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md3127">Sample output with &quot;ETHERRING_MCAN_ENABLE_PROFILING&quot; Disabled</a><ul><li class="level3"><a href="#autotoc_md3128">Source Node(Node0)</a></li>
<li class="level3"><a href="#autotoc_md3129">Destination Node(Node0)</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md3130">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_networking_enet_cpsw_etherring_can"></a></p>
<h1><a class="anchor" id="autotoc_md3097"></a>
Introduction</h1>
<p>Modern vehicle architectures are increasingly adopting a distributed control approach, moving away from centralized Electronic Control Units (ECUs) towards a network of interconnected zonal controllers. Ether-Ring Architecture reduces wiring and improves reliability by adding redundancy.</p>
<h2><a class="anchor" id="autotoc_md3098"></a>
Zonal Controllers: Localized Intelligence</h2>
<p>Zonal controllers are essentially powerful, localized ECUs responsible for managing a specific zone or region within the vehicle (e.g., the driverâ€™s door, the front-left wheel well). They directly interface with sensors and actuators within their zone, processing data locally and reducing the load on the central vehicle computer. This localized intelligence leads to faster reaction times for critical functions and reduces the impact of network congestion.</p>
<h2><a class="anchor" id="autotoc_md3099"></a>
The Role of CAN Communication within a Zone</h2>
<p>Within each zone, the primary communication protocol is typically Controller Area Network (CAN). CAN provides a robust and reliable method for short-range, real-time communication between sensors, actuators, and the zonal controller itself. Critical data such as sensor readings (temperature, pressure, position) and control commands (motor speeds, valve positions) are exchanged over the CAN bus. The inherent deterministic nature of CAN is crucial for safety-critical applications.</p>
<h2><a class="anchor" id="autotoc_md3100"></a>
Bridging the Gap: CAN to Ethernet Communication</h2>
<p>While CAN is ideal for in-zone communication, it lacks the bandwidth and range required for communication between zones or with higher-level systems (e.g., a central domain controller or cloud services). This is where Ethernet comes into play. Ethernet provides the high bandwidth and long-distance capabilities necessary for broader vehicle network connectivity. However, CAN and Ethernet are fundamentally different protocols. Direct communication between CAN and Ethernet networks is not possible. This necessitates a bridging mechanism to translate and forward data between the two domains.</p>
<p>This application focuses on sending/receiving the CAN vehicle data within Ether-Ring Architecture. CAN-Ethernet Gateway is also implemented to encapsulate/decapsulate the CAN packets. Few CAN Traffic generator configuration parameters are left to customer to modify it based on usecase.</p>
<h1><a class="anchor" id="autotoc_md3101"></a>
Ether-Ring overview</h1>
<p>Please refer <b><a class="el" href="ETHERRING_OVERVIEW.html">here</a></b> for Ether-Ring overview</p>
<h1><a class="anchor" id="autotoc_md3102"></a>
Ether-Ring CAN Software Architecture</h1>
<div class="image">
<img src="software_block_diagram.png" alt="" width="35%"/>
<div class="caption">
Software Arch </div></div>
<h1><a class="anchor" id="autotoc_md3103"></a>
Application Functionality</h1>
<div class="image">
<img src="can_block_diagram_etherring.png" alt="" width="70%"/>
<div class="caption">
Packet Flow </div></div>
<p>Application contains following three major functionaties </p>
<h2><a class="anchor" id="autotoc_md3104"></a>
CAN Traffic Generator</h2>
<p>The CAN Traffic Generator is a key functionality of the application, responsible for generating periodic CAN data that simulates sensor/actuator vehicle data in a vehicle. This feature is highly configurable, allowing users to customize the traffic generation process to suit their specific needs. </p>
<h3><a class="anchor" id="autotoc_md3105"></a>
Traffic Generator Configuration</h3>
<p>The traffic generator configuration consists of the following parameters:</p>
<center> <table class="doxtable">
<caption>Packet parameters</caption>
<tr>
<th>Parameter </th><th>Description </th></tr>
<tr>
<td>'CAN_msgId' </td><td>The Message ID of the CAN packet generated by the traffic generator. </td></tr>
<tr>
<td>'payloadSize' </td><td>The payload size of the CAN packet generated by the traffic generator. </td></tr>
<tr>
<td>'periodicity' </td><td>The periodicity of the CAN packet, measured in microseconds. </td></tr>
<tr>
<td>'packetCountPerTick' </td><td>The number of CAN packets to be generated for each timer tick. </td></tr>
<tr>
<td>'maxPacketSend' </td><td>The maximum number of CAN packets to be generated. If set to 0, packets are sent periodically and continuously. </td></tr>
<tr>
<td>'hasAllCanPktsSent' </td><td>Flag to check whether the all the packets of that configuration is generated. </td></tr>
</table>
</center><center> <table class="doxtable">
<caption>Traffic Generator Configuration</caption>
<tr>
<th>Parameter </th><th>Description </th></tr>
<tr>
<td>'timerTickPeriodicityInus' </td><td>The periodicity of the hardware timer, measured in microseconds. </td></tr>
<tr>
<td>'validPktParamsCount' </td><td>Valid number of CAN packet configurations to be generated by CAN Traffic Generator </td></tr>
<tr>
<td>'rxReadyElementQ' </td><td>Queue to hold the generated CAN packets. This queue will be used by Ethernet App to dequeue the element and send it via CAN-ETH Gateway. </td></tr>
<tr>
<td>'pktParams[]' </td><td>Array of "Packet parameters" </td></tr>
</table>
</center><p>The traffic generator checks the number of valid packet parameters (validPktParamsCount) at each timer tick. If the timer tick interval matches the scheduled periodicity of a CAN packet parameter, the traffic generator creates a new CAN packet. The generated CAN packet is filled with the configured CAN Message ID, payload, and other parameters. Each packet parameter maintains a packetCounter to track whether the maximum packet count has been reached. CAN packets will be sent periodically forever If "maxPacketSend" is configured as "0" or else only maxPacketSend CAN packets will be generated.</p>
<p>By default, a free queue of size 32 (defined by ENETAPP_MAX_CANPKT_MEMBLOCKS) is created initially, and the traffic generator dequeues a free CAN element, fills it based on the packet configuration, and enqueues it to the rxReadyElementQ for the Tx task to process. The Tx task then encapsulates the CAN packet into an Ethernet packet using the CAN-ETH Gateway.</p>
<h2><a class="anchor" id="autotoc_md3106"></a>
CAN-ETH Gateway</h2>
<p>The CAN-ETH Gateway is a crucial component of the application, responsible for converting CAN messages to AVTP packets and vice versa. It consists of two primary parts: Gateway Look-up and CAN Encapsulation/Decapsulation.</p>
<h3><a class="anchor" id="autotoc_md3107"></a>
Gateway Look-up</h3>
<p>Look-up table is maintained to map the CAN MessageID to the Destination Mac address. This is mainly used for CAN Encapsulation to Ethernet packet.The below table shows the default Look-up table configured in Application and user should be able to modify this based on thier usecase.</p>
<center> <table class="doxtable">
<caption>Look-up Table</caption>
<tr>
<th>CAN Message ID </th><th>Destination Mac address </th></tr>
<tr>
<td>0x2 </td><td>01:00:5E:7F:FF:02 </td></tr>
<tr>
<td>0x1 </td><td>01:00:5E:7F:FF:01 </td></tr>
<tr>
<td>0x3 </td><td>01:00:5E:7F:FF:03 </td></tr>
<tr>
<td>0xFF </td><td>FF:FF:FF:FF:FF:FF </td></tr>
</table>
</center><p>To achieve low software latency, the destination Mac address for a given CAN Message ID must be fetched quickly. The brute force method to fetch the element with index/key from array takes O(N2) time complexity. In this application, the Look-up table is sorted with "CAN Message ID" at init and also at every time new element is added to the Look-up table. The assumption is that the Look-up table is static at run-time and it is configured only at init. With the sorted Look-up table, the time complexity to fetch any element is reduced to O(logN). This application uses Merge sort and standard binary search is used to fetch the element.</p>
<h3><a class="anchor" id="autotoc_md3108"></a>
CAN Encapsulation/Decapsulation</h3>
<p>CAN Encapsulation is the process of converting CAN packets to AVTP packets for transmission over Ethernet. In this application, CAN packets are encapsulated and decapsulated using the IEEE 1722 CAN/CAN FD ACF packet format. For encapsulation, the Gateway checks the Message ID of the CAN packet and fetches the Destination Mac address from the look-up table. The Ethernet packet is then formed using the Destination Mac and CAN packet content. For decapsulation, the Gateway forms the CAN packet from the Ethernet packet, and the look-up table is not involved in this process. The idea behind decapsulation is to send the CAN packet to all available CAN interfaces in the Zonal controller, as Ethernet is only used for transportation. </p><div class="image">
<img src="can_encap_decap_etherring.png" alt="" width="70%"/>
<div class="caption">
CAN Encap/Decap </div></div>
<p>IEEE 1722 CAN ACF Packet Format is shown below </p><div class="image">
<img src="1722_can_acf_pkt.png" alt="" width="60%"/>
<div class="caption">
IEEE 1722 CAN ACF Packet Format </div></div>
 <h2><a class="anchor" id="autotoc_md3109"></a>
Ethernet Transmit App</h2>
<p>The CAN Transmit App is responsible for transmitting CAN packets over the Ethernet network using the IEEE 1722 ACF packet format. The transmission process is triggered by a periodic timer, which creates and enqueues CAN packets into the rxReadyElementQ. The Tx Task then dequeues the CAN packet from the queue and uses the Gateway to encapsulate it into a IEEE 1722 ACF packet. The packet is then submitted to the CPDMA for transmission over both Mac ports to other zonal controllers in the EtherRing.</p>
<p>Currently, the Traffic Generator pushes the CAN packet into the rxReadyElementQ. However, users are free to modify this and use actual CAN packets from the MCAN driver, which can be pushed into the same queue for encapsulation. </p><div class="image">
<img src="can_block_diagram_tx_etherring.png" alt="" width="70%"/>
<div class="caption">
Packet Flow </div></div>
<h2><a class="anchor" id="autotoc_md3110"></a>
Ethernet Receive App</h2>
<p>The CAN Receive App is responsible for receiving CAN packets over the Ethernet network using the IEEE 1722 ACF packet format. The reception process is triggered by a CPDMA Rx interrupt, which releases a semaphore for the Rx Task. The Rx Task then retrieves the Ethernet packet and checks if it is in the IEEE 1722 ACF CAN format. If it is, the packet is sent via the Gateway to decapsulate the CAN packet. Once the CAN packet is retrieved, it is not currently consumed by the application. However, users are free to modify this and send the CAN packet to an actual CAN interface.</p>
<div class="image">
<img src="can_block_diagram_rx_etherring.png" alt="" width="70%"/>
<div class="caption">
Packet Flow </div></div>
<h2><a class="anchor" id="autotoc_md3111"></a>
MCAN Transmit App</h2>
<p>The MCAN Transmit Application utilizes the MCAN Low-Level Driver (LLD) to transmit and receive CAN packets via the on-board MCAN transceiver. During initialization, the MCAN driver is configured with standard ID filter elements, and CAN packet Interrupt Service Routines (ISRs) are registered. The application operates in buffer mode for both transmission and reception.</p>
<p>The CAN packets received from the "Ethernet Receive Application" are transmitted to the CAN bus without modification. The MCAN transmit completion and error statistics are updated accordingly to ensure accurate tracking of transmission performance.</p>
<h2><a class="anchor" id="autotoc_md3112"></a>
MCAN Receive App</h2>
<p>Upon receipt of the MCAN Receive ISR, the buffer number is calculated based on the MCAN0 status bit. The CAN message is then read from the Message RAM using the calculated buffer number. It is essential to configure the filter to receive specific "message IDs" and "buffer numbers" during the initialization process to ensure proper reception of CAN messages.</p>
<p>Note: The configuration of the filter is a critical step in the initialization process, as it determines which CAN messages are received and processed by the application.</p>
<dl class="section note"><dt>Note</dt><dd>In this application, only 'Node0' acts as CAN traffic generator(Tx Task) and all the nodes has Rx Task. By default, Node0 sends CAN packets only to Node2.</dd></dl>
<h1><a class="anchor" id="autotoc_md3113"></a>
Round Trip Latency Measurement</h1>
<div class="image">
<img src="etherring_can_latency_measurement.png" alt="" width="60%"/>
<div class="caption">
Round Trip Latency Measurement </div></div>
<p> The Round Trip Latency is measured by recording the time it takes for a CAN packet to travel from the source node (Node 0) to the destination node (Node 2) and back. The process involves the following steps:</p>
<p><a class="el" href="structTimestamp.html" title="The Timestamp type represents a positive time with respect to the epoch.">Timestamp</a> Generation: When a CAN packet is generated by the traffic generator, the current CPTS (Clock Precision Time Synchronization) timestamp is stored and pushed into the timeStampReadyQueue. Packet Transmission: The CAN packet is encapsulated and transmitted to the destination node (Node 2) via the Ether-Ring network. Packet Decapsulation and Response: At the destination node, the CAN packet is decapsulated from the Ethernet packet and sent back to the source node (Node 0) using the on-board MCAN transceiver. Round Trip Latency Calculation: When the packet returns to the source node, a new CPTS timestamp is generated. The difference between this new timestamp and the original timestamp dequeued from the timeStampReadyQueue is calculated, resulting in the Round Trip Latency.</p>
<p>Please refer <b><a class="el" href="enetlld_performance.html">here</a></b> for Ether-Ring performance</p>
<h1><a class="anchor" id="autotoc_md3114"></a>
Ether-Ring CAN Application Sequence Diagram</h1>
<div class="image">
<img src="software_diagram_etherring_can_app.png" alt="" width="60%"/>
<div class="caption">
Application Flow </div></div>
<h2><a class="anchor" id="autotoc_md3115"></a>
ALE Configuration</h2>
<ul>
<li>Each Node adds Multicast entry with mac address "01:00:5E:7F:FF:&lt;node_id&gt;" and port mask "0x1"(Only Host Port).</li>
</ul>
<h2><a class="anchor" id="autotoc_md3116"></a>
Ether-Ring Start Menu</h2>
<p>The following helper options are also provided in the application's start menu to configure the each node uniquely in Etherring:</p>
<div class="fragment"><div class="line">0 - Central Compute Node</div>
<div class="line">1 - Zone Left Node</div>
<div class="line">2 - Zone Right Node</div>
<div class="line">3 - Zone Tail Node</div>
<div class="line">Enter the nodeId : </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3117"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263x-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">source/networking/enet/core/examples/etherring_can   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md3118"></a>
Packet pool configuration</h1>
<p>To change packet pool configuration from syscfg, please refer to <a class="el" href="PACKETPOOL_CONFIG_TOP.html">Ethernet Packet Pool Allocation Guidelines</a></p>
<h1><a class="anchor" id="autotoc_md3119"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md3120"></a>
Build the example</h2>
<ul>
<li>When using CCS projects to build, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li>When using makefiles to build, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md3121"></a>
HW Setup</h2>
<p>Make sure you have setup the EVM with cable connections as shown in below Diagram. In addition, follow the steps in the next section.</p>
<div class="image">
<img src="etherring_can_evm.png" alt="" width="30%"/>
<div class="caption">
Ether-Ring EVM Connections </div></div>
<dl class="section note"><dt>Note</dt><dd>Ethernet cable must be connected to both the ports in loop for the example application to run with expected results.</dd></dl>
<h2><a class="anchor" id="autotoc_md3122"></a>
Run the example</h2>
<h3><a class="anchor" id="autotoc_md3123"></a>
Basic Test</h3>
<p>The simplest test that one can run with the ETHERRING example consists of:</p><ul>
<li>Configuring the each node uniquely in the Ether-ring Network</li>
<li>Configures CAN Traffic generator to similate the vehicle data and CAN-ETH Gateway for encapsulation/decapsulation</li>
</ul>
<p>The steps to run this test are:</p>
<ul>
<li>Connect the MAC port as described in <b>HW Setup</b> section and configure the Nodes using UART Terminal.</li>
<li>Launch a CCS debug session and run the example executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a>.</li>
<li>Application logs such as CAN and Ethernet Tx, Rx Packet count on both source node(node0) and destination node(node2) will be printed. "ETHERRING_MCAN_ENABLE_PROFILING" Macro needs to be commented to see the Packet count logs. By default, only average and Maximum round trip latency is printed on terminal. Sample logs are shown in the next section.</li>
<li>Using a UART terminal, configure each node according to the instructions in the Ether-Ring Start Menu section. Initially, set up Node1, Node2, and Node3, and put them in a waiting state for link establishment. Once these nodes are configured, proceed to configure Node0 (the traffic generator) to initiate the transmission of CAN traffic. Here Node1 and Node3 just act as switch which forwards the ethernet packets.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3124"></a>
Sample output with "ETHERRING_MCAN_ENABLE_PROFILING" Enabled</h2>
<h3><a class="anchor" id="autotoc_md3125"></a>
Source Node(Node0)</h3>
<div class="fragment"><div class="line">==========================</div>
<div class="line">     EtherRing CAN App    </div>
<div class="line">==========================</div>
<div class="line">0 - Central Compute Node</div>
<div class="line">1 - Zone Left Node</div>
<div class="line">2 - Zone Right Node</div>
<div class="line">3 - Zone Tail Node</div>
<div class="line">Enter the nodeId : </div>
<div class="line">0</div>
<div class="line">start to open driver.</div>
<div class="line"> </div>
<div class="line">Init all configs</div>
<div class="line">----------------------------------------------</div>
<div class="line">init config</div>
<div class="line">Open MAC port 1</div>
<div class="line">EnetPhy_bindDriver: PHY 3: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">Open MAC port 2</div>
<div class="line">EnetPhy_bindDriver: PHY 12: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">PHY 3 is alive</div>
<div class="line">PHY 12 is alive</div>
<div class="line">initQs() txFreePktInfoQ initialized with 16 pkts</div>
<div class="line">MAC port addr: 34:08:e1:84:dd:31</div>
<div class="line">[MCAN App] Mcan Driver Configured</div>
<div class="line">Waiting for link up...</div>
<div class="line">Cpsw_handleLinkUp: Port 2: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 2: link up</div>
<div class="line">Cpsw_handleLinkUp: Port 1: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 1: link up</div>
<div class="line">Ethernet RX Task created</div>
<div class="line">Ethernet TX Task created</div>
<div class="line">Generating CAN Traffic</div>
<div class="line">[MCAN Rx App] Avg Round Trip Time:561 us</div>
<div class="line">[MCAN Rx App] Max Round Trip Time:569 us</div>
<div class="line">EtherRing CAN Test Passed</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3126"></a>
Destination Node(Node0)</h3>
<div class="fragment"><div class="line">==========================</div>
<div class="line">     EtherRing CAN App    </div>
<div class="line">==========================</div>
<div class="line">0 - Central Compute Node</div>
<div class="line">1 - Zone Left Node</div>
<div class="line">2 - Zone Right Node</div>
<div class="line">3 - Zone Tail Node</div>
<div class="line">Enter the nodeId : </div>
<div class="line">2</div>
<div class="line">start to open driver.</div>
<div class="line"> </div>
<div class="line">Init all configs</div>
<div class="line">----------------------------------------------</div>
<div class="line">init config</div>
<div class="line">Open MAC port 1</div>
<div class="line">EnetPhy_bindDriver: PHY 3: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">Open MAC port 2</div>
<div class="line">EnetPhy_bindDriver: PHY 12: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">PHY 3 is alive</div>
<div class="line">PHY 12 is alive</div>
<div class="line">initQs() txFreePktInfoQ initialized with 16 pkts</div>
<div class="line">MAC port addr: 34:08:e1:84:db:cf</div>
<div class="line">[MCAN App] Mcan Driver Configured</div>
<div class="line">Waiting for link up...</div>
<div class="line">Cpsw_handleLinkUp: Port 2: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 2: link up</div>
<div class="line">Cpsw_handleLinkUp: Port 1: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 1: link up</div>
<div class="line">Ethernet RX Task created</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3127"></a>
Sample output with "ETHERRING_MCAN_ENABLE_PROFILING" Disabled</h2>
<h3><a class="anchor" id="autotoc_md3128"></a>
Source Node(Node0)</h3>
<div class="fragment"><div class="line">==========================</div>
<div class="line">     EtherRing CAN App    </div>
<div class="line">==========================</div>
<div class="line">0 - Central Compute Node</div>
<div class="line">1 - Zone Left Node</div>
<div class="line">2 - Zone Right Node</div>
<div class="line">3 - Zone Tail Node</div>
<div class="line">Enter the nodeId : </div>
<div class="line">0</div>
<div class="line">start to open driver.</div>
<div class="line"> </div>
<div class="line">Init all configs</div>
<div class="line">----------------------------------------------</div>
<div class="line">init config</div>
<div class="line">Open MAC port 1</div>
<div class="line">EnetPhy_bindDriver: PHY 3: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">Open MAC port 2</div>
<div class="line">EnetPhy_bindDriver: PHY 12: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">PHY 3 is alive</div>
<div class="line">PHY 12 is alive</div>
<div class="line">initQs() txFreePktInfoQ initialized with 16 pkts</div>
<div class="line">MAC port addr: 34:08:e1:84:dd:31</div>
<div class="line">[MCAN App] Mcan Driver Configured</div>
<div class="line">Waiting for link up...</div>
<div class="line">Cpsw_handleLinkUp: Port 1: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 1: link up</div>
<div class="line">Cpsw_handleLinkUp: Port 2: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 2: link up</div>
<div class="line">Ethernet RX Task created</div>
<div class="line">Ethernet TX Task created</div>
<div class="line">Generating CAN Traffic</div>
<div class="line">[Traffic Gen] Generated 1000 CAN packet of CAN Message ID: 2</div>
<div class="line">[MCAN Rx App] Received 1000 CAN packets from CAN bus</div>
<div class="line">EtherRing CAN Test Passed</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3129"></a>
Destination Node(Node0)</h3>
<div class="fragment"><div class="line">==========================</div>
<div class="line">     EtherRing CAN App    </div>
<div class="line">==========================</div>
<div class="line">0 - Central Compute Node</div>
<div class="line">1 - Zone Left Node</div>
<div class="line">2 - Zone Right Node</div>
<div class="line">3 - Zone Tail Node</div>
<div class="line">Enter the nodeId : </div>
<div class="line">2</div>
<div class="line">start to open driver.</div>
<div class="line"> </div>
<div class="line">Init all configs</div>
<div class="line">----------------------------------------------</div>
<div class="line">init config</div>
<div class="line">Open MAC port 1</div>
<div class="line">EnetPhy_bindDriver: PHY 3: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">Open MAC port 2</div>
<div class="line">EnetPhy_bindDriver: PHY 12: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;DP83869&#39; : OK</div>
<div class="line">PHY 3 is alive</div>
<div class="line">PHY 12 is alive</div>
<div class="line">initQs() txFreePktInfoQ initialized with 16 pkts</div>
<div class="line">MAC port addr: 34:08:e1:84:db:cf</div>
<div class="line">[MCAN App] Mcan Driver Configured</div>
<div class="line">Waiting for link up...</div>
<div class="line">Cpsw_handleLinkUp: Port 1: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 1: link up</div>
<div class="line">Cpsw_handleLinkUp: Port 2: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 2: link up</div>
<div class="line">Ethernet RX Task created</div>
<div class="line">Cpsw_handleLinkDown: Port 1: Link down</div>
<div class="line">Cpsw_handleLinkDown: Port 2: Link down</div>
<div class="line">MAC Port 1: link down</div>
<div class="line">MAC Port 2: link down</div>
<div class="line">Cpsw_handleLinkUp: Port 2: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 2: link up</div>
<div class="line">Cpsw_handleLinkUp: Port 1: Link up: 1-Gbps Full-Duplex</div>
<div class="line">MAC Port 1: link up</div>
<div class="line">[Ethernet Rx App] Received 1000 EtherRing CAN packets to Rx Eth task</div>
<div class="line">[MCAN Tx App] Sent 1000 CAN packets to CAN bus</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md3130"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
