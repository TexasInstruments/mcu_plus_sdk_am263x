<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: PRUICSS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DRIVERS_PRUICSS_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PRUICSS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1210">Features Supported</a></li>
<li class="level1"><a href="#autotoc_md1211">SysConfig Features</a></li>
<li class="level1"><a href="#PRUICSS_INTC">PRUICSS Interrupt Controller</a></li>
<li class="level1"><a href="#autotoc_md1212">Example Usage</a></li>
<li class="level1"><a href="#autotoc_md1213">API</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_drivers_pruicss_m_v0"></a></p>
<p>Programmable Real-Time Unit and Industrial Communication Subsystem(PRU-ICSS) driver provides a well-defined API layer which allows applications to use the PRU-ICSS. PRU-ICSS is firmware programmable and can take on various personalities like Industrial Communication Protocol Switch (for protocols like EtherCAT, Profinet, EtherNet/IP), Ethernet Switch, Ethernet MAC, Industrial Drives, etc.</p>
<h1><a class="anchor" id="autotoc_md1210"></a>
Features Supported</h1>
<ul>
<li>PRU control features like enabling/disabling/resetting a Programmable Real-Time Units (PRU0 and PRU1)</li>
<li>Loading the firmware in PRU cores</li>
<li>Read/Write/Reset different memories inside PRU-ICSS</li>
<li>PRU and Host Event management. It does mapping of sys_evt/channel/hosts in the INTC module. APIs to register interrupt handler for events, generate an event, wait for occurrence of an event, and clear an event.</li>
<li>Basic configurations in registers like GPCFG, MII_RT_G_CFG, ICSSG_SA_MX</li>
<li>IEP clock selection, IEP counter enable/disable, IEP counter increment configuration</li>
<li>PRU Constant Table Configuration</li>
</ul>
<h1><a class="anchor" id="autotoc_md1211"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<ul>
<li>Option to select the PRU-ICSS instance</li>
<li>Option to select the Core Clock Frequency</li>
<li>Based on above parameters, the SysConfig generated code does following:<ul>
<li>Call <a class="el" href="group__DRV__PRUICSS__MODULE.html#gadbc52bd3d18cd189cafea5c8dd743d12">PRUICSS_init</a> in System_init, and <a class="el" href="group__DRV__PRUICSS__MODULE.html#ga3776ca5f8f753aea784e39f8bfe27ced">PRUICSS_deinit</a> in System_deinit</li>
<li>Enable the Core Clock and set the selected frequency</li>
<li>Create macros like <code>CONFIG_PRU_ICSS0</code> using the name passed in SysConfig. This is used as an input to <a class="el" href="group__DRV__PRUICSS__MODULE.html#ga6779b9e50b38ea5061d7fe0803956024">PRUICSS_open</a> API.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="PRUICSS_INTC"></a>
PRUICSS Interrupt Controller</h1>
<p>The interrupt controller (INTC) module maps interrupts coming from different parts of the device (mapped to PRU-ICSS instance) to a reduced set of interrupt channels.</p>
<p>The interrupt controller has the following features:</p><ul>
<li>Capturing up to 64 Events (inputs)</li>
<li>Supports up to 10 output interrupt channels</li>
<li>Generation of 10 Host Interrupts</li>
<li>Each event can be enabled and disabled.</li>
<li>Each host event can be enabled and disabled.</li>
</ul>
<p>Following is an example of one mapping from <code>${SDK_INSTALL_PATH}/source/industrial_comms/ethercat_slave/icss_fwhal/tiesc_pruss_intc_mapping.h</code> used for EtherCAT SubDevice.</p>
<p>The following line maps <code>PRU_ARM_EVENT2</code> to <code>CHANNEL6</code>.</p>
<div class="fragment"><div class="line">{PRU_ARM_EVENT2,CHANNEL6, SYS_EVT_POLARITY_HIGH, SYS_EVT_TYPE_EDGE},\</div>
</div><!-- fragment --><p><code>CHANNEL6</code> is mapped to the fourth host interrupt mapped to device level interrupt controller(Host Interrupt 6 out of 20) through this line.</p>
<div class="fragment"><div class="line">{CHANNEL6, PRU_EVTOUT4}</div>
</div><!-- fragment --><p>In AM64x, <code>PRU_ICSSG0_PR1_HOST_INTR_PEND_0</code>-<code>PRU_ICSSG0_PR1_HOST_INTR_PEND_7</code> (8 host interrupts) are mapped to <code>R5FSS0_CORE0_INTR_IN_120</code>-<code>R5FSS0_CORE0_INTR_IN_127</code>. This values are for ICSSG0 events mapped to R5FSS0 CORE0. For details regarding interrupt numbers on other cores, please refer to "9.4 Interrupt Sources" section in Technical Reference Manual(TRM) of AM64x, or corresponding section in TRM of other SoCs. These interrupt numbers can change from SoC to SoC, so please consult TRM before making any modifications to the interrupt map.</p>
<p>For the example mentioned above, interrupt number 124 (<code>R5FSS0_CORE0_INTR_IN_124</code>) should be used for <code>intrNum</code> parameter for <a class="el" href="group__DRV__PRUICSS__MODULE.html#ga33ff83157feb722e1b6c00885f09abe5">PRUICSS_registerIrqHandler</a>. <a class="el" href="group__DRV__PRUICSS__MODULE.html#ga33ff83157feb722e1b6c00885f09abe5">PRUICSS_registerIrqHandler</a> creates Hwi instance using <a class="el" href="group__KERNEL__DPL__HWI.html#gacda2e6e40428be67320f57d0676e4bd1">HwiP_construct</a> API with the <code>intrNum</code> passed,</p>
<p>This mapping alone determines which interrupt number on R5F will be associated with a particular interrupt from PRUICSS. For example, in the code shown above, where `<code>PRU_ARM_EVENT2</code> maps to <code>CHANNEL6</code>, and <code>CHANNEL6</code> maps to <code>PRU_EVTOUT4</code> can be modified to following, and the interrupt number on R5F would still remain the same.</p>
<div class="fragment"><div class="line">{PRU_ARM_EVENT2,CHANNEL7, SYS_EVT_POLARITY_HIGH, SYS_EVT_TYPE_EDGE},\</div>
<div class="line">{CHANNEL7, PRU_EVTOUT4}</div>
</div><!-- fragment --><p>But the usefulness of channels is that channels allow us to map multiple PRU events to a single channel and in turn to a single host interrupt. For example, take a look at the following mapping used for link interrupt.</p>
<div class="fragment"><div class="line">{MII_LINK0_EVENT, CHANNEL1, SYS_EVT_POLARITY_HIGH, SYS_EVT_TYPE_PULSE},\</div>
<div class="line">{MII_LINK1_EVENT, CHANNEL1, SYS_EVT_POLARITY_HIGH, SYS_EVT_TYPE_PULSE},\</div>
<div class="line">{CHANNEL1, PRU1}</div>
</div><!-- fragment --><p>This configuration maps both Port 0 and Port 1 link interrupts to a single channel and in turn to a single host interrupt for PRU1 (Host Interrupt 1 out of 20).</p>
<p><a class="el" href="group__DRV__PRUICSS__MODULE.html#gacb9fcd2e989376394c0c628ea9ddc39f">PRUICSS_intcInit</a> API should be used to configure the INTC module.</p>
<h1><a class="anchor" id="autotoc_md1212"></a>
Example Usage</h1>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pruicss_8h.html">drivers/pruicss.h</a>&gt;</span></div>
</div><!-- fragment --><p> Instance Open Example </p><div class="fragment"><div class="line">    <span class="comment">/*Use CONFIG_PRU_ICSS0 macro as parameter to PRUICSS_open */</span></div>
<div class="line">    gPruicssHandle = <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga6779b9e50b38ea5061d7fe0803956024">PRUICSS_open</a>(CONFIG_PRU_ICSS0);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(gPruicssHandle != NULL);</div>
</div><!-- fragment --><p> Sequence for loading a firmware on PRU and running the PRU core </p><div class="fragment"><div class="line">    <span class="comment">/* Reset and disable PRU core */</span></div>
<div class="line">    <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga96adaeaa6576f836f15f28052c5d4c3a">PRUICSS_resetCore</a>(gPruicssHandle, <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga5d7a6d9f38b8cc1f8b15b9324c868fd8">PRUICSS_PRU0</a>);</div>
<div class="line">    <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga37cdf26e6f52377b9bc2806417c1d201">PRUICSS_disableCore</a>(gPruicssHandle, <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga5d7a6d9f38b8cc1f8b15b9324c868fd8">PRUICSS_PRU0</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Register an Interrupt Handler for an event */</span></div>
<div class="line">    <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga33ff83157feb722e1b6c00885f09abe5">PRUICSS_registerIrqHandler</a>(gPruicssHandle,</div>
<div class="line">                               pruEvtoutNum,</div>
<div class="line">                               intrNum,</div>
<div class="line">                               eventNum,</div>
<div class="line">                               waitEnable,</div>
<div class="line">                               irqHandler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* API to do Interrupt-Channel-host mapping */</span></div>
<div class="line">    <a class="code" href="group__DRV__PRUICSS__MODULE.html#gacb9fcd2e989376394c0c628ea9ddc39f">PRUICSS_intcInit</a>(gPruicssHandle, &amp;pruicssIntcInitData);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Load the IRAM in PRU */</span></div>
<div class="line">    <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga57ddb3591be2f0adf90894e715e52836">PRUICSS_writeMemory</a>(gPruicssHandle,</div>
<div class="line">                        <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga1a7f96fd81bc1502778e59372a5ec740">PRUICSS_IRAM_PRU</a>(0),</div>
<div class="line">                        0,</div>
<div class="line">                        (uint32_t *) pruFirmware,</div>
<div class="line">                        pruFirmwareLength);</div>
<div class="line">    <span class="comment">/* Enable PRU */</span></div>
<div class="line">    <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga38b0b2f969a1f8f6fa7e7d911f07dc71">PRUICSS_enableCore</a>(gPruicssHandle, <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga5d7a6d9f38b8cc1f8b15b9324c868fd8">PRUICSS_PRU0</a>);</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md1213"></a>
API</h1>
<p><a class="el" href="group__DRV__PRUICSS__MODULE.html">APIs for PRUICSS</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga96adaeaa6576f836f15f28052c5d4c3a"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga96adaeaa6576f836f15f28052c5d4c3a">PRUICSS_resetCore</a></div><div class="ttdeci">int32_t PRUICSS_resetCore(PRUICSS_Handle handle, uint8_t pruNum)</div><div class="ttdoc">This function resets the PRU.</div></div>
<div class="ttc" id="apruicss_8h_html"><div class="ttname"><a href="pruicss_8h.html">pruicss.h</a></div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga38b0b2f969a1f8f6fa7e7d911f07dc71"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga38b0b2f969a1f8f6fa7e7d911f07dc71">PRUICSS_enableCore</a></div><div class="ttdeci">int32_t PRUICSS_enableCore(PRUICSS_Handle handle, uint8_t pruNum)</div><div class="ttdoc">This function enables the PRU.</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga1a7f96fd81bc1502778e59372a5ec740"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga1a7f96fd81bc1502778e59372a5ec740">PRUICSS_IRAM_PRU</a></div><div class="ttdeci">#define PRUICSS_IRAM_PRU(n)</div><div class="ttdoc">IRAM for PRU0/PRU1. n = 0 for PRU0,n = 1 for PRU1.</div><div class="ttdef"><b>Definition:</b> pruicss/m_v0/pruicss.h:97</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga37cdf26e6f52377b9bc2806417c1d201"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga37cdf26e6f52377b9bc2806417c1d201">PRUICSS_disableCore</a></div><div class="ttdeci">int32_t PRUICSS_disableCore(PRUICSS_Handle handle, uint8_t pruNum)</div><div class="ttdoc">This function disables the PRU.</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga6779b9e50b38ea5061d7fe0803956024"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga6779b9e50b38ea5061d7fe0803956024">PRUICSS_open</a></div><div class="ttdeci">PRUICSS_Handle PRUICSS_open(uint32_t instance)</div><div class="ttdoc">This function creates the handle for a PRUICSS instance.</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_ga552e9055ca7eab5fe6c224c6cd5a9d4c"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a></div><div class="ttdeci">#define DebugP_assert(expression)</div><div class="ttdoc">Function to call for assert check.</div><div class="ttdef"><b>Definition:</b> DebugP.h:177</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_gacb9fcd2e989376394c0c628ea9ddc39f"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#gacb9fcd2e989376394c0c628ea9ddc39f">PRUICSS_intcInit</a></div><div class="ttdeci">int32_t PRUICSS_intcInit(PRUICSS_Handle handle, const PRUICSS_IntcInitData *intcInitData)</div><div class="ttdoc">This function does Interrupt-Channel-host mapping.</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga57ddb3591be2f0adf90894e715e52836"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga57ddb3591be2f0adf90894e715e52836">PRUICSS_writeMemory</a></div><div class="ttdeci">uint32_t PRUICSS_writeMemory(PRUICSS_Handle handle, uint32_t pruicssMem, uint32_t wordoffset, const uint32_t *source_mem, uint32_t bytelength)</div><div class="ttdoc">This function writes the given data to PRU memory.</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga5d7a6d9f38b8cc1f8b15b9324c868fd8"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga5d7a6d9f38b8cc1f8b15b9324c868fd8">PRUICSS_PRU0</a></div><div class="ttdeci">#define PRUICSS_PRU0</div><div class="ttdef"><b>Definition:</b> pruicss/m_v0/pruicss.h:74</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga33ff83157feb722e1b6c00885f09abe5"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga33ff83157feb722e1b6c00885f09abe5">PRUICSS_registerIrqHandler</a></div><div class="ttdeci">int32_t PRUICSS_registerIrqHandler(PRUICSS_Handle handle, uint32_t pruEvtoutNum, int32_t intrNum, int32_t eventNum, uint8_t waitEnable, PRUICSS_IrqHandler irqHandler)</div><div class="ttdoc">This function registers an Interrupt Handler for an event.</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
