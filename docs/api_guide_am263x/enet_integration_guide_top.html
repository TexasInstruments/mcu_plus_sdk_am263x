<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Enet Integration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('enet_integration_guide_top.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Enet Integration Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cpsw_integration_guide_intro">Introduction</a></li>
<li class="level1"><a href="#GettingFamiliarWithAPIs">Getting Familiar with Enet LLD APIs</a><ul><li class="level2"><a href="#IOCTL_description">IOCTL Interface</a></li>
</ul>
</li>
<li class="level1"><a href="#enet_integration_in_app">Integrating Enet LLD into User&#39;s Application</a><ul><li class="level2"><a href="#enet_init_sequence">Init Sequence</a></li>
<li class="level2"><a href="#enet_open_sequence">Peripheral Open Sequence</a></li>
<li class="level2"><a href="#enet_openport_sequence">Port Open Sequence</a><ul><li class="level3"><a href="#autotoc_md1402">MAC-PHY link</a></li>
<li class="level3"><a href="#autotoc_md1403">MAC-to-MAC link</a></li>
</ul>
</li>
<li class="level2"><a href="#enet_pktrxtx_sequence">Packet Send/Receive Sequence</a></li>
<li class="level2"><a href="#enet_ioctl_sequence">IOCTL Sequence</a></li>
<li class="level2"><a href="#enet_closeport_sequence">Port Close Sequence</a></li>
<li class="level2"><a href="#enet_close_sequence">Peripheral Close Sequence</a></li>
<li class="level2"><a href="#enet_deinit_sequence">Deinit Sequence</a></li>
<li class="level2"><a href="#enetper_specific_handling">Peripheral-specific</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_networking_enet_lld_enet_integration"></a></p>
<h1><a class="anchor" id="cpsw_integration_guide_intro"></a>
Introduction</h1>
<hr  />
<p>Enet LLD is an unified Ethernet driver that support Ethernet peripherals found in TI SoCs, such as CPSW and ICSSG. Please refer to the SDK release notes to find out what peripherals are currently supported.</p>
<p>The diagram below shows the overall software architecture of the Enet low-level driver. A top-level driver layer provides the interface that the applications can use to configure the switch and to send/receive Ethernet frames.</p>
<p>For instance, the CPSW support in the Enet driver consists of several software submodules that mirror those of the CPSW hardware, like DMA, ALE, MAC port, host port, MDIO, etc. Additionally, the Enet driver also includes PHY driver support as well as a resource manager to administrate the CPSW resources.</p>
<p>Enet LLD relies on drivers like CPDMA for data transfer to/from the Ethernet peripheral's host port to the other processing cores inside the TI SoC devices. For the lower level access to the hardware registers, Enet LLD relies on the Chip Support Library (CSL).</p>
<p><img src="EnetLLD_Diagram.png" alt="" class="inline" title="Enet LLD Software Architecture Block Diagram"/>   </p>
<p><a class="el" href="enet_integration_guide_top.html">Back To Top</a></p>
<h1><a class="anchor" id="GettingFamiliarWithAPIs"></a>
Getting Familiar with Enet LLD APIs</h1>
<hr  />
<p>The Enet LLD APIs can be broadly divided into two categories: control and data path. The control APIs can be used to configure all Ethernet hardware submodules like FDB, MAC port, host port, MDIO, statistics, as well as PHY drivers and resource management. The data path APIs are exclusive for the DMA-based data transfers between the TI SoC processing cores and the Ethernet peripheral.</p>
<p>The main APIs of the Enet LLD are the following:</p>
<ul>
<li><a class="el" href="group__ENET__MAIN__API.html#ga40325ec5d06d5d7788ec71609edd7ac0" title="Open and initializes the Enet driver for a peripheral.">Enet_open()</a></li>
<li><a class="el" href="group__ENET__MAIN__API.html#ga4710f1318cbf2089a92a50609a403c39" title="Close the Enet peripheral.">Enet_close()</a></li>
<li>Enet_ioctl()</li>
<li><a class="el" href="group__ENET__MAIN__API.html#ga6394f7b1160a819195c02c646952b10e" title="Poll for Ethernet events.">Enet_poll()</a></li>
<li><a class="el" href="group__ENET__MAIN__API.html#gae58c8009140824a5172ded24074de1b3" title="Run periodic tick on the Ethernet peripheral.">Enet_periodicTick()</a></li>
<li>EnetDma_openRxCh()</li>
<li>EnetDma_closeRxCh()</li>
<li>EnetDma_openTxCh()</li>
<li>EnetDma_closeTxCh()</li>
<li><a class="el" href="group__ENET__DMA__API.html#ga818e945ac6f5d62b01186c9089673292" title="Retrieve queue of RX ready (full) packets from RX channel.">EnetDma_retrieveRxPktQ()</a></li>
<li><a class="el" href="group__ENET__DMA__API.html#ga6a80baccc431ce40d5d97a1f0d930252" title="Submit queue of RX free (empty) packets for reception to RX channel.">EnetDma_submitRxPktQ()</a></li>
<li><a class="el" href="group__ENET__DMA__API.html#ga0825a26fc168e6a68fa9948ac37125cc" title="Retrieve queue of TX free (empty) packets from TX channel.">EnetDma_retrieveTxPktQ()</a></li>
<li><a class="el" href="group__ENET__DMA__API.html#gac80790c3fbf88c40ce547c41c6164ae6" title="Submit a queue of ready (full) packets to TX channel.">EnetDma_submitTxPktQ()</a></li>
</ul>
<p>It's worth noting that the control path APIs are mainly IOCTL-based, and the data path APIs are direct functions in order to avoid any additional overhead associated with IOCTL calls as DMA data operations occur highly frequently.</p>
<h2><a class="anchor" id="IOCTL_description"></a>
IOCTL Interface</h2>
<hr  />
<p>IOCTLs are system calls that take an argument specifying the command code and can take none or additional parameters via <a class="el" href="structEnet__IoctlPrms.html">Enet_IoctlPrms</a> argument. IOCTL are used by all Enet submodules except for DMA.</p>
<p>The <a class="el" href="structEnet__IoctlPrms.html">Enet_IoctlPrms</a> parameter structure consists of input and output argument pointers and their corresponding size. The following helper macros are provided to help construct the IOCTL params:</p>
<ul>
<li><a class="el" href="group__ENET__MAIN__API.html#gaaad4b5efb9f5ea339451948acbb8b0cc" title="Set null args for an IOCTL command that takes no arguments.">ENET_IOCTL_SET_NO_ARGS(prms)</a>. Used for IOCTL commands that take no parameters.</li>
<li><a class="el" href="group__ENET__MAIN__API.html#ga4244317c67802020a93c2ed38c9dd797" title="Set the input args for an IOCTL command.">ENET_IOCTL_SET_IN_ARGS(prms, in)</a>. Used for IOCTL commands that take input parameters but don't output any parameter.</li>
<li><a class="el" href="group__ENET__MAIN__API.html#gab818bd5097baff64160ad178c39c076d" title="Set the output args for an IOCTL command.">ENET_IOCTL_SET_OUT_ARGS(prms, out)</a>. Used for IOCTL commands that don't take input parameters but return output parameters.</li>
<li><a class="el" href="group__ENET__MAIN__API.html#ga89441673a211ade1b8232ff9417ec09e" title="Set the input and output args for an IOCTL command.">ENET_IOCTL_SET_INOUT_ARGS(prms, in, out)</a>. Used for IOCTL commands that take input parameters and also return output parameters.</li>
</ul>
<p>where <code>prms</code> in a pointer to <a class="el" href="structEnet__IoctlPrms.html">Enet_IoctlPrms</a> variable, <code>in</code> is the pointer to IOCTL input argument and <code>out</code> is the pointer to IOCTL output argument.</p>
<p>It's recommended that the application doesn't set the <a class="el" href="structEnet__IoctlPrms.html">Enet_IoctlPrms</a> members individually, but only through the helper macros listed above.</p>
<p>Please refer to the individual IOCTL command to find out if it requires input and/or output parameters.</p>
<p><a class="el" href="enet_integration_guide_top.html">Back To Top</a></p>
<h1><a class="anchor" id="enet_integration_in_app"></a>
Integrating Enet LLD into User's Application</h1>
<hr  />
<p>Developers who wish to add network connectivity to the applications running on TI SoCs, will have to integrate Enet LLD by following the below sequence:</p>
<ol type="1">
<li><a class="el" href="enet_integration_guide_top.html#enet_init_sequence">Init Sequence</a>. One-time initialization before using any Enet LLD APIs.</li>
<li><a class="el" href="enet_integration_guide_top.html#enet_open_sequence">Peripheral Open Sequence</a>. Opens an Ethernet peripheral, it's called for each peripheral that the application intends to use, i.e. ICSSG0 and CPSW.</li>
<li><a class="el" href="enet_integration_guide_top.html#enet_openport_sequence">Port Open Sequence</a>. Opens a MAC port. For peripherals that provide multiple MAC port (i.e. CPSW9G that has 8 MAC ports), this sequence must be followed for each MAC port. This section also covers MAC-PHY and MAC-MAC links.</li>
<li><a class="el" href="enet_integration_guide_top.html#enet_pktrxtx_sequence">Packet Send/Receive Sequence</a>. DMA TX and RX channel open sequences as well as functions to use to submit and retrieve queue of packets to/from the driver.</li>
<li><a class="el" href="enet_integration_guide_top.html#enet_closeport_sequence">Port Close Sequence</a>. Closes a MAC port. Application has to close all MAC ports which were opened in step 3 when no longer needs those ports.</li>
<li><a class="el" href="enet_integration_guide_top.html#enet_close_sequence">Peripheral Close Sequence</a>. Closes an Ethernet peripheral when the application no longer needs it. This sequence must be followed for each peripheral that was opened in step 2.</li>
<li><a class="el" href="enet_integration_guide_top.html#enet_deinit_sequence">Deinit Sequence</a>. One-time deinitialization once application is done using Enet LLD.</li>
</ol>
<p>Each of these sequences will be covered in detail in the following sections.</p>
<h2><a class="anchor" id="enet_init_sequence"></a>
Init Sequence</h2>
<p>This is a one-time initialization where the application sets the utils function that Enet LLD will use throughout its lifecycle.</p>
<p>At this stage Enet LLD also initializes its SoC layer which contains data about the Ethernet hardware available in the TI device.</p>
<p>The application should follow the next steps:</p>
<ol type="1">
<li>(Optional) <a class="el" href="group__ENET__MAIN__API.html#ga6370b438a831f249741d3fbd350b8463">Enet_initUtilsCfg()</a> to initialize utils configuration (see <a class="el" href="structEnetUtils__Cfg.html">EnetUtils_Cfg</a>) with a default implementation. The default implementation of Enet Utils interface is UART-based logging and one-to-one address translations (physical-to-virtual and virtual-to-physical). Applications may want to pass their own utils' print function if UART is not available. Similarly, if a MMU is present and used, applications may need to pass their own address translation functions corresponding to the MMU configuration. <pre class="fragment"> utilsCfg.print = UART_printf;
 utilsCfg.physToVirt = &amp;myPhysToVirtFxn;
 utilsCfg.virtToPhys = &amp;myVirtToPhysFxn;
</pre></li>
<li><a class="el" href="group__ENET__MAIN__API.html#gab9513bb4a3cc9b6d022122ea21f2ae43">Enet_init()</a> to pass the utils configurations setup in the previous two steps. The application can pass NULL to either the utils config if it intends to use the driver's default implementation.</li>
</ol>
<h2><a class="anchor" id="enet_open_sequence"></a>
Peripheral Open Sequence</h2>
<p>This is an initialization that needs to be done for each peripheral in the system. The configuration parameters described in this section are peripheral specific.</p>
<p>Application should follow the next steps:</p>
<ol type="1">
<li>Initialize the peripheral configuration parameters with default values using <a class="el" href="group__ENET__MAIN__API.html#ga9fa168341383aac623bc20867e79d6b1">Enet_initCfg()</a>. Although the application can fill all parameters manually, it's recommended tofirst get the driver's default values for all parameters and only overwrite the parameters of interest.<ul>
<li>CPSW peripheral configuration - <a class="el" href="structCpsw__Cfg.html">Cpsw_Cfg</a> structure has the configuration parameters for CPSW Enet Peripheral, such as:<ul>
<li>Configuration of DMA: <a class="el" href="structEnetDma__Cfg.html">EnetDma_Cfg</a>.</li>
<li>VLAN configuration (inner/outer VLAN, customer/service switch): <a class="el" href="structCpsw__VlanCfg.html">Cpsw_VlanCfg</a>.</li>
<li>Max packet length transmitted on egress: <a class="el" href="structCpsw__Cfg.html#ad62b7b5c4f099289bc5b0655506ef117">Cpsw_Cfg::txMtu</a>.</li>
<li>Configuration of the host (CPPI) port: <a class="el" href="structCpswHostPort__Cfg.html">CpswHostPort_Cfg</a>.</li>
<li>Configure of the ALE submodule: <a class="el" href="structCpswAle__Cfg.html">CpswAle_Cfg</a>.</li>
<li>Configure of the CPTS submodule: <a class="el" href="structCpswCpts__Cfg.html">CpswCpts_Cfg</a>.</li>
<li>Configuration of the MDIO submodule: <a class="el" href="structMdio__Cfg.html">Mdio_Cfg</a>.</li>
<li>Configuration of CPSW Resource Partition: <a class="el" href="structEnetRm__ResCfg.html">EnetRm_ResCfg</a>.</li>
</ul>
</li>
</ul>
</li>
<li>Once done with the configuration of the CPDMA parameters <a class="el" href="structCpsw__Cfg.html#af31aecf86f4f094f7c96bf7bf7018567">Cpsw_Cfg::dmaCfg</a>., CPDMA driver open will be done by Cpsw_open(). CPDMA Tx and Rx channels should be opened using <a class="el" href="group__ENET__CPDMA__API.html#ga5618735c90f1fecca767e84be9fcd376" title="Enet DMA open TX channel.">EnetCpdma_openTxCh()</a> and <a class="el" href="group__ENET__CPDMA__API.html#ga0896d7a8995f21b2879c53293b244617" title="Enet DMA open RX channel.">EnetCpdma_openRxCh()</a> based on Syscfg DMA configuration.</li>
<li><a class="el" href="group__ENET__MAIN__API.html#ga40325ec5d06d5d7788ec71609edd7ac0">Enet_open()</a> to open a peripheral, passing the configuration parameters previously initialized. <a class="el" href="group__ENET__MAIN__API.html#ga40325ec5d06d5d7788ec71609edd7ac0">Enet_open()</a> function takes the following arguments:<ul>
<li>Peripheral type - This specifies the type or class of the peripheral, i.e. CPSW, ICSSG or other.</li>
<li>Instance number - This argument specifies the instance number of the peripheral. Refer to <a class="el" href="enetlld_top.html#enetlld_enetpers">Enet Peripherals</a> section for further information about specific peripheral types and instance numbers.</li>
<li>Configuration structure - A pointer to the peripheral-specific configuration structure, i.e. <a class="el" href="structCpsw__Cfg.html">Cpsw_Cfg</a> or <a class="el" href="structIcssg__Cfg.html">Icssg_Cfg</a>.</li>
<li>Size of the configuration structure.</li>
</ul>
</li>
<li>If the module is opened successfully, the API will return a valid handle pointer to the Enet driver. It's worth noting that there will be a unique Enet handle (<a class="el" href="enet__base_8h.html#aaf6a26638306b81ac1148da6da42f513">Enet_Handle</a>) for each peripheral opened.</li>
<li>Configure the DSCP to priority mapping for all the mac ports and host port using <a class="el" href="group__ENET__MOD__MACPORT.html#ggaae019ccdc5a774caa8ffdb35123ca59da36ecef77274c3c4251e314c022e26714">ENET_MACPORT_IOCTL_SET_INGRESS_DSCP_PRI_MAP</a> and <a class="el" href="group__ENET__MOD__HOSTPORT.html#gga65ee5012f8178049e634eb8b7e42959ca82c66c1d6ed08210417b581898e2b7de">ENET_HOSTPORT_IOCTL_SET_INGRESS_DSCP_PRI_MAP</a> commands. CPSW supports IPV4 and IPV6 DSCP priority mapping. By default, out-of-box examples maps DSCP values 0-7 to priority 0, 8-15 to priority 1, and so on for both host and mac ports.</li>
<li>Configure default thread ID for host interface using <a class="el" href="group__CPSW__ALE__MOD.html#ggabed7e8ccaf9e220220ce26e85697cb98a6cdd65f40b8b9a361726beb55cee37f3">CPSW_ALE_IOCTL_SET_DEFAULT_THREADCFG</a> when no classifer is matched.</li>
<li>Attach the core with the Resource Manager (RM) using <a class="el" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0a35881d860c7370884c040a0a6d0c7ffd">ENET_PER_IOCTL_ATTACH_CORE</a>. IOCTL. To use IOCTLs, the application must have the following:<ul>
<li>Valid handle to the driver.</li>
<li>Core ID, which can be obtained using <a class="el" href="enet__soc_8h.html#ac34f14a8269455a613229af83d02ef4d">EnetSoc_getCoreId()</a>.</li>
<li>Valid IOCTL command.</li>
<li>Valid pointer to the IOCTL parameters.</li>
</ul>
</li>
<li>Once the application attaches the core with Resource Manager (RM), the IOCTL call will return core key which has to be used in all further RM-related calls.</li>
<li>A MAC address for the host port is to be obtained using Enet utils helper function EnetAppUtils_allocMac() and the corresponding entry in the ALE table can be added using EnetAppUtils_addHostPortEntry().</li>
<li>Allocate memory for Ring Accelerators, Ethernet packets, etc. Enet LLD examples use <code>EnetAppMemUtils</code> to take care of all memory allocation and freeing operations. The developer can take this as reference or can implement their own memory allocation functions.</li>
</ol>
<h2><a class="anchor" id="enet_openport_sequence"></a>
Port Open Sequence</h2>
<p>The MAC ports can be opened in MAC-to-PHY or MAC-to-MAC mode. In MAC-to-PHY mode, Enet LLD's PHY driver state machine will be used to configure the Ethernet PHY. In MAC-to-MAC mode, the PHY driver will be bypassed entirely.</p>
<p>The link speed and duplexity in MAC-to-PHY can be fixed or auto-negotiated, while in MAC-to-MAC, both link speed and duplexity can be fixed only and must be provided by application.</p>
<p>The steps to open and configure ports in either MAC-to-PHY or MAC-to-MAC modes are shown below.</p>
<h3><a class="anchor" id="autotoc_md1402"></a>
MAC-PHY link</h3>
<ol type="1">
<li>Set the port number in <a class="el" href="structEnetPer__PortLinkCfg.html">EnetPer_PortLinkCfg</a> structure.</li>
<li>Set the MAC port interface (RMII, RGMII, SGMII, etc) through the layer, sublayer and variant fields of <a class="el" href="structEnetPer__PortLinkCfg.html#a5b44defddd2475eb49d91b63693c86f9">EnetPer_PortLinkCfg::mii</a>.</li>
<li>The MAC port configuration parameters is peripheral dependent.<ul>
<li>CPSW MAC Port configuration:<ul>
<li>Use <a class="el" href="group__CPSW__MACPORT__MOD.html#ga0840800cbfc598300796592a959e0577">CpswMacPort_initCfg()</a> to initialize the CPSW MAC port configuration parameters to their default values. Overwrite any parameters as needed.</li>
<li>If loopback is to be enabled, set enableLoopback flag in MAC configuration to true. For loopback to be functional the secure flag in host port ALE entry must be set to false. The host port entry update can be done using the <a class="el" href="group__CPSW__ALE__MOD.html#ggabed7e8ccaf9e220220ce26e85697cb98a7bcf6d287ab7f189bafe5df389332263">CPSW_ALE_IOCTL_ADD_UCAST</a> command.</li>
</ul>
</li>
</ul>
</li>
<li>Set PHY configuration parameters: generic and model specific.<ol type="a">
<li>Use <a class="el" href="group__DRV__ENETPHY.html#gaff5006a4c712434d31f67b3d5d4b3bf9">EnetPhy_initCfg()</a> to initialize the PHY generic parameters to their default values, such as auto-negotiation capabilities, strap enable/disable, loopback, etc.</li>
<li>Use PHY specific init config functions to initialize model specific parameters. This init config function is provided by the Ethernet PHYs supported in Enet LLD. For example, <a class="el" href="group__ENETPHY__DP83867.html#ga304aac6fd8cf554d7c01fd8e8a659e66" title="Initialize DP83867 PHY specific config params.">Dp83867_initCfg()</a> is used to initialize config params for DP83867 PHYs.</li>
<li>Application can also use the Enet helper function EnetBoard_getPhyCfg() to get PHY configuration information for PHYs in TI EVMs.</li>
</ol>
</li>
<li>Set the link speed and duplexity configuration in <a class="el" href="structEnetPer__PortLinkCfg.html#acb11a2278c001e8f5297f35fba6ea8dc">EnetPer_PortLinkCfg::linkCfg</a>.<ul>
<li>For auto-negotiation, use <a class="el" href="group__ENET__MAIN__API.html#gga0bef5cbad0a87693c51f5b607be13feba2fc673ea1a9100a3396e83e393ae6fae">ENET_SPEED_AUTO</a> or <a class="el" href="group__ENET__MAIN__API.html#gga3431e11a2089b5fd51a2059c8e80dc67a4b78a0c8fcc61de7734a2a2b8ff99671">ENET_DUPLEX_AUTO</a>.</li>
<li>For fixed (manual) configuration, use the fixed speeds and duplexity values in defined in <a class="el" href="group__ENET__MAIN__API.html#ga0bef5cbad0a87693c51f5b607be13feb">Enet_Speed</a> and <a class="el" href="group__ENET__MAIN__API.html#ga3431e11a2089b5fd51a2059c8e80dc67">Enet_Duplexity</a> enumerations.</li>
</ul>
</li>
<li>Once all the MAC and PHY configurations are done, the ports can be opened by calling the <a class="el" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0ad5684ee47181741d4c11d9de6bd5fbe1">ENET_PER_IOCTL_OPEN_PORT_LINK</a> command.</li>
<li><em>CPSW Note</em>: To enable RMII on CPSW9G, external 50 MHz RMII clock from PHY is used on SOC RMII_REF_CLOCK pin. On GESI board, this clock is connected as resistor R225 is not populated. To get RMII_50MHZ_CLK, resistor R225 needs to be populated. We need to move R226 to R225 on GESI board to get this clock.</li>
<li>If all the above steps succeeded without any errors, then the Enet driver, the Ethernet peripheral and a MAC port have been opened successfully.</li>
<li>After opening the port, the driver will run its PHY state machine to configure the PHY and eventually get <em>link up</em> status. Application can query the port link using <a class="el" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0a5d823381e45afc7c88a81552bae578fd">ENET_PER_IOCTL_IS_PORT_LINK_UP</a>.<ul>
<li>Application can check the PHY alive status (i.e. whether PHY is present on the MDIO bus) using the <a class="el" href="group__ENET__MOD__MDIO.html#gga3d1296252044e355873ecdb16dd19baba9281fd98f13f05a63e857ae6a8c0c3f7">ENET_MDIO_IOCTL_IS_ALIVE</a> command.</li>
</ul>
</li>
<li>Once link up is detected, application should do the following steps:<ul>
<li>CPSW:<ul>
<li>Set the ALE port state to <code>Forward</code> state using <a class="el" href="group__CPSW__ALE__MOD.html#ggabed7e8ccaf9e220220ce26e85697cb98a9e89ff165647c66926bf7685d3d84f08">CPSW_ALE_IOCTL_SET_PORT_STATE</a> IOCTL command.</li>
<li>Enable the host port of CPSW by calling the <a class="el" href="group__ENET__MOD__HOSTPORT.html#gga65ee5012f8178049e634eb8b7e42959ca64be6840551cb1b537bc6cfb8a0fba4e">ENET_HOSTPORT_IOCTL_ENABLE</a> command.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>The following code snippet shows how a MAC-PHY link is opened (step 1-6 above). CPSW MAC port 1 connected to a DP83867 RGMII PHY has been chosen for this example.</p>
<div class="fragment"><div class="line"><a class="code" href="structEnet__IoctlPrms.html">Enet_IoctlPrms</a> prms;</div>
<div class="line"><a class="code" href="structEnetPer__PortLinkCfg.html">EnetPer_PortLinkCfg</a> portLinkCfg;</div>
<div class="line"><a class="code" href="structEnetMacPort__LinkCfg.html">EnetMacPort_LinkCfg</a> *linkCfg = &amp;portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#acb11a2278c001e8f5297f35fba6ea8dc">linkCfg</a>;</div>
<div class="line"><a class="code" href="structEnetMacPort__Interface.html">EnetMacPort_Interface</a> *mii = &amp;portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#a5b44defddd2475eb49d91b63693c86f9">mii</a>;</div>
<div class="line"><a class="code" href="structCpswMacPort__Cfg.html">CpswMacPort_Cfg</a> cpswMacCfg;</div>
<div class="line"><a class="code" href="structEnetPhy__Cfg.html">EnetPhy_Cfg</a> *phyCfg = &amp;portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#ac49dc7eafa9eb2498599e6dc74759f36">phyCfg</a>;</div>
<div class="line"><a class="code" href="structDp83867__Cfg.html">Dp83867_Cfg</a> dp83867Cfg;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 1 - MAC port 1 */</span></div>
<div class="line">portLinkCfg-&gt;<a class="code" href="structEnetPer__PortLinkCfg.html#a2c02466c17327b6963355acdeb3722a0">macPort</a> = <a class="code" href="group__ENET__MAIN__API.html#gga263f2a3003e793a56d3def727e2b6a4fa374942dc0d9af695a2844d886c069ff6">ENET_MAC_PORT_1</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 2 - Set port type to RGMII */</span></div>
<div class="line">mii-&gt;<a class="code" href="structEnetMacPort__Interface.html#a506724797a467a263c1a1bddcaabf837">layerType</a>    = <a class="code" href="group__ENET__MOD__MACPORT.html#gga046d087375dda93eb619534f98d934d1a80614a8acf9d3f222c1c77813e93cc97">ENET_MAC_LAYER_GMII</a>;</div>
<div class="line">mii-&gt;<a class="code" href="structEnetMacPort__Interface.html#a3db3e6be82433d2f5d6c86d8abd3e93e">sublayerType</a> = <a class="code" href="group__ENET__MOD__MACPORT.html#ggab152ef6c56c6e2ae46bff9a98b370d12a76327445685a653eb966a703cee8b3e9">ENET_MAC_SUBLAYER_REDUCED</a>;</div>
<div class="line">mii-&gt;<a class="code" href="structEnetMacPort__Interface.html#a04a2368a6f261fedc2895faa27568e47">variantType</a>  = <a class="code" href="group__ENET__MOD__MACPORT.html#ggae9fcecf4a51faf27590a0576d7ae803fa3d8b72717e469c33a80bda14d5a81921">ENET_MAC_VARIANT_FORCED</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 3 - Initialize MAC port configuration parameters */</span></div>
<div class="line"><a class="code" href="group__CPSW__MACPORT__MOD.html#ga0840800cbfc598300796592a959e0577">CpswMacPort_initCfg</a>(&amp;cpswMacCfg);</div>
<div class="line">portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#ad70805ae17f447479f5bc53a850a4402">macCfg</a> = &amp;cpswMacCfg;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 4a - Set PHY generic configuration parameters */</span></div>
<div class="line"><a class="code" href="group__DRV__ENETPHY.html#gaff5006a4c712434d31f67b3d5d4b3bf9">EnetPhy_initCfg</a>(phyCfg);</div>
<div class="line">phyCfg-&gt;<a class="code" href="structEnetPhy__Cfg.html#a8ddec0dca674469bd9ff7c9d4aeb6aba">phyAddr</a> = 0U;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 4b - DP83867 PHY specific configuration */</span></div>
<div class="line"><a class="code" href="group__ENETPHY__DP83867.html#ga304aac6fd8cf554d7c01fd8e8a659e66">Dp83867_initCfg</a>(&amp;dp83867Cfg);</div>
<div class="line">dp83867Cfg.<a class="code" href="structDp83867__Cfg.html#a798d555a1a75422e9b6b18b82bcc9384">ledMode</a>[1] = <a class="code" href="group__ENETPHY__DP83867.html#ggabf70c55354619c5ad2cd74abe0751e0ea5623fa04afc316997d642a0c5dffaae5">DP83867_LED_LINKED_100BTX</a>;</div>
<div class="line">dp83867Cfg.<a class="code" href="structDp83867__Cfg.html#a798d555a1a75422e9b6b18b82bcc9384">ledMode</a>[2] = <a class="code" href="group__ENETPHY__DP83867.html#ggabf70c55354619c5ad2cd74abe0751e0ea716a6ba3faa945ac277346599c32c545">DP83867_LED_RXTXACT</a>;</div>
<div class="line">dp83867Cfg.<a class="code" href="structDp83867__Cfg.html#a798d555a1a75422e9b6b18b82bcc9384">ledMode</a>[3] = <a class="code" href="group__ENETPHY__DP83867.html#ggabf70c55354619c5ad2cd74abe0751e0ea11ffa2c16a786f82acb4ae8b49c14c00">DP83867_LED_LINKED_1000BT</a>;</div>
<div class="line"><a class="code" href="group__DRV__ENETPHY.html#ga5f7008641bf565765c557f55756937a4">EnetPhy_setExtendedCfg</a>(phyCfg, &amp;dp83867Cfg, <span class="keyword">sizeof</span>(dp83867Cfg));</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 5 - Set link speed/duplexity to auto-negotiation */</span></div>
<div class="line">linkCfg-&gt;<a class="code" href="structEnetMacPort__LinkCfg.html#a8839c991fe644d6f50f46c6ab23aa684">speed</a>     = <a class="code" href="group__ENET__MAIN__API.html#gga0bef5cbad0a87693c51f5b607be13feba2fc673ea1a9100a3396e83e393ae6fae">ENET_SPEED_AUTO</a>;</div>
<div class="line">linkCfg-&gt;<a class="code" href="structEnetMacPort__LinkCfg.html#a1de48922a0688d1594234c63bfd9baf1">duplexity</a> = <a class="code" href="group__ENET__MAIN__API.html#gga3431e11a2089b5fd51a2059c8e80dc67a4b78a0c8fcc61de7734a2a2b8ff99671">ENET_DUPLEX_AUTO</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 6 - Open port link */</span></div>
<div class="line"><a class="code" href="group__ENET__MAIN__API.html#ga4244317c67802020a93c2ed38c9dd797">ENET_IOCTL_SET_IN_ARGS</a>(&amp;prms, &amp;portLinkCfg);</div>
<div class="line">status = Enet_ioctl(hEnet, coreId, <a class="code" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0ad5684ee47181741d4c11d9de6bd5fbe1">ENET_PER_IOCTL_OPEN_PORT_LINK</a>, &amp;prms);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1403"></a>
MAC-to-MAC link</h3>
<ol type="1">
<li>Set the port number in <a class="el" href="structEnetPer__PortLinkCfg.html#a2c02466c17327b6963355acdeb3722a0">EnetPer_PortLinkCfg::macPort</a>.</li>
<li>Set the MAC port interface (RMII, RGMII, SGMII, etc) through the layer, sublayer and variant fields of <a class="el" href="structEnetPer__PortLinkCfg.html#a5b44defddd2475eb49d91b63693c86f9">EnetPer_PortLinkCfg::mii</a>.</li>
<li>Initialize the MAC configuration parameters using <a class="el" href="group__CPSW__MACPORT__MOD.html#ga0840800cbfc598300796592a959e0577">CpswMacPort_initCfg()</a> and manually overwrite any parameters that differ from defaults.</li>
<li>Set PHY address to <a class="el" href="group__DRV__ENETPHY.html#gaac99db2dbc6b1607f75384f3aa15fdba" title="Invalid PHY address indicator.">ENETPHY_INVALID_PHYADDR</a> to indicate that this is a PHY-less connection.</li>
<li>Set the link speed and duplexity configuration in <a class="el" href="structEnetPer__PortLinkCfg.html#acb11a2278c001e8f5297f35fba6ea8dc">EnetPer_PortLinkCfg::linkCfg</a> to match those of the partner MAC port. The speed and duplexity must be fixed values, they can't be <a class="el" href="group__ENET__MAIN__API.html#gga0bef5cbad0a87693c51f5b607be13feba2fc673ea1a9100a3396e83e393ae6fae">ENET_SPEED_AUTO</a> or <a class="el" href="group__ENET__MAIN__API.html#gga3431e11a2089b5fd51a2059c8e80dc67a4b78a0c8fcc61de7734a2a2b8ff99671">ENET_DUPLEX_AUTO</a> as they are used for auto-negotiation which is not relevant in MAC-to-MAC mode.</li>
<li>Once all the MAC and PHY configurations are done, the ports can be opened by calling the <a class="el" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0ad5684ee47181741d4c11d9de6bd5fbe1">ENET_PER_IOCTL_OPEN_PORT_LINK</a> command.</li>
<li>If all the above steps succeeded without any errors, then the Enet driver, the Ethernet peripheral and a MAC port have been opened successfully.</li>
<li>Once link up is detected, application should do the following steps:<ul>
<li>CPSW:<ul>
<li>Set the ALE port state to <code>Forward</code> state using <a class="el" href="group__CPSW__ALE__MOD.html#ggabed7e8ccaf9e220220ce26e85697cb98a9e89ff165647c66926bf7685d3d84f08">CPSW_ALE_IOCTL_SET_PORT_STATE</a> IOCTL command.</li>
<li>Enable the host port of CPSW by calling the <a class="el" href="group__ENET__MOD__HOSTPORT.html#gga65ee5012f8178049e634eb8b7e42959ca64be6840551cb1b537bc6cfb8a0fba4e">ENET_HOSTPORT_IOCTL_ENABLE</a> command.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>The following code snippet shows how a MAC-to-MAC link is opened (steps 1-6 above). CPSW MAC port 1 connected to partner MAC using RGMII interface at 1 Gbps.</p>
<div class="fragment"><div class="line"><a class="code" href="structEnet__IoctlPrms.html">Enet_IoctlPrms</a> prms;</div>
<div class="line"><a class="code" href="structEnetPer__PortLinkCfg.html">EnetPer_PortLinkCfg</a> portLinkCfg;</div>
<div class="line"><a class="code" href="structEnetMacPort__LinkCfg.html">EnetMacPort_LinkCfg</a> *linkCfg = &amp;portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#acb11a2278c001e8f5297f35fba6ea8dc">linkCfg</a>;</div>
<div class="line"><a class="code" href="structEnetMacPort__Interface.html">EnetMacPort_Interface</a> *mii = &amp;portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#a5b44defddd2475eb49d91b63693c86f9">mii</a>;</div>
<div class="line"><a class="code" href="structCpswMacPort__Cfg.html">CpswMacPort_Cfg</a> cpswMacCfg;</div>
<div class="line"><a class="code" href="structEnetPhy__Cfg.html">EnetPhy_Cfg</a> *phyCfg = &amp;portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#ac49dc7eafa9eb2498599e6dc74759f36">phyCfg</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 1 - MAC port 1 */</span></div>
<div class="line">portLinkCfg-&gt;<a class="code" href="structEnetPer__PortLinkCfg.html#a2c02466c17327b6963355acdeb3722a0">macPort</a> = <a class="code" href="group__ENET__MAIN__API.html#gga263f2a3003e793a56d3def727e2b6a4fa374942dc0d9af695a2844d886c069ff6">ENET_MAC_PORT_1</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 2 - Set port type to RGMII */</span></div>
<div class="line">mii-&gt;<a class="code" href="structEnetMacPort__Interface.html#a506724797a467a263c1a1bddcaabf837">layerType</a>    = <a class="code" href="group__ENET__MOD__MACPORT.html#gga046d087375dda93eb619534f98d934d1a80614a8acf9d3f222c1c77813e93cc97">ENET_MAC_LAYER_GMII</a>;</div>
<div class="line">mii-&gt;<a class="code" href="structEnetMacPort__Interface.html#a3db3e6be82433d2f5d6c86d8abd3e93e">sublayerType</a> = <a class="code" href="group__ENET__MOD__MACPORT.html#ggab152ef6c56c6e2ae46bff9a98b370d12a76327445685a653eb966a703cee8b3e9">ENET_MAC_SUBLAYER_REDUCED</a>;</div>
<div class="line">mii-&gt;<a class="code" href="structEnetMacPort__Interface.html#a04a2368a6f261fedc2895faa27568e47">variantType</a>  = <a class="code" href="group__ENET__MOD__MACPORT.html#ggae9fcecf4a51faf27590a0576d7ae803fa3d8b72717e469c33a80bda14d5a81921">ENET_MAC_VARIANT_FORCED</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 3 - Initialize MAC port configuration parameters */</span></div>
<div class="line"><a class="code" href="group__CPSW__MACPORT__MOD.html#ga0840800cbfc598300796592a959e0577">CpswMacPort_initCfg</a>(&amp;cpswMacCfg);</div>
<div class="line">portLinkCfg.<a class="code" href="structEnetPer__PortLinkCfg.html#ad70805ae17f447479f5bc53a850a4402">macCfg</a> = &amp;cpswMacCfg;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 4 - Indicate that this is a PHY-less MAC-to-MAC connection */</span></div>
<div class="line">phyCfg-&gt;<a class="code" href="structEnetPhy__Cfg.html#a8ddec0dca674469bd9ff7c9d4aeb6aba">phyAddr</a> = <a class="code" href="group__DRV__ENETPHY.html#gaac99db2dbc6b1607f75384f3aa15fdba">ENETPHY_INVALID_PHYADDR</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 5 - Link speed/duplexity must be explicit set, cannot be set to auto */</span></div>
<div class="line">linkCfg-&gt;<a class="code" href="structEnetMacPort__LinkCfg.html#a8839c991fe644d6f50f46c6ab23aa684">speed</a>     = <a class="code" href="group__ENET__MAIN__API.html#gga0bef5cbad0a87693c51f5b607be13febaaa37947dda4d02f5194c39aa3a95b7f9">ENET_SPEED_1GBIT</a>;</div>
<div class="line">linkCfg-&gt;<a class="code" href="structEnetMacPort__LinkCfg.html#a1de48922a0688d1594234c63bfd9baf1">duplexity</a> = <a class="code" href="group__ENET__MAIN__API.html#gga3431e11a2089b5fd51a2059c8e80dc67aa177d6f0218e0439e0d15bb4dd98b0e5">ENET_DUPLEX_FULL</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Step 6 - Open port link */</span></div>
<div class="line"><a class="code" href="group__ENET__MAIN__API.html#ga4244317c67802020a93c2ed38c9dd797">ENET_IOCTL_SET_IN_ARGS</a>(&amp;prms, &amp;portLinkCfg);</div>
<div class="line">status = Enet_ioctl(hEnet, coreId, <a class="code" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0ad5684ee47181741d4c11d9de6bd5fbe1">ENET_PER_IOCTL_OPEN_PORT_LINK</a>, &amp;prms);</div>
</div><!-- fragment --><h2><a class="anchor" id="enet_pktrxtx_sequence"></a>
Packet Send/Receive Sequence</h2>
<ol type="1">
<li>The DMA channels to enable data transfer are to be opened. It can be done using the below steps:<ul>
<li>Initialize the Tx Channel and Rx Channel parameters using <a class="el" href="group__ENET__CPDMA__API.html#ga9bc151e9a28f27eee8885a1a5dfe40e3" title="Initialize TX channel open parameters.">EnetCpdma_initTxChParams()</a> and <a class="el" href="group__ENET__CPDMA__API.html#ga0275a08ff8b3a7f0b5980f9faeb12d44" title="Initialize RX channel open parameters.">EnetCpdma_initRxChParams()</a>, respectively.</li>
<li>For Tx Channel set the following parameters:<ul>
<li><a class="el" href="structEnetCpdma__OpenTxChPrms.html#a2eda8a58f7e15c88551ad34de897369f">EnetCpdma_OpenTxChPrms::hEnet</a>: Ethernet handle obtained before.</li>
<li><a class="el" href="structEnetCpdma__OpenTxChPrms.html#a97ef204e1173c3217f2896360b3ca92b">EnetCpdma_OpenTxChPrms::chNum</a>: Tx Channel number.</li>
<li><a class="el" href="structEnetCpdma__OpenTxChPrms.html#a5cc3c83febe76501ec98f49bba886e1a">EnetCpdma_OpenTxChPrms::notifyCb</a>: Enet CPDMA event callback function.</li>
<li><a class="el" href="structEnetCpdma__OpenTxChPrms.html#a157ebeb796b2ff14f6b0b9225b221253">EnetCpdma_OpenTxChPrms::numTxPkts</a>: number of Tx packets used to alloc DMA descriptors</li>
<li><a class="el" href="structEnetCpdma__OpenTxChPrms.html#ae5a6ec768aa63f2b8ff57f935d5c6a49">EnetCpdma_OpenTxChPrms::cbArg</a>: Argument to be used for the callback routines.</li>
</ul>
</li>
<li>For Rx Channel set the following parameters:<ul>
<li><a class="el" href="structEnetCpdma__OpenRxChPrms.html#a22b6580590c5a6c02bd21d1918e749d3">EnetCpdma_OpenRxChPrms::hEnet</a>: Ethernet handle obtained before.</li>
<li><a class="el" href="structEnetCpdma__OpenRxChPrms.html#a54e62c22d0ef0fbd7baa349ccbe45d91">EnetCpdma_OpenRxChPrms::chNum</a>: Tx Channel number.</li>
<li><a class="el" href="structEnetCpdma__OpenRxChPrms.html#adb14aac558d6abeec3f7ef53de3639d7">EnetCpdma_OpenRxChPrms::notifyCb</a>: Enet CPDMA event callback function.</li>
<li>EnetCpdma_OpenRxChPrms::numTxPkts: number of Tx packets used to alloc DMA descriptors</li>
<li><a class="el" href="structEnetCpdma__OpenRxChPrms.html#a0961951aa692a7574b8ccb47a8ccef85">EnetCpdma_OpenRxChPrms::cbArg</a>: Argument to be used for the callback routines.</li>
</ul>
</li>
<li>After setting the parameters, open the channel and flow using Enet utils helper functions EnetAppUtils_openTxCh() and EnetAppUtils_openRxFlow(), respectively.</li>
</ul>
</li>
<li>Now that the Ethernet peripheral (CPSW) and CPDMA are configured, the application can start the data transfer.<ul>
<li>To transmit data from application:<ul>
<li>Call <a class="el" href="group__ENET__DMA__API.html#gac80790c3fbf88c40ce547c41c6164ae6">EnetDma_submitTxPktQ()</a> to submit the packets that are ready to be transmitted to Tx Free Queue.</li>
<li>Call <a class="el" href="group__ENET__DMA__API.html#ga0825a26fc168e6a68fa9948ac37125cc">EnetDma_retrieveTxPktQ()</a> to retrieve back the packets that were successfully transmitted from Tx Completion Queue.</li>
</ul>
</li>
<li>To receive packets that are queued up in the CPSW or ICSSG hardware which are ready to be received by the application:<ul>
<li>Call <a class="el" href="group__ENET__DMA__API.html#ga818e945ac6f5d62b01186c9089673292">EnetDma_retrieveRxPktQ()</a> to retrieve packets from Rx Completion Queue that are sent to the application.</li>
<li>Call <a class="el" href="group__ENET__DMA__API.html#ga6a80baccc431ce40d5d97a1f0d930252">EnetDma_submitRxPktQ()</a> to submit new packets to Rx Free Queue, so that newly received packets can be copied.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="enet_ioctl_sequence"></a>
IOCTL Sequence</h2>
<ol type="1">
<li>Some common IOCTLs have already been mentioned in this document so far. But the application can run any other IOCTL supported by the peripheral. There are two kinds of IOCTLs: synchronous and asynchronous. Asynchronous IOCTLs require an additional completion poll step which is explained in <a class="el" href="enet_ioctl_interface.html#enet_async_ioctl">Synchronous and Asynchronous IOCTLs</a> section of the <a class="el" href="enet_ioctl_interface.html">Enet LLD IOCTL interface</a> document.</li>
</ol>
<h2><a class="anchor" id="enet_closeport_sequence"></a>
Port Close Sequence</h2>
<ol type="1">
<li>MAC ports that were opened earlier can be closed using <a class="el" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0a5623c658415329096180ce45405d6bb7">ENET_PER_IOCTL_CLOSE_PORT_LINK</a> IOCTL command. This will close the PHY state machine associated with this MAC port, if the port was not open in MAC-to-MAC mode. Application can choose to reopen the port at any time in the future by following the steps listed in <a class="el" href="enet_integration_guide_top.html#enet_openport_sequence">Port Open Sequence</a> section.</li>
</ol>
<h2><a class="anchor" id="enet_close_sequence"></a>
Peripheral Close Sequence</h2>
<ol type="1">
<li>Disable the host port using the <a class="el" href="group__ENET__MOD__HOSTPORT.html#gga65ee5012f8178049e634eb8b7e42959ca5486889880b7cc712968b080456dfea8">ENET_HOSTPORT_IOCTL_DISABLE</a> command</li>
<li>Close the opened Tx Channel and Rx flow:<ul>
<li>Close the Rx flow using EnetAppUtils_closeRxFlow().</li>
<li>Close the Tx Channel using EnetAppUtils_closeTxCh().</li>
</ul>
</li>
<li>Detach the core from Resource Manager using the <a class="el" href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0a749823fad2726b94bde3a5adfe3c7e16">ENET_PER_IOCTL_DETACH_CORE</a> command.</li>
<li>Enet driver can now be closed and de-initialized using <a class="el" href="group__ENET__MAIN__API.html#ga4710f1318cbf2089a92a50609a403c39">Enet_close()</a> and <a class="el" href="group__ENET__MAIN__API.html#gac2f30f7b3277c9ffa89018d226fa8985">Enet_deinit()</a>.</li>
</ol>
<h2><a class="anchor" id="enet_deinit_sequence"></a>
Deinit Sequence</h2>
<p>This is one-time deinitialization sequence that must be followed when the application no longer wants to use the Enet LLD.</p>
<ol type="1">
<li><a class="el" href="group__ENET__MAIN__API.html#gac2f30f7b3277c9ffa89018d226fa8985">Enet_deinit()</a> should be called to deinitialize the driver. No further Enet LLD APIs should be called from this point.</li>
<li>Finally, close the tx,rx CPDMA channels and CPDMA driver using <a class="el" href="group__ENET__CPDMA__API.html#ga202a03d0b80679daa1d429ade64f7f57" title="Enet DMA close TX channel.">EnetCpdma_closeTxCh()</a>, <a class="el" href="group__ENET__CPDMA__API.html#ga1cbbdb88c4e58050a652fc7f8336820e" title="Enet DMA close RX channel.">EnetCpdma_closeRxCh()</a>, and <a class="el" href="group__ENET__CPDMA__API.html#ga6dafefe8d28e0aa4c1fc8bde1adcc671" title="Close Enet DMA (data path).">EnetCpdma_close()</a> <a class="el" href="enet_integration_guide_top.html">Back To Top</a></li>
</ol>
<h2><a class="anchor" id="enetper_specific_handling"></a>
Peripheral-specific</h2>
<hr  />
<p><a class="el" href="enet_integration_guide_top.html">Back To Top</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__DRV__ENETPHY_html_ga5f7008641bf565765c557f55756937a4"><div class="ttname"><a href="group__DRV__ENETPHY.html#ga5f7008641bf565765c557f55756937a4">EnetPhy_setExtendedCfg</a></div><div class="ttdeci">void EnetPhy_setExtendedCfg(EnetPhy_Cfg *phyCfg, const void *extendedCfg, uint32_t extendedCfgSize)</div><div class="ttdoc">Set PHY extended parameters.</div></div>
<div class="ttc" id="agroup__ENET__MOD__MACPORT_html_gga046d087375dda93eb619534f98d934d1a80614a8acf9d3f222c1c77813e93cc97"><div class="ttname"><a href="group__ENET__MOD__MACPORT.html#gga046d087375dda93eb619534f98d934d1a80614a8acf9d3f222c1c77813e93cc97">ENET_MAC_LAYER_GMII</a></div><div class="ttdeci">@ ENET_MAC_LAYER_GMII</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:376</div></div>
<div class="ttc" id="astructEnetMacPort__Interface_html_a04a2368a6f261fedc2895faa27568e47"><div class="ttname"><a href="structEnetMacPort__Interface.html#a04a2368a6f261fedc2895faa27568e47">EnetMacPort_Interface::variantType</a></div><div class="ttdeci">EnetMac_VariantType variantType</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:451</div></div>
<div class="ttc" id="aenet__per_8h_html_a5e37e31ddf40acdd06e84bbf2cf413c0ad5684ee47181741d4c11d9de6bd5fbe1"><div class="ttname"><a href="enet__per_8h.html#a5e37e31ddf40acdd06e84bbf2cf413c0ad5684ee47181741d4c11d9de6bd5fbe1">ENET_PER_IOCTL_OPEN_PORT_LINK</a></div><div class="ttdeci">@ ENET_PER_IOCTL_OPEN_PORT_LINK</div><div class="ttdoc">Open port link (MAC port and PHY).</div><div class="ttdef"><b>Definition:</b> enet_per.h:106</div></div>
<div class="ttc" id="agroup__ENETPHY__DP83867_html_ga304aac6fd8cf554d7c01fd8e8a659e66"><div class="ttname"><a href="group__ENETPHY__DP83867.html#ga304aac6fd8cf554d7c01fd8e8a659e66">Dp83867_initCfg</a></div><div class="ttdeci">void Dp83867_initCfg(Dp83867_Cfg *cfg)</div><div class="ttdoc">Initialize DP83867 PHY specific config params.</div></div>
<div class="ttc" id="astructEnetPer__PortLinkCfg_html_a2c02466c17327b6963355acdeb3722a0"><div class="ttname"><a href="structEnetPer__PortLinkCfg.html#a2c02466c17327b6963355acdeb3722a0">EnetPer_PortLinkCfg::macPort</a></div><div class="ttdeci">Enet_MacPort macPort</div><div class="ttdef"><b>Definition:</b> enet_per.h:320</div></div>
<div class="ttc" id="astructEnetMacPort__LinkCfg_html"><div class="ttname"><a href="structEnetMacPort__LinkCfg.html">EnetMacPort_LinkCfg</a></div><div class="ttdoc">Link speed and duplexity configuration.</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:458</div></div>
<div class="ttc" id="astructDp83867__Cfg_html_a798d555a1a75422e9b6b18b82bcc9384"><div class="ttname"><a href="structDp83867__Cfg.html#a798d555a1a75422e9b6b18b82bcc9384">Dp83867_Cfg::ledMode</a></div><div class="ttdeci">Dp83867_LedMode ledMode[DP83867_LED_NUM]</div><div class="ttdef"><b>Definition:</b> dp83867.h:225</div></div>
<div class="ttc" id="astructEnetPhy__Cfg_html_a8ddec0dca674469bd9ff7c9d4aeb6aba"><div class="ttname"><a href="structEnetPhy__Cfg.html#a8ddec0dca674469bd9ff7c9d4aeb6aba">EnetPhy_Cfg::phyAddr</a></div><div class="ttdeci">uint32_t phyAddr</div><div class="ttdef"><b>Definition:</b> enetphy.h:367</div></div>
<div class="ttc" id="agroup__ENET__MAIN__API_html_gga263f2a3003e793a56d3def727e2b6a4fa374942dc0d9af695a2844d886c069ff6"><div class="ttname"><a href="group__ENET__MAIN__API.html#gga263f2a3003e793a56d3def727e2b6a4fa374942dc0d9af695a2844d886c069ff6">ENET_MAC_PORT_1</a></div><div class="ttdeci">@ ENET_MAC_PORT_1</div><div class="ttdef"><b>Definition:</b> enet_types.h:417</div></div>
<div class="ttc" id="agroup__ENET__MAIN__API_html_gga3431e11a2089b5fd51a2059c8e80dc67a4b78a0c8fcc61de7734a2a2b8ff99671"><div class="ttname"><a href="group__ENET__MAIN__API.html#gga3431e11a2089b5fd51a2059c8e80dc67a4b78a0c8fcc61de7734a2a2b8ff99671">ENET_DUPLEX_AUTO</a></div><div class="ttdeci">@ ENET_DUPLEX_AUTO</div><div class="ttdef"><b>Definition:</b> enet_types.h:372</div></div>
<div class="ttc" id="astructEnetMacPort__LinkCfg_html_a8839c991fe644d6f50f46c6ab23aa684"><div class="ttname"><a href="structEnetMacPort__LinkCfg.html#a8839c991fe644d6f50f46c6ab23aa684">EnetMacPort_LinkCfg::speed</a></div><div class="ttdeci">Enet_Speed speed</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:460</div></div>
<div class="ttc" id="agroup__ENETPHY__DP83867_html_ggabf70c55354619c5ad2cd74abe0751e0ea11ffa2c16a786f82acb4ae8b49c14c00"><div class="ttname"><a href="group__ENETPHY__DP83867.html#ggabf70c55354619c5ad2cd74abe0751e0ea11ffa2c16a786f82acb4ae8b49c14c00">DP83867_LED_LINKED_1000BT</a></div><div class="ttdeci">@ DP83867_LED_LINKED_1000BT</div><div class="ttdef"><b>Definition:</b> dp83867.h:164</div></div>
<div class="ttc" id="agroup__ENET__MAIN__API_html_ga4244317c67802020a93c2ed38c9dd797"><div class="ttname"><a href="group__ENET__MAIN__API.html#ga4244317c67802020a93c2ed38c9dd797">ENET_IOCTL_SET_IN_ARGS</a></div><div class="ttdeci">#define ENET_IOCTL_SET_IN_ARGS(prms, in)</div><div class="ttdoc">Set the input args for an IOCTL command.</div><div class="ttdef"><b>Definition:</b> enet_ioctl.h:122</div></div>
<div class="ttc" id="agroup__ENET__MAIN__API_html_gga3431e11a2089b5fd51a2059c8e80dc67aa177d6f0218e0439e0d15bb4dd98b0e5"><div class="ttname"><a href="group__ENET__MAIN__API.html#gga3431e11a2089b5fd51a2059c8e80dc67aa177d6f0218e0439e0d15bb4dd98b0e5">ENET_DUPLEX_FULL</a></div><div class="ttdeci">@ ENET_DUPLEX_FULL</div><div class="ttdef"><b>Definition:</b> enet_types.h:369</div></div>
<div class="ttc" id="astructEnetPhy__Cfg_html"><div class="ttname"><a href="structEnetPhy__Cfg.html">EnetPhy_Cfg</a></div><div class="ttdoc">PHY configuration parameters.</div><div class="ttdef"><b>Definition:</b> enetphy.h:362</div></div>
<div class="ttc" id="agroup__ENET__MOD__MACPORT_html_ggae9fcecf4a51faf27590a0576d7ae803fa3d8b72717e469c33a80bda14d5a81921"><div class="ttname"><a href="group__ENET__MOD__MACPORT.html#ggae9fcecf4a51faf27590a0576d7ae803fa3d8b72717e469c33a80bda14d5a81921">ENET_MAC_VARIANT_FORCED</a></div><div class="ttdeci">@ ENET_MAC_VARIANT_FORCED</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:412</div></div>
<div class="ttc" id="astructEnet__IoctlPrms_html"><div class="ttname"><a href="structEnet__IoctlPrms.html">Enet_IoctlPrms</a></div><div class="ttdoc">Enet IOCTL param.</div><div class="ttdef"><b>Definition:</b> enet_ioctl.h:282</div></div>
<div class="ttc" id="agroup__CPSW__MACPORT__MOD_html_ga0840800cbfc598300796592a959e0577"><div class="ttname"><a href="group__CPSW__MACPORT__MOD.html#ga0840800cbfc598300796592a959e0577">CpswMacPort_initCfg</a></div><div class="ttdeci">void CpswMacPort_initCfg(CpswMacPort_Cfg *macPortCfg)</div><div class="ttdoc">Initialize CPSW MAC port configuration parameters.</div></div>
<div class="ttc" id="astructEnetPer__PortLinkCfg_html_ac49dc7eafa9eb2498599e6dc74759f36"><div class="ttname"><a href="structEnetPer__PortLinkCfg.html#ac49dc7eafa9eb2498599e6dc74759f36">EnetPer_PortLinkCfg::phyCfg</a></div><div class="ttdeci">EnetPhy_Cfg phyCfg</div><div class="ttdef"><b>Definition:</b> enet_per.h:326</div></div>
<div class="ttc" id="astructEnetMacPort__Interface_html_a3db3e6be82433d2f5d6c86d8abd3e93e"><div class="ttname"><a href="structEnetMacPort__Interface.html#a3db3e6be82433d2f5d6c86d8abd3e93e">EnetMacPort_Interface::sublayerType</a></div><div class="ttdeci">EnetMac_SublayerType sublayerType</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:448</div></div>
<div class="ttc" id="agroup__ENETPHY__DP83867_html_ggabf70c55354619c5ad2cd74abe0751e0ea5623fa04afc316997d642a0c5dffaae5"><div class="ttname"><a href="group__ENETPHY__DP83867.html#ggabf70c55354619c5ad2cd74abe0751e0ea5623fa04afc316997d642a0c5dffaae5">DP83867_LED_LINKED_100BTX</a></div><div class="ttdeci">@ DP83867_LED_LINKED_100BTX</div><div class="ttdef"><b>Definition:</b> dp83867.h:167</div></div>
<div class="ttc" id="astructEnetPer__PortLinkCfg_html"><div class="ttname"><a href="structEnetPer__PortLinkCfg.html">EnetPer_PortLinkCfg</a></div><div class="ttdoc">Input args for ENET_PER_IOCTL_OPEN_PORT_LINK command.</div><div class="ttdef"><b>Definition:</b> enet_per.h:318</div></div>
<div class="ttc" id="astructCpswMacPort__Cfg_html"><div class="ttname"><a href="structCpswMacPort__Cfg.html">CpswMacPort_Cfg</a></div><div class="ttdoc">MAC port module configuration parameters.</div><div class="ttdef"><b>Definition:</b> cpsw_macport.h:473</div></div>
<div class="ttc" id="astructEnetMacPort__Interface_html"><div class="ttname"><a href="structEnetMacPort__Interface.html">EnetMacPort_Interface</a></div><div class="ttdoc">MAC port interface.</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:443</div></div>
<div class="ttc" id="agroup__ENET__MOD__MACPORT_html_ggab152ef6c56c6e2ae46bff9a98b370d12a76327445685a653eb966a703cee8b3e9"><div class="ttname"><a href="group__ENET__MOD__MACPORT.html#ggab152ef6c56c6e2ae46bff9a98b370d12a76327445685a653eb966a703cee8b3e9">ENET_MAC_SUBLAYER_REDUCED</a></div><div class="ttdeci">@ ENET_MAC_SUBLAYER_REDUCED</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:391</div></div>
<div class="ttc" id="astructEnetPer__PortLinkCfg_html_acb11a2278c001e8f5297f35fba6ea8dc"><div class="ttname"><a href="structEnetPer__PortLinkCfg.html#acb11a2278c001e8f5297f35fba6ea8dc">EnetPer_PortLinkCfg::linkCfg</a></div><div class="ttdeci">EnetMacPort_LinkCfg linkCfg</div><div class="ttdef"><b>Definition:</b> enet_per.h:332</div></div>
<div class="ttc" id="agroup__ENETPHY__DP83867_html_ggabf70c55354619c5ad2cd74abe0751e0ea716a6ba3faa945ac277346599c32c545"><div class="ttname"><a href="group__ENETPHY__DP83867.html#ggabf70c55354619c5ad2cd74abe0751e0ea716a6ba3faa945ac277346599c32c545">DP83867_LED_RXTXACT</a></div><div class="ttdeci">@ DP83867_LED_RXTXACT</div><div class="ttdef"><b>Definition:</b> dp83867.h:152</div></div>
<div class="ttc" id="astructEnetMacPort__Interface_html_a506724797a467a263c1a1bddcaabf837"><div class="ttname"><a href="structEnetMacPort__Interface.html#a506724797a467a263c1a1bddcaabf837">EnetMacPort_Interface::layerType</a></div><div class="ttdeci">EnetMac_LayerType layerType</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:445</div></div>
<div class="ttc" id="agroup__DRV__ENETPHY_html_gaff5006a4c712434d31f67b3d5d4b3bf9"><div class="ttname"><a href="group__DRV__ENETPHY.html#gaff5006a4c712434d31f67b3d5d4b3bf9">EnetPhy_initCfg</a></div><div class="ttdeci">void EnetPhy_initCfg(EnetPhy_Cfg *phyCfg)</div><div class="ttdoc">Initialize PHY config params.</div></div>
<div class="ttc" id="astructEnetMacPort__LinkCfg_html_a1de48922a0688d1594234c63bfd9baf1"><div class="ttname"><a href="structEnetMacPort__LinkCfg.html#a1de48922a0688d1594234c63bfd9baf1">EnetMacPort_LinkCfg::duplexity</a></div><div class="ttdeci">Enet_Duplexity duplexity</div><div class="ttdef"><b>Definition:</b> enet_mod_macport.h:463</div></div>
<div class="ttc" id="agroup__ENET__MAIN__API_html_gga0bef5cbad0a87693c51f5b607be13feba2fc673ea1a9100a3396e83e393ae6fae"><div class="ttname"><a href="group__ENET__MAIN__API.html#gga0bef5cbad0a87693c51f5b607be13feba2fc673ea1a9100a3396e83e393ae6fae">ENET_SPEED_AUTO</a></div><div class="ttdeci">@ ENET_SPEED_AUTO</div><div class="ttdef"><b>Definition:</b> enet_types.h:357</div></div>
<div class="ttc" id="agroup__ENET__MAIN__API_html_gga0bef5cbad0a87693c51f5b607be13febaaa37947dda4d02f5194c39aa3a95b7f9"><div class="ttname"><a href="group__ENET__MAIN__API.html#gga0bef5cbad0a87693c51f5b607be13febaaa37947dda4d02f5194c39aa3a95b7f9">ENET_SPEED_1GBIT</a></div><div class="ttdeci">@ ENET_SPEED_1GBIT</div><div class="ttdef"><b>Definition:</b> enet_types.h:354</div></div>
<div class="ttc" id="astructEnetPer__PortLinkCfg_html_ad70805ae17f447479f5bc53a850a4402"><div class="ttname"><a href="structEnetPer__PortLinkCfg.html#ad70805ae17f447479f5bc53a850a4402">EnetPer_PortLinkCfg::macCfg</a></div><div class="ttdeci">void * macCfg</div><div class="ttdef"><b>Definition:</b> enet_per.h:323</div></div>
<div class="ttc" id="astructDp83867__Cfg_html"><div class="ttname"><a href="structDp83867__Cfg.html">Dp83867_Cfg</a></div><div class="ttdoc">DP83867 PHY configuration parameters.</div><div class="ttdef"><b>Definition:</b> dp83867.h:195</div></div>
<div class="ttc" id="agroup__DRV__ENETPHY_html_gaac99db2dbc6b1607f75384f3aa15fdba"><div class="ttname"><a href="group__DRV__ENETPHY.html#gaac99db2dbc6b1607f75384f3aa15fdba">ENETPHY_INVALID_PHYADDR</a></div><div class="ttdeci">#define ENETPHY_INVALID_PHYADDR</div><div class="ttdoc">Invalid PHY address indicator.</div><div class="ttdef"><b>Definition:</b> enetphy.h:188</div></div>
<div class="ttc" id="astructEnetPer__PortLinkCfg_html_a5b44defddd2475eb49d91b63693c86f9"><div class="ttname"><a href="structEnetPer__PortLinkCfg.html#a5b44defddd2475eb49d91b63693c86f9">EnetPer_PortLinkCfg::mii</a></div><div class="ttdeci">EnetMacPort_Interface mii</div><div class="ttdef"><b>Definition:</b> enet_per.h:329</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
