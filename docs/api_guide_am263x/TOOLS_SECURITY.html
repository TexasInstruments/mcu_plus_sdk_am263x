<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Security Related Tools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('TOOLS_SECURITY.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Security Related Tools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_components_tools_tools_security"></a> </p>
<h1><a class="anchor" id="TOOLS_BOOT_SIGNING"></a>
Signing Scripts</h1>
<ul>
<li>To run these scripts, one needs <code>openssl</code> installed as mentioned here, <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_OPENSSL">OpenSSL</a></li>
<li>Signing scripts are a collection of scripts needed to sign ROM images (image booted by ROM - mostly the SBL) and application images (image booted by the SBL)</li>
</ul>
<h2><a class="anchor" id="autotoc_md1371"></a>
Signing SBL</h2>
<ul>
<li>The RBL requires the boot image (mostly SBL), to be signed always, even if we are not using secure boot.</li>
</ul>
<p>For SBL images, the script <code>/source/security/security_common/tools/boot/signing/mcu_rom_image_gen.py</code>.</p>
<p>For HS-FS devices: </p><div class="fragment"><div class="line">cd ${SDK_INSTALL_PATH}/source/security/security_common/tools/boot/signing</div>
<div class="line">$(PYTHON) mcu_rom_image_gen.py --image-bin &lt;path-to-the-binary&gt; --core R5 --swrv 1 --loadaddr $(SBL_RUN_ADDRESS) --sign-key &lt;signing-key-configured-in-devconfig&gt; --out-image &lt;output-image-name&gt; --debug $(DEBUG_OPTION)</div>
</div><!-- fragment --><p>For HS-SE devices: </p><div class="fragment"><div class="line">cd ${SDK_INSTALL_PATH}/source/security/security_common/tools/boot/signing</div>
<div class="line">$(PYTHON) mcu_rom_image_gen.py --sbl-enc --enc-key &lt;encryption-key-configured-in-devconfig&gt; --image-bin &lt;path-to-the-binary&gt; --core R5 --swrv 1 --loadaddr $(SBL_RUN_ADDRESS) --sign-key &lt;signing-key-configured-in-devconfig&gt; --kd-salt &lt;path-to-key-derivation-salt&gt; --out-image &lt;output-image-name&gt; --debug $(DEBUG_OPTION)</div>
</div><!-- fragment --><p>Here, we deep dive into the extension supported in SBL and HSM Runtime (TIFS-MCU) certificate by ROM. To get access to the HSM Runtime code and ability to build it for HS-SE device, please contact your TI representative to get access to the TIFS-MCU package from MySecureSW.</p>
<h3><a class="anchor" id="autotoc_md1372"></a>
Boot Information OID (1.3.6.1.4.1.294.1.1)</h3>
<div class="fragment"><div class="line">bootInfo ::=  SEQUENCE {</div>
<div class="line">    cert_type:  INTEGER,        -- identifies the certificate type</div>
<div class="line">    boot_core:  INTEGER,        -- identifies the boot core</div>
<div class="line">    core_opts:  INTEGER,        -- Core Options</div>
<div class="line">    load_addr:  OCTET STRING,   -- Global address image destination</div>
<div class="line">    image_size: INTEGER,        -- Image size in bytes</div>
<div class="line">}</div>
</div><!-- fragment --><p> The Boot Information Object identifier provides information about the image which is being loaded. This information is mandatory and needs to be present else the image boot will fail.</p>
<h4><a class="anchor" id="autotoc_md1373"></a>
Elements of the extension:</h4>
<p><b>Certificate Type</b>: The certificate type defines the type of the image which is being loaded by the Boot-ROM.</p>
<p>These are the supported values:</p><ul>
<li>0x1 R5 SBL Boot Image</li>
<li>0x2 HSM Runtime (TIFS-MCU) Image</li>
</ul>
<p><b>Boot core</b>: The boot core identifies the core on which the image will be executing.</p>
<p>These are the supported values:</p><ul>
<li>0x0 HSM Core</li>
<li>0x10 R5 Core</li>
</ul>
<p><b>Core Options</b>: The core options are documented in the table below.</p>
<p>These are the supported values:</p><ul>
<li>0x0 Lock Step Mode</li>
<li>Non-Zero Dual Core Mode</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Currently, configuring this option is not supported with Signing scripts. This feature will be added in future releases.</dd></dl>
<p>Core options are applicable only for the R5 SBL Images.</p>
<p><b>Load Address</b>: The load address will be address in the system where the image will be loaded. This is applicable for both SBL and TIFS-MCU (HSMRt) images.</p>
<p><b>Image Size</b>: This is the size in bytes of the R5 SBL or HSM Runtime Image to which the certificate has been attached.</p>
<h3><a class="anchor" id="autotoc_md1374"></a>
Image Integrity OID (1.3.6.1.4.1.294.1.2)</h3>
<div class="fragment"><div class="line">imageIntegrity ::= SEQUENCE {</div>
<div class="line">    sha_type:   OID,            -- Identifies the SHA type</div>
<div class="line">    hash:       OCTET STRING    -- The SHA of the boot image</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the X.509 certificate provides the image integrity boot extension, the Boot-ROM will perform the SHA-512 on the entire image and will verify the computed hash with the hash provided in the boot extension. In the case of a mismatch the boot will fail.</p>
<h4><a class="anchor" id="autotoc_md1375"></a>
Elements of the extension:</h4>
<p><b>SHA Type</b>: The Boot-ROM only supports SHA-512.</p>
<p>The following values are supported:</p>
<p>2.16.840.1.101.3.4.2.3 SHA-512 Object Identifier</p>
<p>Please refer to the Section 2.4 of the RFC-5754 for the SHA-512 Object Identifier.</p>
<p><b>Hash</b>: This is SHA-512 hash which is calculated over the image (R5 SBL/HSM Runtime)</p>
<p>R5 SBL Image:</p><ul>
<li>HS-SE Device: Image Integrity is mandatory</li>
<li>HS-FS Device: Image Integrity is optional</li>
</ul>
<p>HSM Runtime Image:</p><ul>
<li>HS-SE Device: Image Integrity is mandatory</li>
<li>HS-FS Device: Image Integrity is mandatory</li>
</ul>
<h3><a class="anchor" id="autotoc_md1376"></a>
Software Revision OID (1.3.6.1.4.1.294.1.3)</h3>
<div class="fragment"><div class="line">softwareRevision ::= SEQUENCE {</div>
<div class="line">   revision:    INTEGER -- Software revision</div>
<div class="line">}</div>
</div><!-- fragment --><p>The information in the software revision is used to indicate the version of the image which is being loaded.</p>
<h4><a class="anchor" id="autotoc_md1377"></a>
Elements of the extension:</h4>
<p><b>revision</b>: This is the version number. This will be matched to the EFUSE programmed version to indicate if the image loading should be done or not. This is applicable only for SE devices.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">EFUSE Revision  </th><th class="markdownTableHeadNone">Certificate Revision  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">Ignore the revision checking. Images will <em>always</em> be loaded   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">&gt;0  </td><td class="markdownTableBodyNone">Device does not mandate revision checking. Images will be loaded   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&gt;0  </td><td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">EFUSE Version &gt; Certificate Version. Image will <em>never</em> be loaded.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&gt;0  </td><td class="markdownTableBodyNone">&gt;0  </td><td class="markdownTableBodyNone">Image will be loaded only if the Certificate revision &gt;= EFUSE revision   </td></tr>
</table>
<p>The following fields in efuse ROM help support the above feature:</p><ul>
<li>SWRV_SBL- This is used to perform the revision checking while loading the R5 SBL</li>
<li>SWRV_HSM- This is used to perform the revision checking while loading the HSM Runtime</li>
</ul>
<p>For more information, about how to fuse in these values, please refer to OTP Keywriter Documentation available on MySecureSW.</p>
<h3><a class="anchor" id="autotoc_md1378"></a>
Image Encryption OID (1.3.6.1.4.1.294.1.4)</h3>
<div class="fragment"><div class="line">imageEncryption ::= SEQUENCE {</div>
<div class="line">   iv:      OCTET STRING -- The initialization vector</div>
<div class="line">   rs:        OCTET STRING -- Random string</div>
<div class="line">   iter:        INTEGER      -- Iteration count</div>
<div class="line">   salt:        OCTET STRING -- encryption salt value</div>
<div class="line">}</div>
</div><!-- fragment --><p>The Boot-ROM only supports AES-CBC mode with 256bit keys. The information in the image encryption object identifier is used to decrypt the image.</p>
<h4><a class="anchor" id="autotoc_md1379"></a>
Elements of the extension:</h4>
<p><b>IV</b>: The initialization vector is used during the AES-CBC decryption procedure. The initialization vector needs to be 16bytes.</p>
<p><b>rs</b>: This is the random string which is 32bytes long and is appended by the script at the end of the image. The Boot-ROM will decrypt the image and will perform a random string comparison to determine if the decryption was successful.</p>
<p><b>iter</b>: Iteration Count which is used to determine if the HKDF needs to be performed and key derivation needs to be done. If the iteration count is 0 then the key from the e-fuse is used as is for the decryption. If the iteration count is non-zero then the Boot-ROM will perform the HKDF key derivation using the salt with exactly one iteration (even if iteration count is &gt; 1). The derived key is then used for the decryption operation.</p>
<p><b>salt</b>: The salt is used only if the iteration count is non-zero and key derivation is being done. The salt is fed to the HKDF module to derive the key. The salt fields should be 32bytes.</p>
<p>For recommendation on the salt, please refer to <a class="el" href="SECURE_BOOT.html">Enabling Secure Boot</a>.</p>
<dl class="section note"><dt>Note</dt><dd>It is recommended to update key derivation salt everytime there is a firmware upgrade. SBL, HSMRt and application images need to be prepared again, once the salt is changed.</dd></dl>
<ul>
<li>HS-SE device: Image Encryption is optional</li>
<li>HS-FS device: Image Encryption is optional</li>
</ul>
<h3><a class="anchor" id="autotoc_md1380"></a>
Derivation OID (1.3.6.1.4.1.294.1.5)</h3>
<div class="fragment"><div class="line">derivationKey ::= SEQUENCE {</div>
<div class="line">   salt:      OCTET STRING -- encryption salt value</div>
<div class="line">}</div>
</div><!-- fragment --><p> The Boot-ROM will leave a derived key in the assets interface for the TIFS-MCU. The key is derived using HKDF from the parameters specified here. This is useful for decrypting application images by sending request to TIFS-MCU. For recommendation on the salt, please refer to <a class="el" href="SECURE_BOOT.html">Enabling Secure Boot</a>.</p>
<h4><a class="anchor" id="autotoc_md1381"></a>
Elements of the extension:</h4>
<p>salt: The salt is limited to be 32bytes and is used for key derivation</p>
<p>This OID is ignored as part of HSM Runtime certificates. This OID is ignored as part of SBL certificates if the device type is HS-FS. Key derivation is always done using the active user symmetric key.</p>
<h3><a class="anchor" id="autotoc_md1382"></a>
Debug OID (1.3.6.1.4.1.294.1.8)</h3>
<div class="fragment"><div class="line">Debug::= SEQUENCE {</div>
<div class="line">      uid          OCTET STRING     -- Device unique ID</div>
<div class="line">      debugType    INTEGER          -- Debug type</div>
<div class="line">      coreDbgEn    INTEGER          -- Enable core debug mask</div>
<div class="line">      secCoreDbgEn INTEGER          -- Enable secure core debug mask</div>
<div class="line">}</div>
</div><!-- fragment --><p> The debug object identifier if specified allows the debug ports to be enabled for a specific device.</p>
<h4><a class="anchor" id="autotoc_md1383"></a>
Elements of the extension:</h4>
<p><b>UID</b>: This is the unique identifier associated with the device. Device specific unique identifiers can be retrieved using the SOC_ID Parser.</p>
<p>The UID field of all 0s is considered to be a wildcard. This is what is supported by default in the script.</p>
<p><b>Debug Type</b>: This is the privilege level of debug.</p>
<p>The privilege levels supported by ROM are as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Privilege Level  </th><th class="markdownTableHeadNone">Value  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DBG_PERM_DISABLE  </td><td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">Disable debug ports for all cores.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DBG_SOC_DEFAULT  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">Maintain debug ports for all cores to device type defaults.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DBG_PUBLIC_ENABLE  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Enable debug ports on R5FSS0-0 core.   </td></tr>
</table>
<p>coreDbgEn and secCoreDbgEn: These fields are not used and will be ignored.</p>
<dl class="section note"><dt>Note</dt><dd>The Debug OID is not applicable for HSM Runtime (TIFS-MCU) image.</dd></dl>
<p>In the SBL Signing scripts, <code>DEBUG_OPTION</code> is used to exercise the debug level if the SBL certificate has debug extension. The SBL certificate as mentioned before, is processed by ROM. This is different from the debug certificate supported by TIFS-MCU.</p>
<p>This feature is leveraged via compile time flags in MCU+ SDK for SBL images.</p>
<p>By default, in SDK, the debug extension is not engaged for SBL images. This is decided by the flag <code>DEBUG_TIFS</code> defined in <code>devconfig.mak</code>. By default, <code>DEBUG_TIFS</code> is set to <code>yes</code>.This means that the debug extension will not be added to SBL and if the debug needs to be exercised via the certificate to TIFS-MCU via the debug authentication service, it can be safely done. This is done to ensure that the registers are written once only to exercise the debug during a POR cycle. If the user wants to open up debug on an HS-SE device, they can set <code>DEBUG_TIFS=no</code>. This is when the debug extension is added to the certificate for SBL images.</p>
<dl class="section note"><dt>Note</dt><dd>ROM does not allow FULL_ENABLE privilege level via SBL certificate. To open up debug on HSM core, please refer to Debug Authentication services provided via TIFS-MCU. In this case, please use the default value of <code>DEBUG_TIFS</code> i.e. <code>yes</code> when compiling SBL examples.</dd></dl>
<p>The default debug privilege used in SDK is <code>DBG_SOC_DEFAULT</code>.</p>
<p>To enable debug on public cores on HS-SE device, one can use the following command to compile SBL examples.</p>
<div class="fragment"><div class="line">make -s -C examples/drivers/boot/sbl_qspi/am263x-cc/r5fss0-0_nortos/ti-arm-clang all DEVICE=am263x DEVICE_TYPE=HS DEBUG_TIFS=no DEBUG_OPTION=DBG_PUBLIC_ENABLE</div>
</div><!-- fragment --><ul>
<li>Here,<ul>
<li><code>SBL_RUN_ADDRESS</code> is <code>0x70002000</code></li>
<li>In the case of HS-FS devices, the key value is disregarded. A degenerate RSA public key is used to sign the certificate. The image integrity is checked in ROM, nevertheless.</li>
<li>In the case of HS-SE device, more details can be found at <a class="el" href="SECURE_BOOT.html">Enabling Secure Boot</a></li>
<li>Refer to TRM Chapter on Initialization, section 5.6.4.1.1 to get help on RSA key pair generation.</li>
</ul>
</li>
</ul>
<p>These scripts are invoked in makefiles, and the image generation happens automatically along with the example build. So mostly these scripts need not be manually run. If the user build-system is different from TI's makefile system, it needs to be ensured that the same is followed as part of the post build steps. The devconfig has ENC_SBL_ENABLED=yes and that is why for HS-SE devices, the SBL image is encrypted by default.</p>
<p>The Boot Information Object identifier provides information about the image which is being loaded.</p>
<h4><a class="anchor" id="autotoc_md1384"></a>
Elements of the extension:</h4>
<p><b>Certificate Type</b>: The certificate type defines the type of the image which is being loaded by the Boot-ROM.</p>
<p>These are the supported values:</p><ul>
<li>0xA5A50000 Application Image</li>
</ul>
<p><b>Boot core</b>: This field is reserved and should be assigned with 0.</p>
<p><b>Core Options</b>: This field is reserved and should be assigned with 0.</p>
<p><b>Load Address</b>: This field is reserved and should be assigned with 0.</p>
<p><b>Image Size</b>: This is the size in bytes of the R5 SBL or HSM Runtime Image to which the certificate has been attached.</p>
<h3><a class="anchor" id="autotoc_md1385"></a>
Image Integrity OID (1.3.6.1.4.1.294.1.2)</h3>
<div class="fragment"><div class="line">imageIntegrity ::= SEQUENCE {</div>
<div class="line">    sha_type:   OID,            -- Identifies the SHA type</div>
<div class="line">    hash:       OCTET STRING    -- The SHA of the boot image</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the X.509 certificate provides the image integrity boot extension, the TIFS-MCU will perform the hash calculation on the entire image and will verify the computed hash with the hash provided in the boot extension. In the case of a mismatch the boot will fail.</p>
<h4><a class="anchor" id="autotoc_md1386"></a>
Elements of the extension:</h4>
<p><b>SHA Type</b>:</p>
<p>The following values are supported:</p>
<ul>
<li>2.16.840.1.101.3.4.2.1 SHA-256 Object Identifier</li>
<li>2.16.840.1.101.3.4.2.2 SHA-384 Object Identifier</li>
<li>2.16.840.1.101.3.4.2.3 SHA-512 Object Identifier</li>
</ul>
<p>Amongst these, SDK has been validated against SHA-512 OID.</p>
<p><b>Hash</b>: This is SHA-512 hash which is calculated over the application image</p>
<h3><a class="anchor" id="autotoc_md1387"></a>
Software Revision OID (1.3.6.1.4.1.294.1.3)</h3>
<div class="fragment"><div class="line">softwareRevision ::= SEQUENCE {</div>
<div class="line">   revision:    INTEGER -- Software revision</div>
<div class="line">}</div>
</div><!-- fragment --><p>The information in the software revision is used to indicate the version of the image which is being loaded.</p>
<h4><a class="anchor" id="autotoc_md1388"></a>
Elements of the extension:</h4>
<p><b>revision</b>: This is the version number. This will be matched to the EFUSE programmed version to indicate if the image loading should be done or not.</p>
<p>The following fields in efuse ROM help support the above feature:</p><ul>
<li>SWRV_APP- This is used to perform the revision checking while loading the application</li>
</ul>
<p>For more information, about how to fuse in these values, please refer to OTP Keywriter Documentation available on MySecureSW.</p>
<h3><a class="anchor" id="autotoc_md1389"></a>
Image Encryption OID (1.3.6.1.4.1.294.1.4)</h3>
<div class="fragment"><div class="line">imageEncryption ::= SEQUENCE {</div>
<div class="line">   iv:      OCTET STRING -- The initialization vector</div>
<div class="line">   rs:      OCTET STRING -- Random string</div>
<div class="line">   iter:    INTEGER      -- Reserved</div>
<div class="line">   salt:    OCTET STRING -- Reserved</div>
<div class="line">}</div>
</div><!-- fragment --><p>TIFS-MCU only supports AES-CBC mode with 256bit keys. The information in the image encryption object identifier is used to decrypt the image.</p>
<h4><a class="anchor" id="autotoc_md1390"></a>
Elements of the extension:</h4>
<p><b>IV</b>: The initialization vector is used during the AES-CBC decryption procedure. The initialization vector needs to be 16bytes.</p>
<p><b>rs</b>: This is the random string which is 32bytes long and is appended by the script at the end of the image. TIFS-MCU will decrypt the image and will perform a random string comparison to determine if the decryption was successful.</p>
<p><b>iter</b>: This field is unused and reserved.</p>
<p><b>salt</b>: This field is unused and reserved.</p>
<h3><a class="anchor" id="autotoc_md1391"></a>
Keyring Index OID (1.3.6.1.4.1.294.1.12)</h3>
<div class="fragment"><div class="line">keyring_index ::= SEQUENCE {</div>
<div class="line">   sign_key_id:     INTEGER -- index of public key hash in public keyring for authentication</div>
<div class="line">   enc_key_id:      INTEGER -- index of aes key in keyring for decryption</div>
<div class="line">}</div>
</div><!-- fragment --><p>TIFS-MCU only supports authentication with keyring. The information in enc_key_id is ignored and decryption is done against root of trust if Image Encryption OID is available in the certificate.</p>
<h4><a class="anchor" id="autotoc_md1392"></a>
Elements of the extension:</h4>
<p><b>sign_key_id</b>: This is the index used in public keyring for retrieving the public key hash for authentication.</p>
<p><b>enc_key_id</b>: This is the index used in keyring for retrieving the aes key for decryption of application image.</p>
<h2><a class="anchor" id="autotoc_md1393"></a>
Application Signing</h2>
<p>For Application images, the script <code>/source/security/security_common/tools/boot/signing/mcu_appimage_x509_cert_gen.py</code>.</p>
<p>For HS-SE devices: </p><div class="fragment"><div class="line">cd ${SDK_INSTALL_PATH}/source/security/security_common/tools/boot/signing</div>
<div class="line">$(PYTHON) mcu_appimage_x509_cert_gen.py --bin &lt;path-to-the-binary&gt; --key &lt;signing-key-configured-in-devconfig&gt;  --enc y --enckey &lt;encryption-key-configured-in-devconfig&gt;  --kd-salt  &lt;path-to-key-derivation-salt&gt; --output &lt;output-image-name&gt;</div>
</div><!-- fragment --><p>Signing of application images is not required for HS-FS device types.</p>
<p>Here, we deep dive into the extension supported with certificate for Application images as processed by TIFS-MCU. To get access to the HSM Runtime code and ability to build it for HS-SE device, please contact your TI representative to get access to the TIFS-MCU package from MySecureSW.</p>
<h3><a class="anchor" id="autotoc_md1394"></a>
Boot Information OID (1.3.6.1.4.1.294.1.1)</h3>
<div class="fragment"><div class="line">bootInfo ::=  SEQUENCE {</div>
<div class="line">    cert_type:  INTEGER,        -- identifies the certificate type</div>
<div class="line">    boot_core:  INTEGER,        -- Reserved</div>
<div class="line">    core_opts:  INTEGER,        -- Reserved</div>
<div class="line">    load_addr:  OCTET STRING,   -- Reserved</div>
<div class="line">    image_size: INTEGER,        -- Image size in bytes</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="KEYRING_CERT_GEN_PYTHON_SCRIPT"></a>
Keyring Cert Generation Python Script</h1>
<dl class="section note"><dt>Note</dt><dd>Support for encryption with symmetric auxiliary keys will be added in future releases.</dd></dl>
<p> <style>div.image img[src="keyring_tooling_view.png"]{width:50%}</style> </p><div class="image">
<img src="keyring_tooling_view.png" alt=""/>
<div class="caption">
Keyring certificate generation and import</div></div>
<div class="fragment"><div class="line">$python3 keyring_cert_gen.py --root_key ../../source/security/security_common/tools/boot/signing/mcu_custMpk.pem --keys_info keys.json</div>
</div><!-- fragment --><ul>
<li>This script is used to generate X.509 certificate for keyring.</li>
<li>Make sure that python3 and its dependent modules are installed in the host machine as mentioned in <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_PYTHON3">Python3</a></li>
<li>keyring_cert_gen.py parses json object containing the following meta-data for keyring cert generation:<ul>
<li>keyring_sw_rev: This integer value is used for anti-rollback check against the keyring software revision available in device efuses.</li>
<li>keyring_ver: Keyring version is of type integer and is the version which is supported against the TIFS-MCU version being used in HSM.</li>
<li>num_of_asymm_keys: Number of Asymmetric keys being imported.</li>
<li>num_of_symm_keys: Number of Symmetric keys being imported.</li>
<li>keyring_asymm: Array of asymmetric keys with respective key rights and hash algorithm to compute and store the hash of the public key. <div class="fragment"><div class="line">{</div>
<div class="line">    &quot;keyring_sw_rev&quot; : 1,</div>
<div class="line">    &quot;keyring_ver&quot; : 1,</div>
<div class="line">    &quot;num_of_asymm_keys&quot; : 7,</div>
<div class="line">    &quot;num_of_symm_keys&quot; : 0,</div>
<div class="line">    &quot;keyring_asymm&quot; :  [</div>
<div class="line">                {</div>
<div class="line">                    &quot;key_rights&quot;: &quot;000000AA&quot;,</div>
<div class="line">                    &quot;pub_key&quot;: &quot;aux_keys/public2k.pem&quot;,</div>
<div class="line">                    &quot;hash_algo&quot;: &quot;SHA256&quot;</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;key_rights&quot;: &quot;000000AA&quot;,</div>
<div class="line">                    &quot;pub_key&quot;: &quot;aux_keys/public3k.pem&quot;,</div>
<div class="line">                    &quot;hash_algo&quot; : &quot;SHA512&quot;</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;key_rights&quot;: &quot;000000AA&quot;,</div>
<div class="line">                    &quot;pub_key&quot;: &quot;aux_keys/public4k.pem&quot;,</div>
<div class="line">                    &quot;hash_algo&quot; : &quot;SHA512&quot;</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;key_rights&quot;: &quot;000000AA&quot;,</div>
<div class="line">                    &quot;pub_key&quot;: &quot;aux_keys/prime265v1_public.pem&quot;,</div>
<div class="line">                    &quot;hash_algo&quot; : &quot;SHA512&quot;</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;key_rights&quot;: &quot;000000AA&quot;,</div>
<div class="line">                    &quot;pub_key&quot;: &quot;aux_keys/secp384r1_public.pem&quot;,</div>
<div class="line">                    &quot;hash_algo&quot; : &quot;SHA512&quot;</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;key_rights&quot;: &quot;000000AA&quot;,</div>
<div class="line">                    &quot;pub_key&quot;: &quot;aux_keys/secp521r1_public.pem&quot;,</div>
<div class="line">                    &quot;hash_algo&quot; : &quot;SHA384&quot;</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;key_rights&quot;: &quot;000000AA&quot;,</div>
<div class="line">                    &quot;pub_key&quot;: &quot;aux_keys/brainpoolp512r1_public.pem&quot;,</div>
<div class="line">                    &quot;hash_algo&quot; : &quot;SHA384&quot;</div>
<div class="line">                }</div>
<div class="line">      ],</div>
<div class="line">    &quot;keyring_symm&quot; :  []</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Each asymmetric key json object contain 3 fields:<ul>
<li>key_rights: Integer value in HEX format which signifies the rights associated with the key.<ul>
<li>debugAuth (0-3b) - flag to indicate key right for debug certificate authentication</li>
<li>imageAuth (4-7b) - flag to indicate key right for application image authentication</li>
<li>For example: 0x000000AA represents the public can be used for both imageAuth and debugAuth</li>
</ul>
</li>
<li>pub_key: Location of the public key</li>
<li>hash_algo: Hash algorithm used for hashing public key.<ul>
<li>SHA256, SHA384 and SHA512 are valid hash algorithms.</li>
</ul>
</li>
</ul>
</li>
<li>keyring_cert_gen.py expects 2 mandatory arguments:<ul>
<li>root_key: certificate is signed using customer MPK and expects path to customer active ROT.</li>
<li>keys_info: json file with keyring meta data.</li>
</ul>
</li>
<li>If RSASSA-PSS algorithm for authentication of keyring certificate is required, provide the &ndash;rsassa_pss flag and &ndash;pss_saltlen <b>value</b>. Maximum supported salt length value for RSASSA-PSS is <b>255</b>. Please refer to the command below <div class="fragment"><div class="line">$python3 keyring_cert_gen.py --root_key ../../source/security/security_common/tools/boot/signing/mcu_custMpk.pem --keys_info keys.json --rsassa_pss --pss_saltlen 64</div>
</div><!-- fragment --></li>
<li>A dummy json and keyring certificate header file is also availble in ${SDK_INSTALL_PATH}/tools/keyring_cert for reference.</li>
<li>Below are the logs after execution of script <div class="fragment"><div class="line">keyring version = 1</div>
<div class="line">keyring software revision = 1</div>
<div class="line">Number of asymmetric keys = 7</div>
<div class="line">Number of symmetric keys = 0</div>
<div class="line"> </div>
<div class="line">[ keyring_asymm ]</div>
<div class="line">asymm_key0=SEQUENCE:comp0</div>
<div class="line">asymm_key1=SEQUENCE:comp1</div>
<div class="line">asymm_key2=SEQUENCE:comp2</div>
<div class="line">asymm_key3=SEQUENCE:comp3</div>
<div class="line">asymm_key4=SEQUENCE:comp4</div>
<div class="line">asymm_key5=SEQUENCE:comp5</div>
<div class="line">asymm_key6=SEQUENCE:comp6</div>
<div class="line"> </div>
<div class="line">[ comp0 ]</div>
<div class="line">keyId=INTEGER:32</div>
<div class="line">key_rights=FORMAT:HEX,OCT:000000AA</div>
<div class="line">hash_algo=INTEGER:6</div>
<div class="line">public_key=FORMAT:HEX,OCT:582fc2a6cc997d2df6c0299aeef0a7b606d3fcc2261dfade8c2684c6663ab50b</div>
<div class="line"> </div>
<div class="line">[ comp1 ]</div>
<div class="line">keyId=INTEGER:33</div>
<div class="line">key_rights=FORMAT:HEX,OCT:000000AA</div>
<div class="line">hash_algo=INTEGER:4</div>
<div class="line">public_key=FORMAT:HEX,OCT:6e430c4a09572240f9acd4b4777b2d662fe28c73ef475280d8a4e7c766d13680b14549a84e6e6c7b69a0ba33840dc9f51f110afb156251a6139c26693e6d4ddf</div>
<div class="line"> </div>
<div class="line">[ comp2 ]</div>
<div class="line">keyId=INTEGER:34</div>
<div class="line">key_rights=FORMAT:HEX,OCT:000000AA</div>
<div class="line">hash_algo=INTEGER:4</div>
<div class="line">public_key=FORMAT:HEX,OCT:67cd4b91e7966af635a53642102abb2c8fdab1a47277c88eb4ec3e1a6ce5155a2325f66b3d392f3f5091e526057cd5e6b6d5085ae46f169c61de77c7dffbb238</div>
<div class="line"> </div>
<div class="line">[ comp3 ]</div>
<div class="line">keyId=INTEGER:35</div>
<div class="line">key_rights=FORMAT:HEX,OCT:000000AA</div>
<div class="line">hash_algo=INTEGER:4</div>
<div class="line">public_key=FORMAT:HEX,OCT:79bd183d942cbf1542a2bad2a469242392c515c1546fc8a43e86a024097ba4bb4db65ccade7fb6b252deccd255491151df927f998d468153072cf3e4949d6002</div>
<div class="line"> </div>
<div class="line">[ comp4 ]</div>
<div class="line">keyId=INTEGER:36</div>
<div class="line">key_rights=FORMAT:HEX,OCT:000000AA</div>
<div class="line">hash_algo=INTEGER:4</div>
<div class="line">public_key=FORMAT:HEX,OCT:4a8959978336886acbe3cf294b1b8e1aa68f1cb836d78aa11332a57cb44c435c82fc672901a2a242e5169543502106ac0cda1b04a9769723154d640e832298ba</div>
<div class="line"> </div>
<div class="line">[ comp5 ]</div>
<div class="line">keyId=INTEGER:37</div>
<div class="line">key_rights=FORMAT:HEX,OCT:000000AA</div>
<div class="line">hash_algo=INTEGER:2</div>
<div class="line">public_key=FORMAT:HEX,OCT:1b759f0c0b04796cc599033bd58e33730ce6b2380f7442fe030beffa3cc844ce0d196f48e5ebeb6d88eea0f7ddc3beb7</div>
<div class="line"> </div>
<div class="line">[ comp6 ]</div>
<div class="line">keyId=INTEGER:38</div>
<div class="line">key_rights=FORMAT:HEX,OCT:000000AA</div>
<div class="line">hash_algo=INTEGER:2</div>
<div class="line">public_key=FORMAT:HEX,OCT:b502e951a5f5ed4bc99191511b530597d3a2d356d0f83887a54253a7ec46fb2c081c7d39391f846932357a57133f8c11</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md1395"></a>
Boot time calculator tool</h1>
<p>Checkout the secure boot time calculator tool <a href="../boottime_calculator/index.html">here</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
