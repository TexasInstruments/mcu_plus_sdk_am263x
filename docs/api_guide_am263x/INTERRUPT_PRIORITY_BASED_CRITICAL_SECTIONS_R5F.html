<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Interrupt Priority Mask based Critical Sections for R5F</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('INTERRUPT_PRIORITY_BASED_CRITICAL_SECTIONS_R5F.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Interrupt Priority Mask based Critical Sections for R5F </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md700">Introduction</a></li>
<li class="level1"><a href="#autotoc_md701">FreeRTOS Use Case</a><ul><li class="level2"><a href="#autotoc_md702">Enabling Interrupt Priority Mask Based Critical Sections</a></li>
<li class="level2"><a href="#autotoc_md703">Entering and Exiting Critical Sections (FreeRTOS)</a><ul><li class="level3"><a href="#autotoc_md704">Nested Critical Sections (FreeRTOS)</a></li>
<li class="level3"><a href="#autotoc_md705">Pseudocode Example (Task Context)</a></li>
<li class="level3"><a href="#autotoc_md706">Pseudocode Example (ISR Context, with nested interrupts enabled)</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md707">NoRTOS Use Case</a><ul><li class="level2"><a href="#autotoc_md708">Entering and Exiting Critical Sections (NoRTOS)</a><ul><li class="level3"><a href="#autotoc_md709">Pseudocode Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md710">Example Case Study: Deep Nested Critical Sections</a><ul><li class="level2"><a href="#autotoc_md711">Scenario Overview</a><ul><li class="level3"><a href="#autotoc_md712">Additional Notes on Interrupt Triggering and Execution Order</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md713">Step-by-Step Execution</a></li>
<li class="level2"><a href="#autotoc_md714">Execution Flow</a></li>
<li class="level2"><a href="#autotoc_md715">Pseudocode</a></li>
<li class="level2"><a href="#autotoc_md716">Key Observations</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_developer_guides_interrupt_priority_critical_section"></a></p>
<h1><a class="anchor" id="autotoc_md700"></a>
Introduction</h1>
<p>Entering a critical section disables all interrupts globally by default, ensuring atomicity but increasing interrupt latency. Interrupt Priority Mask based Critical Sections provide a more flexible approach: only interrupts below a certain priority are masked (disabled), while higher-priority interrupts remain enabled even within a critical section. This allows critical real-time events to be serviced promptly, improving system responsiveness.</p>
<dl class="section attention"><dt>Attention</dt><dd>The interrupt priority based critical sections specified below is specific to ARM R5F architecture.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><br  />
 Interrupt priority mask based critical section have some overheads in taking critical section. <br  />
 So unless this feature is really needed keep this disabled.</dd></dl>
<h1><a class="anchor" id="autotoc_md701"></a>
FreeRTOS Use Case</h1>
<h2><a class="anchor" id="autotoc_md702"></a>
Enabling Interrupt Priority Mask Based Critical Sections</h2>
<p>To enable this feature in FreeRTOS, update your <code>FreeRTOSConfig.h</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define configUSE_INTERRUPT_PRIORITY_BASED_CRITICAL_SECTIONS    (1)</span></div>
<div class="line"><span class="preprocessor">#define configMAX_SYSCALL_INTERRUPT_PRIORITY                    (0x4U) // Example value</span></div>
</div><!-- fragment --><ul>
<li><code>configUSE_INTERRUPT_PRIORITY_BASED_CRITICAL_SECTIONS</code>:<ul>
<li>Set to <code>1</code> to enable priority-based masking</li>
</ul>
</li>
<li><code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code>:<ul>
<li>Sets the priority threshold<ul>
<li>Higher priority interrupts (numerically lower priority value) remain enabled in the critical section</li>
<li>Low priority interrupts (numerically greater than or equal priority value) are masked (disabled)</li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>After updating the config, rebuild all FreeRTOS libraries and your application.</dd></dl>
<h2><a class="anchor" id="autotoc_md703"></a>
Entering and Exiting Critical Sections (FreeRTOS)</h2>
<ul>
<li>Use <code>taskENTER_CRITICAL()</code> and <code>taskEXIT_CRITICAL()</code> in task context.</li>
<li>Use <code>taskENTER_CRITICAL_FROM_ISR()</code> and <code>taskEXIT_CRITICAL_FROM_ISR()</code> in ISR context.</li>
</ul>
<h3><a class="anchor" id="autotoc_md704"></a>
Nested Critical Sections (FreeRTOS)</h3>
<ul>
<li><b>Tasks:</b><ul>
<li>FreeRTOS maintains a nesting count in the task's TCB.</li>
<li>Nested calls are supported and only the outermost <code>EXIT</code> re-enables masked interrupts.</li>
</ul>
</li>
<li><b>ISRs:</b><ul>
<li>The <code>taskENTER_CRITICAL_FROM_ISR()</code> returns a key representing the previous mask state.</li>
<li>Use this key with <code>taskEXIT_CRITICAL_FROM_ISR()</code> to restore the state.</li>
<li>There is no nesting count; instead, a set/restore approach is used.</li>
</ul>
</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Critical ISRs (Higher-priority - those with a numerically lower priority value than <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code>) must not enter a critical section. Doing so can cause undefined behavior. <br  />
 If you really need to mask all interrupts, use <code><a class="el" href="group__KERNEL__DPL__HWI.html#gaac47ffab62f7d25d736b58e40be17425" title="Disable all interrupts.">HwiP_disable()</a></code>. <br  />
 Also these ISRs shouldn't use any FreeRTOS (<code>FromISR</code>) APIs, since this would attempt to enter a critical section. FreeRTOS checks this with <code>portASSERT_IF_INTERRUPT_PRIORITY_INVALID()</code>.</dd></dl>
<h3><a class="anchor" id="autotoc_md705"></a>
Pseudocode Example (Task Context)</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> task_func(<span class="keywordtype">void</span>) </div>
<div class="line">{</div>
<div class="line">    taskENTER_CRITICAL();</div>
<div class="line">    <span class="comment">// Critical section: lower-priority interrupts are masked (priority value &gt;= configMAX_SYSCALL_INTERRUPT_PRIORITY)</span></div>
<div class="line">    <span class="comment">//                   higher-priority interrupts are still enabled (priority value &lt; configMAX_SYSCALL_INTERRUPT_PRIORITY)</span></div>
<div class="line">    <span class="comment">// ... code ...</span></div>
<div class="line">    taskEXIT_CRITICAL();</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md706"></a>
Pseudocode Example (ISR Context, with nested interrupts enabled)</h3>
<div class="fragment"><div class="line"><span class="comment">// ISR function of an interrupt with priority value say &#39;n&#39; </span></div>
<div class="line"><span class="comment">// such that `configMAX_SYSCALL_INTERRUPT_PRIORITY &lt;= n &lt; HwiP_MAX_PRIORITY`</span></div>
<div class="line"><span class="keywordtype">void</span> isr_func(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Since in an ISR, all interrupts of priority less than or equal to current priority are already masked.</span></div>
<div class="line">    <span class="comment">// i.e., lower-priority interrupts are masked (priority value &gt;= n)</span></div>
<div class="line">    <span class="comment">//       higher-priority interrupts are still enabled (priority value &lt; n)</span></div>
<div class="line">    UBaseType_t key = taskENTER_CRITICAL_FROM_ISR();</div>
<div class="line">    <span class="comment">// Critical section in ISR: lower-priority interrupts are masked (priority value &gt;= configMAX_SYSCALL_INTERRUPT_PRIORITY)</span></div>
<div class="line">    <span class="comment">//                          higher-priority interrupts are still enabled (priority value &lt; configMAX_SYSCALL_INTERRUPT_PRIORITY)</span></div>
<div class="line">    <span class="comment">// ... code ...</span></div>
<div class="line">    taskEXIT_CRITICAL_FROM_ISR(key);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md707"></a>
NoRTOS Use Case</h1>
<p>For NoRTOS, enable this feature by defining <code>HWIP_USE_INTERRUPT_PRIORITY_BASED_CRITICAL_SECTIONS</code> in <code><a class="el" href="HwiP_8h.html">HwiP.h</a></code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define HWIP_USE_INTERRUPT_PRIORITY_BASED_CRITICAL_SECTIONS</span></div>
<div class="line"><span class="preprocessor">#define HWIP_CRITICAL_SECTION_INTERRUPT_PRIORITY_THRESHOLD    (4U) // Example value</span></div>
</div><!-- fragment --><ul>
<li><code>HWIP_CRITICAL_SECTION_INTERRUPT_PRIORITY_THRESHOLD</code>:<ul>
<li>Sets the priority threshold for masking.</li>
<li>This is similar to <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> in FreeRTOS.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md708"></a>
Entering and Exiting Critical Sections (NoRTOS)</h2>
<ul>
<li>Use <code>HWIP_ENTER_CRITICAL_SECTION()</code> to enter and <code>HWIP_EXIT_CRITICAL_SECTION(key)</code> to exit.</li>
<li>These APIs use a set/restore approach, allowing nested critical sections.<ul>
<li>The key returned by <code>ENTER</code> must be passed to <code>EXIT</code> to restore the previous state.</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>These APIs can be used from both main context and ISRs.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>However, do not use them from a Critical ISR (Higher-priority - those with a numerically lower priority value than <code>HWIP_CRITICAL_SECTION_INTERRUPT_PRIORITY_THRESHOLD</code>), as this may cause unexpected behavior. <br  />
 If you really need to mask all interrupts, use <code><a class="el" href="group__KERNEL__DPL__HWI.html#gaac47ffab62f7d25d736b58e40be17425" title="Disable all interrupts.">HwiP_disable()</a></code>.</dd></dl>
<h3><a class="anchor" id="autotoc_md709"></a>
Pseudocode Example</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> main_or_isr(<span class="keywordtype">void</span>) {</div>
<div class="line">    uintptr_t key = HWIP_ENTER_CRITICAL_SECTION();</div>
<div class="line">    <span class="comment">// Critical section: lower-priority interrupts are masked (priority value &gt;= HWIP_CRITICAL_SECTION_INTERRUPT_PRIORITY_THRESHOLD)</span></div>
<div class="line">    <span class="comment">//                   higher-priority interrupts are still enabled (priority value &lt; HWIP_CRITICAL_SECTION_INTERRUPT_PRIORITY_THRESHOLD)</span></div>
<div class="line">    <span class="comment">// ... code ...</span></div>
<div class="line">    HWIP_EXIT_CRITICAL_SECTION(key);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md710"></a>
Example Case Study: Deep Nested Critical Sections</h1>
<p>This section presents a detailed, step-by-step walkthrough of an example scenario that demonstrates the behavior of interrupt priority mask based critical sections. It illustrates how critical sections — entered from both task and ISR contexts — interact with interrupts at different priority levels. By following this example scenario, you will gain a deeper understanding of how interrupt priority masking operates in practice, particularly in complex situations involving deeply nested interrupts.</p>
<h2><a class="anchor" id="autotoc_md711"></a>
Scenario Overview</h2>
<ul>
<li>The system is configured with multiple interrupt priority levels (16 levels), and the critical section priority mask is set to 4.</li>
<li>Critical ISRs (priority &lt; mask threshold) are allowed to run even inside the critical section, while Normal ISRs (priority ≥ mask threshold) are masked and deferred until the critical section is exited.</li>
</ul>
<h3><a class="anchor" id="autotoc_md712"></a>
Additional Notes on Interrupt Triggering and Execution Order</h3>
<ul>
<li>A task enters a critical section and triggers two interrupts:<ul>
<li>The lowest priority normal interrupt (priority 15)</li>
<li>The lowest priority critical interrupt (priority 3, which is just above the mask threshold)</li>
</ul>
</li>
<li>The system will immediately switch to the critical ISR when it is triggered</li>
<li>Each critical ISR will trigger the next higher priority critical interrupt as well as next higher priority normal interrupt</li>
<li>The system will immediately switch to the higher priority critical ISR when it is triggered</li>
<li>All normal ISRs will be executed only after exiting from the task critical section, in order of their pending interrupt priorities</li>
<li>Each normal ISR, when executed, will trigger the next higher priority normal interrupt (if it has not already executed) from within its ISR critical section</li>
<li>After exiting the ISR critical section, the system will immediately switch to the higher priority normal ISR, preempting the current ISR</li>
</ul>
<p>These behaviors ensure that critical ISRs are always serviced promptly, while normal ISRs are deferred and executed in priority order once the critical section is exited.</p>
<h2><a class="anchor" id="autotoc_md713"></a>
Step-by-Step Execution</h2>
<ol type="1">
<li><b>Task Context:</b><ul>
<li>The task enters a critical section using <code>taskENTER_CRITICAL()</code></li>
<li>It posts (triggers) the lowest priority normal interrupt (priority 15). This interrupt is masked and will not execute until the critical section is exited.</li>
<li>It then posts the lowest priority critical interrupt (priority 3). Since this interrupt is above the mask threshold, it is allowed to execute immediately, preempting the task.</li>
</ul>
</li>
<li><b>Critical ISR Execution:</b><ul>
<li>The critical ISR for priority 3 runs<ul>
<li>Inside this ISR, it posts the next higher priority normal interrupt (priority 14) and the next higher priority critical interrupt (priority 2)</li>
<li>The normal interrupt (priority 14) is masked and will not execute yet</li>
<li>The critical interrupt (priority 2) is above the mask threshold and executes immediately, preempting the current ISR of priority 3</li>
</ul>
</li>
<li>The critical ISR for priority 2 runs<ul>
<li>It posts the next higher priority normal interrupt (priority 13) and the next higher priority critical interrupt (priority 1)</li>
<li>The normal interrupt (priority 13) is masked</li>
<li>The critical interrupt (priority 1) executes immediately, preempting the current ISR of priority 2</li>
</ul>
</li>
<li>The critical ISR for priority 1 runs<ul>
<li>It posts the next higher priority normal interrupt (priority 12) and the next higher priority critical interrupt (priority 0)</li>
<li>The normal interrupt (priority 12) is masked</li>
<li>The critical interrupt (priority 0) executes immediately, preempting the current ISR of priority 1</li>
</ul>
</li>
<li>The critical ISR for priority 0 runs<ul>
<li>It posts the next higher priority normal interrupt (priority 11)</li>
<li>The normal interrupt (priority 11) is masked</li>
<li>No further critical interrupts are posted, so the ISR returns</li>
</ul>
</li>
<li>After the highest priority critical ISR (priority 0) completes, the system unwinds and returns from each nested critical ISR in reverse order (priority 1, 2, 3), as there are no more higher-priority critical interrupts pending</li>
</ul>
</li>
<li><b>Exiting Task Critical Section:</b><ul>
<li>After all critical ISRs have returned, the task exits the critical section using <code>taskEXIT_CRITICAL()</code></li>
<li>Now, all pending normal interrupts (priorities 11–15) are unmasked and can execute</li>
</ul>
</li>
<li><b>Normal ISR Execution:</b><ul>
<li>The highest priority pending normal ISR (priority 11) executes first</li>
<li>Each normal ISR enters a critical section using <code>taskENTER_CRITICAL_FROM_ISR()</code>, triggers the next higher priority normal interrupt (i.e, priority 10 interrupt from ISR for 11, priority 9 interrupt from ISR for 10, etc.), and then exits the critical section using <code>taskEXIT_CRITICAL_FROM_ISR()</code></li>
<li>Upon exiting the critical section, the system immediately switches to the next higher priority normal ISR, preempting the current ISR</li>
<li>This process repeats until the highest priority normal ISR (priority 4) is entered.</li>
<li>After entering the ISR for priority 4, the system begins to unwind, returning from each ISR in reverse order: 4, 5, 6, 7, 8, 9, 10, and finally 11</li>
<li>After exiting from 11, the system then enters and exits the next pending normal ISRs (priorities 12, 13, 14, and 15) one by one, each time entering and immediately exiting the ISR</li>
</ul>
</li>
<li><b>Completion:</b><ul>
<li>After all ISRs have executed, control returns to the task.</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md714"></a>
Execution Flow</h2>
<div class="image">
<object type="image/svg+xml" data="deep_nested_critical_sections.svg" style="pointer-events: none;"></object>
<div class="caption">
Execution Flow for Deep Nested Critical Section Example Scenario</div></div>
<h2><a class="anchor" id="autotoc_md715"></a>
Pseudocode</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> critical_isr(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// compute `nextNormalIntNum` &amp; `nextCriticalIntNum` based on `arg`</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Trigger the next higher priority normal interrupt. */</span></div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__HWI.html#gaf88bd770e0dbf05a235918f38e291887">HwiP_post</a>(nextNormalIntNum);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Trigger the next higher priority critical interrupt. This should fire immediately. */</span></div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__HWI.html#gaf88bd770e0dbf05a235918f38e291887">HwiP_post</a>(nextCriticalIntNum);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> normal_isr(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// compute `nextNormalIntNum` based on `arg` and check if already executed or not</span></div>
<div class="line"> </div>
<div class="line">    key = taskENTER_CRITICAL_FROM_ISR(); <span class="comment">/* Enter Critical Section */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Trigger the next higher priority normal interrupt(if not already executed).</span></div>
<div class="line"><span class="comment">     * This should fire soon after the critical section exit from ISR below. */</span></div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__HWI.html#gaf88bd770e0dbf05a235918f38e291887">HwiP_post</a>(nextNormalIntNum);</div>
<div class="line">  </div>
<div class="line">    taskEXIT_CRITICAL_FROM_ISR(key); <span class="comment">/* Exit Critical Section */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_task(<span class="keywordtype">void</span> *<a class="code" href="hsmclient__msg_8h.html#add0eb34e0cef9e763462cf9080f9be0a">args</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Register interrupts</span></div>
<div class="line"> </div>
<div class="line">    taskENTER_CRITICAL();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Trigger lowest priority normal interrupt. </span></div>
<div class="line"><span class="comment">     * This shouldn&#39;t fire until exit from critical section as well as all other high priority pending interrupts are serviced. */</span></div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__HWI.html#gaf88bd770e0dbf05a235918f38e291887">HwiP_post</a>(NORMAL_ISR_LOWEST_PRI_INT_NUM);</div>
<div class="line">    <span class="comment">/* Trigger the lowest priority critical interrupt (priority still higher than normal interrupts)</span></div>
<div class="line"><span class="comment">     * This should fire immediately */</span></div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__HWI.html#gaf88bd770e0dbf05a235918f38e291887">HwiP_post</a>(CRITICAL_ISR_LOWEST_PRI_INT_NUM);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Each critical ISR triggers the next higher critical interrupt as well as normal interrupts.</span></div>
<div class="line"><span class="comment">     * It should switch to higher priority critical ISR immediately.</span></div>
<div class="line"><span class="comment">     * All normal ISR should be executed only after exit from the task critical section. */</span></div>
<div class="line"> </div>
<div class="line">    taskEXIT_CRITICAL();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* All normal ISRs should get executed now */</span></div>
<div class="line">    <span class="comment">/* Each normal ISR triggers the next higher normal interrupt (if not already executed). */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Unregister interrupts</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md716"></a>
Key Observations</h2>
<ul>
<li><b>Critical ISRs</b> (priority above the mask threshold) can preempt both the task and other ISRs, and are executed immediately, even within a critical section.</li>
<li><b>Normal ISRs</b> (priority below or equal to the mask threshold) are deferred until the critical section is exited, regardless of how many times they are posted.</li>
<li>The execution order strictly follows interrupt priorities, with higher-priority ISRs always preempting lower-priority ISR code.</li>
<li>This scenario demonstrates how nested critical sections and interrupt priorities interact, ensuring that only the most urgent events are serviced immediately, while less critical events are deferred for atomicity. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="ahsmclient__msg_8h_html_add0eb34e0cef9e763462cf9080f9be0a"><div class="ttname"><a href="hsmclient__msg_8h.html#add0eb34e0cef9e763462cf9080f9be0a">args</a></div><div class="ttdeci">void * args</div><div class="ttdef"><b>Definition:</b> hsmclient_msg.h:4</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__HWI_html_gaf88bd770e0dbf05a235918f38e291887"><div class="ttname"><a href="group__KERNEL__DPL__HWI.html#gaf88bd770e0dbf05a235918f38e291887">HwiP_post</a></div><div class="ttdeci">void HwiP_post(uint32_t intNum)</div><div class="ttdoc">Force trigger a specific interrupt.</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
