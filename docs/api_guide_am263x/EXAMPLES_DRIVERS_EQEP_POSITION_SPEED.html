<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: EQEP Position Speed</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_EQEP_POSITION_SPEED.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EQEP Position Speed </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2470">Introduction</a></li>
<li class="level1"><a href="#autotoc_md2471">External connections</a><ul><li class="level2"><a href="#autotoc_md2472">AM263X-CC or AM263PX-CC</a></li>
<li class="level2"><a href="#autotoc_md2473">AM261X-SOM</a></li>
<li class="level2"><a href="#autotoc_md2474">AM263X-LP or AM263PX-LP</a></li>
<li class="level2"><a href="#autotoc_md2475">AM261X-LP</a></li>
</ul>
</li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_EQEP_POSITION_SPEED_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md2476">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md2477">See Also</a></li>
<li class="level1"><a href="#autotoc_md2478">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_eqep_position_speed"></a></p>
<h1><a class="anchor" id="autotoc_md2470"></a>
Introduction</h1>
<p>Position and Speed Measurement Using eQEP</p>
<p>This example provides position and speed measurement using the capture unit and speed measurement using unit time out of the eQEP module. ePWM and a GPIO are configured to generate simulated eQEP signals. The ePWM module will interrupt once every period and call the position/speed calculation function. This example uses the IQMath library to simplify high-precision calculations.</p>
<p> <style>div.image img[src="am263_eqep_position_speed_measurement_fig1a.png"]{width:50%}</style> </p><div class="image">
<img src="am263_eqep_position_speed_measurement_fig1a.png" alt=""/>
<div class="caption">
Figure 1a. Block diagram</div></div>
<p>The configuration for this example is as follows</p><ul>
<li>Maximum speed is configured to 6000rpm (baseRPM)</li>
<li>Minimum speed is assumed at 10rpm for capture pre-scalar selection</li>
<li>Pole pair is configured to 2 (polePairs)</li>
<li>Encoder resolution is configured to 4000 counts/revolution (mechScaler)</li>
<li>Which means: 4000 / 4 = 1000 line/revolution quadrature encoder (simulated by ePWM)</li>
<li>ePWM (simulating QEP encoder signals) is configured for a 5kHz frequency or 300 rpm (= 4 * 5000 cnts/sec * 60 sec/min) / 4000 cnts/rev)</li>
</ul>
<p>SPEEDRPM_FR: High Speed Measurement is obtained by counting the QEP input pulses for 10ms (unit timer set to 100Hz).</p>
<p>SPEEDRPM_FR = (Position Delta / 10ms) * 60 rpm</p>
<p>SPEEDRPM_PR: Low Speed Measurement is obtained by measuring time period of QEP edges. Time measurement is averaged over 64 edges for better results and the capture unit performs the time measurement using pre-scaled SYSCLK.</p>
<p>Note that the pre-scaler for capture unit clock is selected such that the capture timer does not overflow at the required minimum frequency.</p>
<p>This example waits for 10 iterations of unit time out event and verifies the measured speed: 295 &lt; posSpeed.speedRPMFR &lt; 305</p>
<ul>
<li>posSpeed.speedRPMFR - Speed meas. in rpm using QEP position counter</li>
<li>posSpeed.speedRPMPR - Speed meas. in rpm using capture unit</li>
<li>posSpeed.thetaMech - Motor mechanical angle (Q15)</li>
<li>posSpeed.thetaElec - Motor electrical angle (Q15)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2471"></a>
External connections</h1>
<ul>
<li>Connect ePWM0A to eQEP0A (EPWM_A simulates eQEP Phase A signal)</li>
<li>Connect ePWM0B to eQEP0B (EPWM_B simulates eQEP Phase B signal)</li>
<li>Connect GPIO48 to eQEP0I (GPIO simulates eQEP Index Signal)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2472"></a>
AM263X-CC or AM263PX-CC</h2>
<p>When using AM263x-CC with TMDSHSECDOCK (HSEC180 controlCARD Baseboard Docking Station)</p><ul>
<li>Connect HSEC Pin 49 (ePWM0A) to HSEC Pin 102 (eQEP0A)</li>
<li>Connect HSEC Pin 51 (ePWM0B) to HSEC Pin 100 (eQEP0B)</li>
<li>Connect HSEC Pin 52 (GPIO48) to HSEC Pin 106 (eQEP0I)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2473"></a>
AM261X-SOM</h2>
<p>When using AM261x-SOM with TMDSHSECDOCK (HSEC180 controlCARD Baseboard Docking Station)</p><ul>
<li>Connect HSEC Pin 49 (ePWM0A) to HSEC Pin 100 (eQEP0A)</li>
<li>Connect HSEC Pin 51 (ePWM0B) to HSEC Pin 102 (eQEP0B)</li>
<li>Connect HSEC Pin 52 (GPIO48) to HSEC Pin 106 (eQEP0I)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2474"></a>
AM263X-LP or AM263PX-LP</h2>
<ul>
<li>Connect J2 Pin 11 (ePWM0A) to J25 Pin 1 (eQEP2A)</li>
<li>Connect J6 Pin 59 (ePWM0B) to J25 Pin 2 (eQEP2B)</li>
<li>Connect J2 Pin 40 (GPIO48) to J25 Pin 3 (eQEP2I)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2475"></a>
AM261X-LP</h2>
<p>No external connection is required.</p><ul>
<li>The PWM signal is passed internally via input XBAR to PWMXBAR to EQEPA/B</li>
</ul>
<p>Signal path: GPIO45/46/48 -&gt; INPUTXBAR0/1/2 -&gt; PWMXBAR0/1/2 -&gt; EQEPA/B/I</p>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_EQEP_POSITION_SPEED_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263x-cc, am263x-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/eqep/eqep_position_speed/   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2476"></a>
Steps to Run the Example</h1>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Establish connections as mentioned in External Connections section</li>
<li>Launch a CCS debug session and run the executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>View the UART console logs for results</li>
</ul>
<h1><a class="anchor" id="autotoc_md2477"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_EQEP_PAGE.html">EQEP</a></p>
<h1><a class="anchor" id="autotoc_md2478"></a>
Sample Output</h1>
<p>Shown below is a sample output when the application is run,</p>
<div class="fragment"><div class="line">EQEP Position Speed Test Started ...</div>
<div class="line">Please ensure EPWM to EQEP loopback is connected...</div>
<div class="line">Please wait few seconds ...</div>
<div class="line">Expected speed = 300 RPM, Measured speed = 299 RPM</div>
<div class="line">Electrical angle (Q15) = 19608</div>
<div class="line">Mechanical angle (Q15) = 26188</div>
<div class="line">Rotation direction = CW, forward</div>
<div class="line">EQEP Position Speed Test Passed!!</div>
<div class="line">All tests have passed!!</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
