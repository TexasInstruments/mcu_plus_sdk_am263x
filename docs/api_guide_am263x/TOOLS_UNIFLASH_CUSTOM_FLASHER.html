<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: Uniflash Custom Flash Writer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('TOOLS_UNIFLASH_CUSTOM_FLASHER.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Uniflash Custom Flash Writer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md795">Introduction</a></li>
<li class="level1"><a href="#TOOLS_CUSTOM_FLASHER_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md796">Steps to Configure the Application</a></li>
<li class="level1"><a href="#autotoc_md797">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md798">See Also</a></li>
<li class="level1"><a href="#autotoc_md799">Troubleshooting</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_tools_uniflash_custom_flasher"></a></p>
<h1><a class="anchor" id="autotoc_md795"></a>
Introduction</h1>
<p>This document explains the functionality of a flash-writer application that works in conjunction with the TI Uniflash Tool/CCS, as mentioned in <a class="el" href="TI_UNIFLASH_TOOL.html">TI Uniflash Tool</a>. The TI Uniflash Tool/CCS is packaged with pre-built flash writer intended for use with TI boards. However, this example is primarily aimed at supporting boards with external flash memory that differs from the flash memory that comes with the TI board. This document provides a step-by-step guide on how to build and include the flash writer in the TI Uniflash tool to enable flashing on custom flashes.</p>
<h1><a class="anchor" id="TOOLS_CUSTOM_FLASHER_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263x-cc, am263x-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">tools/flasher/jtag_uniflash   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md796"></a>
Steps to Configure the Application</h1>
<ol type="1">
<li>Get Custom Flash Configuration<ul>
<li>Please refer to the guide <a class="el" href="CUSTOM_FLASH_SUPPORT_GUIDE.html">Adding Support For a Custom Flash Device</a> and generate the custom flash config JSON</li>
<li>Open the sysconfig of the application and fill up the flash configuration.</li>
</ul>
</li>
<li>Selecting buffer Size and Flash Write Type<ul>
<li>To ensure that the application doesn't overlap with the user applications, it should be loaded onto SBL reserved space. To achieve this, it's important to select the correct buffer size and flash write method for flashing.  <style>div.image img[src="custom_flash_memory.png"]{width:70%}</style> <div class="image">
<img src="custom_flash_memory.png" alt=""/>
<div class="caption">
Flashwriter Memory Layout</div></div>
</li>
<li>The buffer size required depends on the flash write method used. Flashes typically have large block sizes and small sector sizes. Depending on the size, block write or sector write can be used. It's recommended to configure the buffer size with a multiple of block or sector size, instead of allocating the buffer with block or sector size. This optimization will help to make the flashing operation more efficient.</li>
<li>Define this flag to use sector flashing. It is recommended to confirm sector flashing is functional before defining this flag, as some flashes have a hybrid sector and sector flashing will not work directly. <div class="fragment"><div class="line">#undef FLASH_WRITE_SECTOR</div>
</div><!-- fragment --></li>
<li>For block or sector type, the flash buffer size should be multiple of block/sector size and aligned with block or sector size <div class="fragment"><div class="line">/* Please make sure to keep the buffersize &gt;= block/sector size and aligned with block/sector size */</div>
<div class="line">#define BOOTLOADER_UNIFLASH_MAX_FILE_SIZE (0x10000)</div>
</div><!-- fragment --></li>
<li>To calculate the total memory required for the buffer, add the internal data buffer size (which should be a multiple of sector/block size) and the uniflash header size. The uniflash header contains important information about the data size, flashing operation, flash offset, and other details. It's important to allocate the necessary memory in the linker file to ensure everything works properly. <div class="fragment"><div class="line">/* This has to match the size of RAM1 section in linker.cmd */</div>
<div class="line">uint8_t gFileBuf[BOOTLOADER_UNIFLASH_MAX_FILE_SIZE+BOOTLOADER_UNIFLASH_HEADER_SIZE] __attribute__((aligned(128), section(&quot;.bss.filebuf&quot;)));</div>
</div><!-- fragment --></li>
<li>Ensure that the application memory does not exceed SBL reserved space by checking the map file of the application.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md797"></a>
Steps to Run the Example</h1>
<p>As this is primarily a flash-writer application, it is used with TI Uniflash Tool/CCS instead of being loaded with CCS like other examples. However, you can build this example using a makefile or import it as a project in CCS and build it that way.</p>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md798"></a>
See Also</h1>
<p>For Serial Uniflash Support, please follow the guide below to build a UART Uniflash application. Once built, enter the path of the output .tiimage in the Uniflash tool. This step is not necessary in CCS. <a class="el" href="EXAMPLES_DRIVERS_SBL_UART_UNIFLASH.html">SBL UART Flash Writer</a></p>
<h1><a class="anchor" id="autotoc_md799"></a>
Troubleshooting</h1>
<p>As this is a flashwriter application, it does not print anything to the console. You can check the application's functionality by running it in CCS and manually filling in the header and flash data. This will allow you to confirm whether your program was able to flash and reach its exit() properly. By doing so, you can ensure that the flash writer application is working correctly. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
