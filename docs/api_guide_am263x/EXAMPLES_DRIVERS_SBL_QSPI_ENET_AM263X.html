<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263x MCU+ SDK: SBL QSPI ENET</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263x MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_SBL_QSPI_ENET_AM263X.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SBL QSPI ENET </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2704">Introduction</a></li>
<li class="level1"><a href="#autotoc_md2705">Supported Combinations</a><ul><li class="level2"><a href="#autotoc_md2706">Application Flow</a></li>
<li class="level2"><a href="#autotoc_md2707">Create a network between EVM and host PC</a><ul><li class="level3"><a href="#autotoc_md2708">Linux (Ubuntu 22.04):</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2709">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md2710">See Also</a></li>
<li class="level1"><a href="#SBL_QSPI_ENET_OUTPUT_SAMPLE">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_sbl_qspi_enet_am263x"></a></p>
<h1><a class="anchor" id="autotoc_md2704"></a>
Introduction</h1>
<p>This bootloader performs SOC initializations and offers additional functionality, including:</p><ol type="1">
<li>Receiving an application images via UDP over Ethernet.</li>
<li>Flashing the received application to QSPI Flash Memory.</li>
<li>Attempting to boot a multicore appimage present at 0x80000 location in the QSPI Flash. This offset is specified in the QSPI bootloader and when the EVM boots in QSPI mode, it will attempt to find a application at this location.</li>
</ol>
<p>To flash a multicore appimage at this location, follow the steps mentioned in <a class="el" href="TOOLS_FLASH.html#BASIC_STEPS_TO_FLASH_FILES">Basic steps to flash files</a>.</p>
<p>On AM263X, we can do ethernet based communication using CPSW as HW mechanism</p><ul>
<li>CPSW is a standard ethernet switch + port HW</li>
<li>It uses ethernet driver underneath</li>
</ul>
<p>The transfer of the user application image works in conjunction with the enet_uniflash.py python script mentioned in <a class="el" href="TOOLS_FLASH.html">Flashing Tools</a>.</p>
<p>If a multicore appimage is found at the location, the SBL parses it, splits it into RPRCs for each core applicable. Each core is then initialized, RPRC image is loaded, entry points are set and the core is released from reset. For more on bootflow/bootloaders, please refer <a class="el" href="BOOTFLOW_GUIDE.html">Understanding the bootflow and bootloaders</a></p>
<p>Note that the SBL is transferred solely through UART, whereas the files that the SBL processes are transmitted over Ethernet.</p>
<dl class="section note"><dt>Note</dt><dd>To ensure the sbl_qspi_enet SBL remains intact, allocate a reserved area of 0x13C000 in MSRAM within the application image's linker script. This precaution prevents the application image from overwriting the SBL during Ethernet-based flashing. </dd>
<dd>
MSRAM specifications:<ol type="1">
<li>Total size: 0x0200000</li>
<li>HSMRT module allocation: 0x40000</li>
<li>ENET libraries/components allocation approximately: 0x7C000</li>
<li>Scratch pad allocation: 0x8000 </li>
</ol>
</dd>
<dd>
The remaining 0x13C000 space is reserved for the application image.</dd></dl>
<h1><a class="anchor" id="autotoc_md2705"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am263x-cc   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/boot/sbl_qspi_enet   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2706"></a>
Application Flow</h2>
<p>The below flow diagram shows the application flow for the reception of an application image via UDP over ethernet on boot of the sbl_qspi_enet SBL.</p>
<p> <style>div.image img[src="sbl_qspi_enet_flow_diagram.png"]{width:30%}</style> </p><div class="image">
<img src="sbl_qspi_enet_flow_diagram.png" alt=""/>
<div class="caption">
Flow Path</div></div>
<p>This SBL application consumes more MSRAM memory (&gt;0x20000) as compared to the sbl_uart_uniflash SBL due to the increased size of the ethernet driver library.</p>
<h2><a class="anchor" id="autotoc_md2707"></a>
Create a network between EVM and host PC</h2>
<h3><a class="anchor" id="autotoc_md2708"></a>
Linux (Ubuntu 22.04):</h3>
<p>The instructions provided below have been validated on Ubuntu(v22.04), but are also applicable to other operating systems. The scripts included in MCU+SDK are designed to be compatible with multiple host PC operating systems, ensuring seamless execution across different platforms.</p>
<ol type="1">
<li>Setup the static IP on the interface connected to the board using the following command:</li>
</ol>
<p>The below steps are for the network interface corresponding to the ethernet connection between the PC and EVM.</p>
<p>Note that the IP addresses utilized in this configuration are also referenced in the Python script and EVM application. To avoid potential conflicts with existing devices, it is essential to update the IP addresses consistently across all relevant components.</p>
<ul>
<li>Connect an ethernet cable between the PC and the EVM(Here in this case AM263 Control Card, Port 1)</li>
<li>This will reflect all the interfaces connected to the linux host PC. <div class="fragment"><div class="line">ifconfig</div>
</div><!-- fragment --></li>
<li>static-IP is hardcoded in <b>sbl_enet.h</b> as: <div class="fragment"><div class="line">/* EVM IP ADDRESS */</div>
<div class="line">#define ENET_SOURCE_IP_ADDRESS          { 192U, 168U, 0U, 195U }</div>
<div class="line">/* Host PC IP Address */</div>
<div class="line">#define ENET_DESTINATION_IP_ADDRESS     { 192U, 168U, 0U, 136U }</div>
</div><!-- fragment --> <div class="fragment"><div class="line">sudo ifconfig &lt;interface-name&gt; &lt;static-HOST-IP&gt;</div>
</div><!-- fragment --></li>
<li>Due to the absence of ARP services (typially provided by LwIP) in this Uniflash application, manual configuration of an ARP entry for the EVM is required. This ensures that the PC does not discard incoming packets from the EVM due to Unknown Unicast address. <div class="fragment"><div class="line">sudo arp -i &lt;interface-name&gt; -s &lt;EVM-static-IP&gt; &lt;EVM-MAC-address&gt;</div>
</div><!-- fragment --></li>
</ul>
<p>EVM MAC Address can be found in the SBL UART console. In this case it is: 70:ff:76:1d:ec:f2</p>
<dl class="section attention"><dt>Attention</dt><dd>Make sure to set the value of the MACRO <b>ENET_HOST_PC_MAC_ADDRESS</b> in the file <b>sbl_enet.h</b> to the MAC address of the corresponding ethernet interface of Linux Host PC: <div class="fragment"><div class="line">/* Host PC MAC Address */</div>
<div class="line">#define ENET_HOST_PC_MAC_ADDRESS        { 0xC0, 0x18, 0x03, 0xBD, 0xB2, 0x7B}</div>
</div><!-- fragment --></dd></dl>
<h1><a class="anchor" id="autotoc_md2709"></a>
Steps to Run the Example</h1>
<p>Since this is a bootloader, the example will be run every time you boot an application using this example. It is run from a QSPI boot media unlike other examples which are usually loaded with CCS. Nevertheless, you can build this example like you do for the others using makefile or build it via CCS by importing as a project.</p>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Refer to the page <a class="el" href="TOOLS_FLASH.html#BASIC_STEPS_TO_FLASH_FILES">Basic steps to flash files</a> to flash the sbl_qspi_enet bootloader to the EVM in UART Boot Mode. Ensure that you should flash the sbl_qspi_enet bootloader, rather than the default sbl_qspi bootloader. Optionally, you can also flash the application image to the QSPI flash memory at offset 0x80000 as mentioned in <a class="el" href="TOOLS_FLASH.html#BASIC_STEPS_TO_FLASH_FILES">Basic steps to flash files</a>. Alternatively, you can omit this step and transmit the application image over Ethernet using the procedure outlined below.</li>
<li>Once the sbl_qspi_enet bootloader image is flashed on the EVM, switch to QSPI Boot Mode and refer to the page <a class="el" href="TOOLS_FLASH.html#BASIC_STEPS_TO_FLASH_FILES_OVER_ENET">Basic steps to flash files over ethernet</a> to send an application image over ethernet to the EVM. </li>
</ul>
<h1><a class="anchor" id="autotoc_md2710"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_BOOTLOADER_PAGE.html">BOOTLOADER</a></p>
<h1><a class="anchor" id="SBL_QSPI_ENET_OUTPUT_SAMPLE"></a>
Sample Output</h1>
<p>Below is an example log from the serial teminal, demonstrating a normal boot process in ENETSBL_TIMER_MODE without image transfer. As shown, the bootloader bypasses the transfer step and proceeds to boot the user application image:</p>
<div class="fragment"><div class="line">[ ENETSBL ] Starting Ethernet Transfer ...</div>
<div class="line">EnetPhy_bindDriver: PHY 0: OUI:080028 Model:23 Ver:01 &lt;-&gt; &#39;dp83869&#39; : OK</div>
<div class="line">PHY 0 is alive</div>
<div class="line">[ ENETSBL ] initQs() txFreePktInfoQ initialized with 16 pkts</div>
<div class="line">[ ENETSBL ] EVM MAC address: 70:ff:76:1d:ec:f2</div>
<div class="line">[ ENETSBL ] PHY 0 is alive</div>
<div class="line">[ ENETSBL ] Please wait for Linkup ...</div>
<div class="line">Cpsw_handleLinkUp: Port 1: Link up: 100-Mbps Full-Duplex</div>
<div class="line">[ ENETSBL ] Linkup Done!</div>
<div class="line">[ ENETSBL TIMEOUT ] Skipping enet transfer.</div>
<div class="line">Cpsw_handleLinkDown: Port 1: Link down</div>
<div class="line"> </div>
<div class="line">Starting QSPI Bootloader ...</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Media       : NOR SPI FLASH</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Media Clock : 80.000 MHz</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Image Size  : 30 KB</div>
<div class="line">[BOOTLOADER_PROFILE] Cores present    :</div>
<div class="line">r5f0-0</div>
<div class="line">[BOOTLOADER PROFILE] System_init                      :        154us</div>
<div class="line">[BOOTLOADER PROFILE] Drivers_open                     :         30us</div>
<div class="line">[BOOTLOADER PROFILE] Board_driversOpen                :         57us</div>
<div class="line">[BOOTLOADER PROFILE] CPU load                         :    8483203us</div>
<div class="line">[BOOTLOADER_PROFILE] SBL Total Time Taken             :    8483448us</div>
<div class="line"> </div>
<div class="line">Image loading done, switching to application ...</div>
<div class="line">INFO: Bootloader_runSelfCpu:217: All done, reseting self ...</div>
<div class="line"> </div>
<div class="line">Hello World!</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
